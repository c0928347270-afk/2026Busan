<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 ÈáúÂ±±‰∫îÊó•ÈÅä</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            light: '#E6F8F6', 
                            DEFAULT: '#00A389', 
                            dark: '#007A66',
                        },
                        text: '#2D3748', 
                        background: '#F8F9FA', 
                        card: '#FFFFFF', 
                        accent: {
                            food: '#EF4444',     
                            shopping: '#3B82F6', 
                            sightseeing: '#10B981', 
                            travel: '#F59E0B',   
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                    },
                    boxShadow: {
                        'custom-sm': '0 1px 3px 0 rgba(0, 0, 0, 0.05)',
                        'custom-md': '0 4px 6px -1px rgba(0, 0, 0, 0.08), 0 2px 4px -2px rgba(0, 0, 0, 0.04)',
                        'custom-lg': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.05)',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #F8F9FA;
            color: #2D3748;
            font-family: 'Noto Sans TC', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .app-card {
            background-color: #FFFFFF; 
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); 
            border: 1px solid #E2E8F0;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .btn-press:active {
            transform: scale(0.98);
            box-shadow: none !important;
        }

        @media (max-width: 1023px) {
            .mobile-nav-bar {
                background-color: #FFFFFF;
                box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.03);
            }
        }

        @media (min-width: 1024px) {
            #app-container {
                display: grid;
                grid-template-columns: 280px 1fr; 
                min-height: 100vh;
            }
            .main-content {
                padding: 32px 40px;
            }
            .sidebar {
                border-right: 1px solid #E2E8F0;
                background-color: #FFFFFF;
                box-shadow: 2px 0 5px rgba(0, 0, 0, 0.02);
            }
        }
    </style>
</head>
<body>

<div id="app" class="min-h-screen">
    <div id="app-container" class="lg:grid">

        <aside class="sidebar fixed top-0 left-0 h-full w-72 p-6 lg:block hidden">
            <header class="mb-8">
                <h1 class="text-2xl font-black text-primary flex items-center gap-2">
                    <i class="ph ph-calendar-check text-3xl" weight="fill"></i>
                    BUSAN 2026
                </h1>
                <p class="text-sm text-text/60 font-medium mt-1">2026ÈáúÂ±±Ë°å</p>
            </header>
            
            <nav class="space-y-1">
                <button v-for="tab in desktopTabs" :key="tab.id"
                    @click="currentTab = tab.id"
                    :class="currentTab === tab.id ? 'bg-primary/10 text-primary font-bold' : 'text-text/80 hover:bg-background'"
                    class="w-full text-left p-3 rounded-lg flex items-center gap-3 transition-colors text-base btn-press">
                    <i :class="tab.icon" class="text-xl" :weight="currentTab === tab.id ? 'fill' : 'regular'"></i>
                    {{ tab.name }}
                </button>
            </nav>

            <div class="absolute bottom-6 left-6 right-6 pt-4 border-t border-gray-100">
                 <div class="text-xs text-text/50">
                    <i class="ph ph-info-circle mr-1"></i>
                    Ë°åÁ®ãÊó•ÊúüÔºö2026.01.21 - 01.25
                 </div>
            </div>
        </aside>

        <main class="main-content lg:col-start-2 lg:pb-8 pb-28 p-5">

            <header class="lg:hidden pb-4 pt-2 flex justify-between items-center">
                 <h1 class="text-2xl font-black text-primary flex items-center gap-2">
                    <i :class="currentTabIcon" class="text-2xl" weight="fill"></i>
                    {{ currentTabName }}
                </h1>
                <p class="text-sm text-text/60 font-medium mt-1">Busan Trip 2026</p>
            </header>
            
            <div v-if="currentTab === 'itinerary'" class="space-y-6">
                <div class="app-card p-3 overflow-x-auto no-scrollbar shadow-custom-sm">
                    <div class="flex space-x-3">
                        <button v-for="i in 5" :key="i" 
                            @click="activeDay = i"
                            :class="activeDay === i ? 'bg-primary text-white shadow-custom-md' : 'bg-background text-text/80 border border-gray-200 hover:bg-gray-100'"
                            class="flex-shrink-0 w-16 h-16 rounded-lg flex flex-col items-center justify-center transition-all duration-300 btn-press text-sm font-bold">
                            <span class="text-[10px] uppercase opacity-80">{{ getDayInfo(i).date.slice(3) }}</span> 
                            <span class="text-xl font-black leading-none mt-0.5">{{ getDayInfo(i).day.slice(1) }}</span>
                        </button>
                    </div>
                </div>

                <div class="flex justify-between items-center px-1 mb-2 border-b border-gray-200 pb-3">
                    <h2 class="text-xl font-bold text-text">{{ getDayInfo(activeDay).fullDay }} Êó•Á®ã</h2>
                    <div class="flex items-center gap-2 text-base font-bold bg-primary/10 px-3 py-1.5 rounded-full text-primary">
                        <span class="text-xl leading-none">{{ getWeatherIcon(simulatedWeather[activeDay].code) }}</span>
                        <span class="text-lg font-black">{{ simulatedWeather[activeDay].temp }}¬∞C</span>
                    </div>
                </div>

                <div class="flex space-x-3 overflow-x-auto no-scrollbar pb-2">
                    <button v-for="cat in filterCategories" :key="cat.key"
                        @click="activeCategory = cat.key"
                        :class="[
                            activeCategory === cat.key ? 'bg-primary text-white shadow-custom-md' : 'bg-white text-text/80 border border-gray-300 hover:bg-gray-100',
                            cat.key !== 'all' ? cat.color : ''
                        ]"
                        class="flex-shrink-0 px-4 py-2 rounded-full flex items-center gap-2 text-sm font-medium transition-colors btn-press">
                        <i :class="cat.icon" :weight="activeCategory === cat.key ? 'fill' : 'regular'"></i>
                        {{ cat.name }}
                    </button>
                </div>


                <div class="space-y-4 pt-2">
                    <div v-if="filteredItineraryByCat.length === 0" class="text-center py-10 text-text/40 app-card border-dashed">
                        <p>Êú¨Êó•ÁÑ°Á¨¶Âêà„Äå{{ filterCategories.find(c => c.key === activeCategory)?.name }}„ÄçÁöÑË°åÁ®ã üìù</p>
                    </div>

                    <div v-for="item in filteredItineraryByCat" :key="item.id" 
                        @click="item.isFlight ? null : openModal(item)"
                        class="app-card p-4 flex gap-4 relative transition-all duration-200 hover:shadow-custom-lg border-l-4"
                        :class="[item.isFlight ? 'border-primary/50' : 'border-primary/20', {'cursor-pointer': !item.isFlight}]">
                        
                        <div class="flex flex-col items-center min-w-[60px] flex-shrink-0">
                            <span class="text-sm font-bold text-primary px-1 font-mono leading-tight">
                                {{ item.time }}
                            </span>
                            <div class="h-full w-px bg-gray-300 my-2"></div>
                        </div>

                        <div class="flex-1 pb-1 min-w-0">
                            <div class="flex justify-between items-start">
                                <h3 class="font-bold text-base text-text leading-tight pr-6">{{ item.title }}</h3>
                                <span v-if="item.category && item.category !== 'flight'" 
                                    :class="getCategoryColor(item.category)"
                                    class="text-xs font-bold px-2 py-0.5 rounded-full bg-opacity-10 whitespace-nowrap">
                                    {{ getCategoryName(item.category) }}
                                </span>
                            </div>
                            
                            <div class="mt-1 flex items-center text-xs text-text/60 font-medium">
                                <i :class="item.isFlight ? 'ph ph-airplane-tilt text-primary' : 'ph ph-map-pin text-text/40'" class="mr-1"></i>
                                <span class="truncate">{{ item.location }}</span>
                            </div>

                            <p v-if="item.desc" class="text-sm text-text/80 mt-2 p-3 bg-primary/5 rounded-lg border-l-2 border-primary/20 w-full whitespace-pre-wrap shadow-inner">
                               {{ item.desc }}
                            </p>

                            <a v-if="!item.isFlight" :href="getNaverMapLink(item.location)" target="_blank" 
                               class="mt-3 inline-flex items-center text-xs font-bold text-white bg-primary px-4 py-2 rounded-full shadow-custom-md hover:bg-primary-dark transition-colors btn-press">
                                <i class="ph ph-navigation-arrow text-sm"></i> Naver Map Â∞éËà™
                            </a>
                        </div>
                    </div>
                </div>
                
                <button @click="openModal(null)" class="fixed bottom-24 right-5 bg-primary text-white w-14 h-14 rounded-full shadow-custom-lg flex items-center justify-center text-2xl z-20 hover:scale-105 transition-transform btn-press lg:hidden">
                    <i class="ph ph-plus" weight="bold"></i>
                </button>
            </div>

            <div v-if="currentTab === 'money'" class="space-y-6">
                <h3 class="font-bold text-xl text-text flex items-center gap-2 border-b border-gray-200 pb-3">
                    <i class="ph ph-currency-krw text-primary text-2xl" weight="fill"></i> ÂåØÁéáËàáË®òÂ∏≥‰∏≠ÂøÉ
                </h3>
                
                <div class="app-card p-5 bg-primary/5 border-l-4 border-primary/30 space-y-3">
                    <div class="flex justify-between items-center">
                        <h4 class="font-bold text-base text-text">‚Ç©/NT$ ÂåØÁéáÊèõÁÆó</h4>
                        <div class="flex items-center gap-2 app-card px-3 py-1 rounded-full shadow-custom-sm border-2 border-primary/20 bg-white">
                            <span class="text-xs text-text/60">Áï∂ÂâçÂåØÁéá</span>
                            <input v-model.number="exchangeRate" type="number" class="w-14 text-right font-black text-sm outline-none text-primary bg-transparent" min="0.01" step="0.01">
                        </div>
                    </div>
                    
                    <div class="flex items-center border-b border-gray-300 pb-3">
                        <span class="font-bold w-16 text-sm text-text/80">KRW (‚Ç©)</span>
                        <input v-model.number="calcKRW" type="number" placeholder="0" class="w-full text-right text-3xl font-black outline-none bg-transparent text-text">
                    </div>
                    <div class="flex items-center pt-3">
                        <span class="font-bold w-16 text-sm text-text/80">TWD (NT$)</span>
                        <div class="w-full text-right text-3xl font-black text-primary">
                            {{ formatNumber(calculatedTWD) }}
                        </div>
                    </div>
                </div>

                <div class="app-card p-5 space-y-4 border-l-4 border-accent-shopping/30 bg-accent-shopping/5">
                    <h4 class="font-bold text-base text-text flex items-center gap-2">
                        <i class="ph ph-wallet-fill text-accent-shopping text-lg"></i>
                        Á∏ΩÊîØÂá∫Ê¶ÇË¶Ω (‰∏çÂê´Ê©üÁ•®‰ΩèÂÆø)
                    </h4>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white p-3 rounded-lg shadow-custom-sm border-2 border-gray-100">
                            <p class="text-xs text-text/60 font-medium">Á∏ΩÊîØÂá∫ (KRW)</p>
                            <p class="font-black text-xl text-text">‚Ç© {{ formatNumber(totalExpenseKRW) }}</p>
                        </div>
                        <div class="bg-white p-3 rounded-lg shadow-custom-sm border-2 border-primary/20">
                            <p class="text-xs text-text/60 font-medium">Á∏ΩÊîØÂá∫ (TWD)</p>
                            <p class="font-black text-xl text-primary">NT$ {{ formatNumber(totalExpenseTWD) }}</p>
                        </div>
                    </div>
                </div>

                <div class="app-card p-4 border-l-4 border-accent-food/30 bg-accent-food/5 space-y-4">
                    <h4 class="font-bold text-base text-text/80 flex items-center gap-2">
                        <i class="ph ph-receipt-bold text-accent-food text-lg"></i> Êñ∞Â¢ûÊ∂àË≤ªÁ¥ÄÈåÑ
                    </h4>
                    
                    <div class="grid grid-cols-2 gap-2">
                        <div class="flex-1">
                            <label class="text-xs text-primary font-bold ml-1 flex items-center gap-1"><i class="ph ph-calendar-blank"></i> Êó•Êúü</label>
                            <input type="date" v-model="newExpense.date" class="w-full bg-white p-2 rounded-lg text-xs outline-none border text-center shadow-custom-sm mt-1">
                        </div>
                        <div class="flex-1">
                            <label class="text-xs text-primary font-bold ml-1 flex items-center gap-1"><i class="ph ph-tag"></i> È°ûÂà• (ÂøÖÈÅ∏)</label>
                            <select v-model="newExpense.category" class="w-full bg-white p-2 rounded-lg text-xs outline-none border shadow-custom-sm mt-1" :class="{'border-red-500': !newExpense.category && newExpense.item}">
                                <option value="" disabled>ÈÅ∏ÊìáÈ°ûÂà•</option>
                                <option v-for="cat in filterCategories.filter(c => c.key !== 'all' && c.key !== 'flight')" :key="cat.key" :value="cat.key">
                                    {{ cat.name }}
                                </option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="text-xs text-primary font-bold ml-1 flex items-center gap-1"><i class="ph ph-notepad"></i> ÂìÅÈ†ÖÂêçÁ®± (Ê∂àË≤ªÂÖßÂÆπ)</label>
                        <input v-model="newExpense.item" placeholder="‰æãÂ¶ÇÔºöÊµ∑Êù±ÈæçÂÆÆÂØ∫Ë®àÁ®ãËªäË≤ª" class="w-full bg-white p-2.5 rounded-lg text-sm outline-none border shadow-custom-sm focus:border-primary mt-1">
                    </div>
                    
                    <div>
                        <label class="text-xs text-primary font-bold ml-1 flex items-center gap-1"><i class="ph ph-currency-krw"></i> ÈáëÈ°ç (ÈüìÂÖÉ)</label>
                        <div class="relative w-full">
                            <input v-model.number="newExpense.amount" type="number" placeholder="0" class="w-full bg-white p-2.5 pl-8 rounded-lg text-sm outline-none border shadow-custom-sm focus:border-primary mt-1">
                            <span class="absolute left-2 top-[13px] text-sm text-text/40 font-bold">‚Ç©</span>
                        </div>
                        <p v-if="newExpenseTWD > 0" class="text-xs text-text/60 mt-1 text-right">
                            Á¥Ñ NT$ {{ formatNumber(newExpenseTWD) }}
                        </p>
                    </div>
                    
                    <div>
                        <button @click="addExpense" :disabled="!newExpense.item || !newExpense.amount || newExpense.amount <= 0 || !newExpense.category" class="w-full bg-primary text-white py-3 rounded-lg font-bold text-base shadow-custom-md transform hover:scale-[1.02] transition btn-press disabled:opacity-50 mt-2">
                            <i class="ph ph-plus-bold"></i> Êñ∞Â¢ûÊ∂àË≤ªÁ¥ÄÈåÑ
                        </button>
                    </div>
                </div>


                <div class="space-y-2 pb-8 pt-4">
                    <h4 class="font-bold text-base text-text border-b border-gray-200 pb-2 flex items-center gap-2">
                        <i class="ph ph-list-dashes text-primary text-lg"></i> Ê≠∑Âè≤Ë®òÂ∏≥Ê∏ÖÂñÆ (ÂÖ± {{ expenses.length }} Á≠Ü)
                    </h4>
                    
                    <div v-for="(exp, index) in expenses" :key="index" class="app-card p-3 flex justify-between items-center border-l-4" :class="`border-${exp.category}-300`">
                        <div class="flex flex-col flex-1 truncate pr-2">
                            <span class="text-sm font-bold text-text truncate">{{ exp.item }}</span>
                            <span class="text-[10px] text-text/60">{{ exp.date.slice(5) }} ¬∑ {{ getCategoryName(exp.category) }}</span>
                        </div>
                        <div class="flex items-center gap-3 flex-shrink-0">
                            <div class="text-right">
                                <p class="font-bold text-text/60 text-xs">‚Ç©{{ formatNumber(exp.amount) }}</p>
                                <p class="text-sm font-black text-primary">NT$ {{ formatNumber(convertKRWToTWD(exp.amount)) }}</p>
                            </div>
                            <button @click="removeExpense(index)" class="text-text/30 hover:text-red-500 p-1 btn-press"><i class="ph ph-x-circle text-lg"></i></button>
                        </div>
                    </div>
                    <div v-if="expenses.length === 0" class="text-center text-sm text-text/30 py-4 app-card">
                        ÈÇÑÊ≤íÊúâË®òÂ∏≥Á¥ÄÈåÑÂñî
                    </div>
                </div>

            </div>

            <div v-if="currentTab === 'info'" class="space-y-6">
                <h3 class="font-bold text-xl text-text px-1 flex items-center gap-2 border-b border-gray-200 pb-3"><i class="ph ph-airplane-takeoff text-primary text-2xl" weight="fill"></i> Ëà™Áè≠Ë≥áË®ä</h3>

                <div class="app-card p-5 relative overflow-hidden bg-primary/5 border-l-4 border-primary">
                    <div class="flex justify-between items-center mb-4 border-b border-dashed border-primary/30 pb-3">
                        <h2 class="text-lg font-bold text-text">ÂéªÁ®ã TPE ‚Üí PUS</h2>
                        <span class="text-2xl font-black text-primary font-mono">{{ flightInfo.departure.flightNo }}</span>
                    </div>

                    <div class="grid grid-cols-2 gap-x-4 gap-y-3 text-sm">
                        <div class="flex flex-col">
                            <span class="text-xs text-text/60 uppercase">Departure Time</span>
                            <span class="font-bold text-text">{{ flightInfo.departure.depTime }} (Jan 21, 2026)</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-xs text-text/60 uppercase">Boarding Time</span>
                            <span class="font-bold text-red-500">{{ flightInfo.departure.boardingTime }}</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-xs text-text/60 uppercase">Terminal / Gate</span>
                            <span class="font-bold text-text">{{ flightInfo.departure.terminal }} / {{ flightInfo.departure.gate }}</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-xs text-text/60 uppercase">Arrival Time (PUS)</span>
                            <span class="font-bold text-text">17:40</span>
                        </div>
                    </div>
                </div>
                
                <div class="app-card p-5 relative overflow-hidden bg-red-500/5 border-l-4 border-red-500">
                    <div class="flex justify-between items-center mb-4 border-b border-dashed border-red-500/30 pb-3">
                        <h2 class="text-lg font-bold text-text">ÂõûÁ®ã PUS ‚Üí TPE</h2>
                        <span class="text-2xl font-black text-red-500 font-mono">{{ flightInfo.return.flightNo }}</span>
                    </div>

                    <div class="grid grid-cols-2 gap-x-4 gap-y-3 text-sm">
                        <div class="flex flex-col">
                            <span class="text-xs text-text/60 uppercase">Departure Time</span>
                            <span class="font-bold text-text">{{ flightInfo.return.depTime }} (Jan 25, 2026)</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-xs text-text/60 uppercase">Boarding Time</span>
                            <span class="font-bold text-red-500">{{ flightInfo.return.boardingTime }}</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-xs text-text/60 uppercase">Terminal / Gate</span>
                            <span class="font-bold text-text">{{ flightInfo.return.terminal }} / {{ flightInfo.return.gate }}</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-xs text-text/60 uppercase">Arrival Time (TPE)</span>
                            <span class="font-bold text-text">20:25</span>
                        </div>
                    </div>
                </div>


                <h3 class="font-bold text-xl text-text pt-4 px-1 flex items-center gap-2 border-b border-gray-200 pb-3"><i class="ph ph-buildings text-primary text-2xl" weight="fill"></i> ‰ΩèÂÆøË≥áË®ä</h3>
                <div class="app-card p-5 border-2 border-primary/20">
                    <div class="flex items-center mb-3">
                        <i class="ph ph-bed text-2xl text-primary mr-2"></i>
                        <h2 class="text-lg font-bold text-text leading-tight">{{ hotelInfo.name }}</h2>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg border border-gray-200">
                        <label class="text-xs text-text/60 font-bold uppercase block mb-1">Âú∞ÂùÄ (Address)</label>
                        <p class="font-bold text-sm text-text select-all">{{ hotelInfo.address }}</p>
                    </div>
                    
                    <a :href="getNaverMapLink(hotelInfo.name)" target="_blank" class="w-full mt-4 py-3 bg-primary text-white font-bold rounded-lg shadow-custom-md hover:bg-primary-dark transition btn-press flex items-center justify-center gap-2 text-sm">
                        <i class="ph ph-navigation-arrow"></i> Naver Map Â∞éËà™
                    </a>
                </div>
            </div>

            <div v-if="currentTab === 'guide'" class="space-y-6">

                <div class="app-card p-5 space-y-5">
                    <div class="space-y-3">
                        <h3 class="font-bold text-xl text-text flex items-center gap-2 border-b border-gray-200 pb-2">
                            <i class="ph ph-suitcase-rolling text-primary text-2xl" weight="fill"></i> Ë°åÊùéÊ∏ÖÂñÆ
                            <span class="text-xs text-text/60">({{ luggageList.filter(i => i.checked).length }} / {{ luggageList.length }})</span>
                        </h3>
                        
                        <div class="flex gap-2 p-1 rounded-md bg-gray-50">
                            <input v-model="newLuggageItem" @keyup.enter="addLuggage" type="text" placeholder="Êñ∞Â¢ûÁâ©ÂìÅ..." class="flex-1 bg-white p-2.5 rounded-lg text-sm outline-none border focus:border-primary shadow-custom-sm">
                            <button @click="addLuggage" class="bg-primary text-white px-3 h-10 rounded-lg flex items-center justify-center btn-press shadow-custom-md text-sm font-bold whitespace-nowrap"><i class="ph ph-plus-bold mr-1"></i> Êñ∞Â¢û</button>
                        </div>

                        <div class="space-y-2">
                            <div v-for="(item, index) in luggageList" :key="`l-${index}`" class="flex items-center bg-white p-3 rounded-lg border border-gray-200 shadow-custom-sm transition" :class="{'opacity-70 bg-gray-50': item.checked}">
                                <input type="checkbox" v-model="item.checked" class="form-checkbox h-5 w-5 text-primary rounded border-gray-300 focus:ring-primary cursor-pointer">
                                <span class="ml-3 flex-1 text-sm font-medium text-text" :class="{'line-through text-text/40': item.checked}">{{ item.text }}</span>
                                <button @click="removeLuggage(index)" class="text-text/20 hover:text-red-500 px-2 btn-press"><i class="ph ph-trash"></i></button>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-3 pt-4 border-t border-gray-200">
                        <h3 class="font-bold text-xl text-text flex items-center gap-2 border-b border-gray-200 pb-2">
                            <i class="ph ph-bag-simple text-red-500 text-2xl" weight="fill"></i> ÂøÖË≤∑Ê∏ÖÂñÆ
                            <span class="text-xs text-text/60">({{ mustBuyList.filter(i => i.checked).length }} / {{ mustBuyList.length }})</span>
                        </h3>
                        
                        <div class="flex gap-2 p-1 rounded-md bg-gray-50">
                            <input v-model="newMustBuyItem" @keyup.enter="addMustBuy" type="text" placeholder="Êñ∞Â¢ûÂìÅÈ†Ö..." class="flex-1 bg-white p-2.5 rounded-lg text-sm outline-none border focus:border-red-500 shadow-custom-sm">
                            <button @click="addMustBuy" class="bg-red-500 text-white px-3 h-10 rounded-lg flex items-center justify-center btn-press shadow-custom-md text-sm font-bold whitespace-nowrap"><i class="ph ph-plus-bold mr-1"></i> Êñ∞Â¢û</button>
                        </div>

                        <div class="space-y-2">
                            <div v-for="(item, index) in mustBuyList" :key="`m-${index}`" class="flex items-center bg-white p-3 rounded-lg border border-gray-200 shadow-custom-sm transition" :class="{'opacity-70 bg-gray-50': item.checked}">
                                <input type="checkbox" v-model="item.checked" class="form-checkbox h-5 w-5 text-red-500 rounded border-gray-300 focus:ring-red-500 cursor-pointer">
                                <span class="ml-3 flex-1 text-sm font-medium text-text" :class="{'line-through text-text/40': item.checked}">{{ item.text }}</span>
                                <button @click="removeMustBuy(index)" class="text-text/20 hover:text-red-500 px-2 btn-press"><i class="ph ph-trash"></i></button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="app-card p-5 border-l-4 border-red-500/50 bg-red-500/5">
                    <h3 class="font-bold text-xl text-text flex items-center gap-2 mb-4 border-b border-red-500/20 pb-2">
                        <i class="ph ph-phone-call text-red-500 text-2xl" weight="fill"></i> Á∑äÊÄ•ËÅØÁµ°ÈõªË©±
                    </h3>
                    <div class="space-y-3">
                        <div v-for="contact in emergencyContacts" :key="contact.number" class="flex justify-between items-center bg-white p-3 rounded-lg border border-red-500/30 shadow-custom-sm">
                            <div class="flex flex-col">
                                <span class="font-bold text-text text-sm">{{ contact.name }}</span>
                                <span class="text-xs text-text/60">{{ contact.desc }}</span>
                            </div>
                            <a :href="`tel:${contact.number}`" class="bg-red-500 text-white px-4 py-2 rounded-full font-bold text-sm btn-press shadow-custom-md hover:bg-red-600">
                                Êí•Êâì {{ contact.number }}
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'map'" class="h-[70vh] flex flex-col space-y-4">
                <div class="app-card p-4 shadow-custom-sm">
                    <input v-model="mapQuery" @keyup.enter="searchNaverMap" type="text" placeholder="Ëº∏ÂÖ•Âú∞ÈªûÊêúÂ∞ã (‰æãÂ¶ÇÔºöÊµ∑Èõ≤Âè∞)" class="w-full bg-gray-50 px-4 py-3 rounded-lg text-sm outline-none font-medium mb-3 focus:bg-white focus:ring-2 focus:ring-primary/50 transition border border-gray-200">
                    
                    <div class="flex gap-3">
                        <button @click="searchNaverMap" class="flex-1 bg-primary text-white py-3 rounded-lg font-bold text-sm shadow-custom-md btn-press flex items-center justify-center gap-2 hover:bg-primary-dark">
                            <i class="ph ph-navigation-arrow"></i> Naver Map
                        </button>
                        <button @click="searchGoogleMap" class="flex-1 bg-white text-text border border-gray-300 py-3 rounded-lg font-bold text-sm shadow-custom-sm btn-press flex items-center justify-center gap-2 hover:bg-gray-100">
                            <i class="ph ph-map-pin"></i> Google Map
                        </button>
                    </div>
                </div>
                
                <div class="flex-1 rounded-lg overflow-hidden shadow-custom-lg relative bg-gray-100 border border-gray-200">
                    <iframe width="100%" height="100%" style="border:0" loading="lazy" 
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d102716.27850871927!2d129.0838128!3d35.1584949!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3568e89f81216d8f%3A0x6a0c5c36af1c944d!2sBusan%2C%20South%20Korea!5e0!3m2!1sen!2stw!4v1703649600000!5m2!1sen!2stw" 
                        allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                    <div class="absolute bottom-4 left-4 bg-white/90 backdrop-blur px-3 py-1.5 rounded-lg text-xs font-bold text-text/80 shadow-md border border-gray-200">
                        ÂÉÖ‰æõÊ¶ÇË¶ΩÔºåÂ∞éËà™Ë´ã‰ΩøÁî®‰∏äÊñπÊåâÈàï
                    </div>
                </div>
            </div>
        </main>
    </div>

    <nav class="fixed bottom-0 w-full pb-safe pt-2 px-2 flex justify-between items-center mobile-nav-bar rounded-t-xl z-30 lg:hidden">
        <button v-for="tab in mobileTabs" :key="tab.id"
            @click="currentTab = tab.id"
            :class="currentTab === tab.id ? 'text-primary' : 'text-text/50'" 
            class="flex flex-col items-center p-2 flex-1 transition-all">
            <i :class="tab.icon" class="text-2xl" :weight="currentTab === tab.id ? 'fill' : 'regular'"></i>
            <span class="text-[10px] font-bold mt-1">{{ tab.name }}</span>
        </button>
    </nav>

    <div v-if="showModal" class="fixed inset-0 bg-text/30 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="app-card w-full max-w-sm rounded-xl p-6 shadow-custom-lg scale-100 transition-transform border-l-4 border-primary">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-text">
                    {{ isEditMode ? 'Á∑®ËºØË°åÁ®ã ‚úèÔ∏è' : 'Êñ∞Â¢ûÁ≠ÜË®ò ‚ú®' }}
                </h3>
                <button @click="showModal = false" class="bg-gray-100 w-8 h-8 rounded-full text-text/70 hover:bg-gray-200 btn-press"><i class="ph ph-x"></i></button>
            </div>
            <div class="space-y-3">
                <div>
                    <label class="text-xs text-primary font-bold ml-1 flex items-center gap-1"><i class="ph ph-clock"></i> ÊôÇÈñì</label>
                    <input v-model="modalForm.time" type="time" class="w-full bg-gray-50 p-3 rounded-lg mt-1 outline-none border focus:border-primary">
                </div>
                <div>
                    <label class="text-xs text-primary font-bold ml-1 flex items-center gap-1"><i class="ph ph-tag"></i> È°ûÂà•</label>
                    <select v-model="modalForm.category" class="w-full bg-gray-50 p-3 rounded-lg mt-1 outline-none border focus:border-primary">
                        <option value="" disabled>ÈÅ∏ÊìáË°åÁ®ãÈ°ûÂà•</option>
                        <option v-for="cat in filterCategories.filter(c => c.key !== 'all' && c.key !== 'flight')" :key="cat.key" :value="cat.key">{{ cat.name }}</option>
                    </select>
                </div>
                <div>
                    <label class="text-xs text-primary font-bold ml-1 flex items-center gap-1"><i class="ph ph-text-h"></i> Ê®ôÈ°å</label>
                    <input v-model="modalForm.title" type="text" placeholder="Ë°åÁ®ãÂêçÁ®±" class="w-full bg-gray-50 p-3 rounded-lg mt-1 outline-none border focus:border-primary">
                </div>
                <div>
                    <label class="text-xs text-primary font-bold ml-1 flex items-center gap-1"><i class="ph ph-map-pin"></i> Âú∞Èªû (Âú∞ÂúñÊêúÂ∞ãÁî®)</label>
                    <input v-model="modalForm.location" type="text" placeholder="Ëº∏ÂÖ•ÈóúÈçµÂ≠ó" class="w-full bg-gray-50 p-3 rounded-lg mt-1 outline-none border focus:border-primary">
                </div>
                <div>
                    <label class="text-xs text-primary font-bold ml-1 flex items-center gap-1"><i class="ph ph-chats"></i> ÂÇôË®ª/‰∫§ÈÄöË≥áË®ä</label>
                    <textarea v-model="modalForm.desc" rows="3" placeholder="‰æãÂ¶ÇÔºö‰∫§ÈÄöÊñπÂºè„ÄÅÁáüÊ•≠ÊôÇÈñì..." class="w-full bg-gray-50 p-3 rounded-lg mt-1 outline-none border focus:border-primary resize-none"></textarea>
                </div>
            </div>
            <button @click="saveItem" :disabled="!modalForm.title || !modalForm.category" class="w-full mt-6 py-3.5 bg-primary text-white font-bold rounded-lg shadow-custom-md btn-press disabled:opacity-50">
                ÂÑ≤Â≠òÁ≠ÜË®ò
            </button>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            // --- State ---
            const currentTab = ref('itinerary');
            const activeDay = ref(1);
            const activeCategory = ref('all'); 
            const showModal = ref(false);
            const isEditMode = ref(false);
            const mapQuery = ref('');
            
            // Guide
            const luggageList = ref([]);
            const newLuggageItem = ref('');
            const mustBuyList = ref([]);
            const newMustBuyItem = ref('');
            
            // Calculator
            const calcKRW = ref('');
            const exchangeRate = ref(41.5); 
            
            // Expenses (REFACTORED)
            const expenses = ref([]);
            const newExpense = ref({ 
                date: new Date().toISOString().split('T')[0], 
                item: '', 
                amount: null, 
                category: '' 
            });

            // Modal Form
            const modalForm = ref({ id: null, time: '', title: '', location: '', desc: '', category: '' });

            // --- Fixed Data ---
            const desktopTabs = [
                { id: 'itinerary', name: 'Ë°åÁ®ãË¶èÂäÉ', icon: 'ph-notebook' },
                { id: 'money', name: 'ÂåØÁéáËàáË®òÂ∏≥', icon: 'ph-currency-krw' },
                { id: 'info', name: 'Ê©üÁ•®Ëàá‰ΩèÂÆø', icon: 'ph-ticket' },
                { id: 'guide', name: 'Ê∫ñÂÇôÊ∏ÖÂñÆ', icon: 'ph-list-checks' },
                { id: 'map', name: 'Âú∞ÂúñÊêúÂ∞ã', icon: 'ph-map-trifold' },
            ];
            
            const mobileTabs = [
                { id: 'itinerary', name: 'Ë°åÁ®ã', icon: 'ph-notebook' },
                { id: 'money', name: 'Ë®òÂ∏≥', icon: 'ph-currency-krw' },
                { id: 'info', name: 'Ë≥áË®ä', icon: 'ph-ticket' },
                { id: 'guide', name: 'Ê∏ÖÂñÆ', icon: 'ph-list-checks' },
                { id: 'map', name: 'Âú∞Âúñ', icon: 'ph-map-trifold' },
            ];

            const currentTabName = computed(() => {
                const tab = desktopTabs.find(t => t.id === currentTab.value);
                return tab ? tab.name : 'Ë¶èÂäÉÁ∏ΩË¶Ω';
            });
            
            const currentTabIcon = computed(() => {
                const tab = desktopTabs.find(t => t.id === currentTab.value);
                return tab ? tab.icon : 'ph-map-pin-line';
            });
            
            // Trip Date Mapping (Jan 21 - Jan 25, 2026)
            const tripDates = {
                1: { date: '01/21', day: 'ÈÄ±‰∏â', fullDay: '1Êúà21Êó• (ÈÄ±‰∏â)' },
                2: { date: '01/22', day: 'ÈÄ±Âõõ', fullDay: '1Êúà22Êó• (ÈÄ±Âõõ)' },
                3: { date: '01/23', day: 'ÈÄ±‰∫î', fullDay: '1Êúà23Êó• (ÈÄ±‰∫î)' },
                4: { date: '01/24', day: 'ÈÄ±ÂÖ≠', fullDay: '1Êúà24Êó• (ÈÄ±ÂÖ≠)' },
                5: { date: '01/25', day: 'ÈÄ±Êó•', fullDay: '1Êúà25Êó• (ÈÄ±Êó•)' },
            };

            // Simulated Daily Weather
            const simulatedWeather = ref({
                1: { code: 2, temp: 8, rain: 20 }, 
                2: { code: 0, temp: 12, rain: 0 }, 
                3: { code: 51, temp: 6, rain: 70 }, 
                4: { code: 1, temp: 10, rain: 10 }, 
                5: { code: 0, temp: 11, rain: 0 }, 
            });

            const filterCategories = [
                { key: 'all', name: 'ÊâÄÊúâÈ†ÖÁõÆ', icon: 'ph-list-checks', color: 'text-text' , colorCode: '#E2E8F0'},
                { key: 'food', name: 'ÁæéÈ£üÈ§êÈ£≤', icon: 'ph-fork-knife', color: 'text-accent-food', colorCode: '#EF4444' },
                { key: 'shopping', name: 'Ë≥ºÁâ©Ê∂àË≤ª', icon: 'ph-shopping-bag', color: 'text-accent-shopping', colorCode: '#3B82F6' },
                { key: 'sightseeing', name: 'ÊôØÈªûÊ¥ªÂãï', icon: 'ph-mountain', color: 'text-accent-sightseeing', colorCode: '#10B981' },
                { key: 'travel', name: '‰∫§ÈÄöÁ•®Âà∏', icon: 'ph-train-simple', color: 'text-accent-travel', colorCode: '#F59E0B' },
                { key: 'flight', name: 'Ê©üÁ•®/‰ΩèÂÆø', icon: 'ph-airplane-takeoff', color: 'text-indigo-600', colorCode: '#4F46E5' }
            ];

            const defaultLuggage = [
                { text: 'Ë≠∑ÁÖß / Á∞ΩË≠â', checked: false },
                { text: 'ÈüìÂπ£ÁèæÈáë / ‰ø°Áî®Âç°', checked: false },
                { text: 'ËΩâÊé•È†≠ (ÈüìÂúãÂúìÂ≠î)', checked: false },
                { text: 'Ë°åÂãïÈõªÊ∫ê / ÂÖÖÈõªÁ∑ö', checked: false },
                { text: 'ÁâôÂà∑ÁâôËÜè (ÈüìÂúãÁí∞‰øù‰∏çÊèê‰æõ)', checked: false },
                { text: '‰øùÊöñË°£Áâ© / ÂúçÂ∑æ', checked: false },
                { text: 'Á∂≤Âç° / eSim', checked: false }
            ];

            const defaultMustBuy = [
                { text: 'Olive Young Ë≠∑ËÜöÂìÅ', checked: false },
                { text: 'Èõ∂È£ü (ÁÉèÈæúÈ§Ö‰πæ)', checked: false },
                { text: 'Kakao Friends Âë®ÈÇä', checked: false },
                { text: 'Market O Â∏ÉÊúóÂ∞º', checked: false },
                { text: 'Ë•™Â≠ê', checked: false }
            ];

            const emergencyContacts = [
                { name: 'Ë≠¶ÂØüÂ±Ä', number: '112', desc: 'Police' },
                { name: 'Ê∂àÈò≤/ÊïëË≠∑Ëªä', number: '119', desc: 'Fire/Ambulance' },
                { name: 'ÊóÖÈÅäË´ÆË©¢ÁÜ±Á∑ö', number: '1330', desc: 'Korea Travel Hotline' }
            ];

            // Ê†πÊìö BUSAN.xlsx - Â∑•‰ΩúË°®1.csv ÈáçÊñ∞Ë¶èÂäÉË°åÁ®ã
            const updatedItinerary = [
                // Day 1: 115/01/21(‰∏â)
                { id: 101, day: 1, time: '12:00', title: 'Âà∞ÈÅîÊ°ÉÂúíÂúãÈöõÊ©üÂ†¥T2', location: 'TPE T2', desc: 'Ëæ¶ÁêÜÂ†±Âà∞„ÄÅÊâòÈÅã„ÄÅÂÖ•Èóú„ÄÇ', isFlight: false, category: 'travel' },
                { id: 102, day: 1, time: '13:55', title: 'Èï∑Ê¶ÆËà™Á©∫ BR180 ÁôªÊ©ü', location: 'TPE T2', desc: 'È†êË®à 14:25 Ëµ∑È£õ„ÄÇ', isFlight: true, category: 'flight', flightNo: 'BR180', depTime: '14:25', terminal: 'T2', gate: 'TBD', boardingTime: '13:55', type: 'departure' },
                { id: 103, day: 1, time: '17:40', title: 'ÊäµÈÅîÈáúÂ±±ÈáëÊµ∑Ê©üÂ†¥ (PUS)', location: 'PUS', desc: 'ÂèñÂæóË°åÊùéÂâçÂæÄÂú∞ÈêµÁ´ôÔºåÂæûGATE3Âá∫‰æÜ„ÄÇ', isFlight: true, category: 'flight', flightNo: 'BR180', depTime: '14:25', terminal: 'T2', gate: 'TBD', boardingTime: '13:55', type: 'departure' }, // Ê≤øÁî® BR180 ID‰ΩÜÊôÇÈñì‰∏çÂêå
                { id: 104, day: 1, time: '18:30', title: 'ËºïËªå ‚Üí Ê≤ô‰∏äÁ´ô (Sasang)', location: 'ÈáëÊµ∑Ê©üÂ†¥Á´ô', desc: 'ÂæûGATE3Ëµ∞Âà∞È¶¨Ë∑ØÂ∞çÈù¢Âè≥ËΩâÔºåÊê≠‰πòÈáëÊµ∑ËºïËªå„ÄÇ', isFlight: false, category: 'travel' },
                { id: 105, day: 1, time: '18:40', title: 'Âú∞Èêµ 2ËôüÁ∑ö ‚Üí 1ËôüÁ∑ö(ÂçóÊµ¶)', location: 'Ê≤ô‰∏äÁ´ô/Ë•øÈù¢Á´ô', desc: 'Ê≤ô‰∏äÁ´ôËΩâ‰πòÁ∂†Ëâ≤2ËôüÁ∑öÔºåË•øÈù¢Á´ôËΩâ‰πòÊ©òËâ≤1ËôüÁ∑öÂà∞Êú≠ÂòéÂÖ∂Á´ô„ÄÇ', isFlight: false, category: 'travel' },
                { id: 106, day: 1, time: '19:05', title: 'NewCZÂçóÊµ¶Â∫ó Check In', location: 'Êú≠ÂòéÂÖ∂Á´ô 7ËôüÂá∫Âè£', desc: '5ËôüÂá∫Âè£ÊúâÈõªÊ¢ØÂèØÊê≠ÔºåÂá∫ÈõªÊ¢ØÁõ¥Ëµ∞ÈÅé7ËôüÂá∫Âè£Â∑¶ËΩâ„ÄÇ', isFlight: false, category: 'travel' },
                { id: 107, day: 1, time: '20:00', title: 'ÊôöÈ§êËàáÂ§úÈñìÈÄõË°ó', location: 'ÂçóÊµ¶Ê¥û/Êú≠ÂòéÂÖ∂/ÂúãÈöõÂ∏ÇÂ†¥', desc: 'ÊôöÈ§êÂª∫Ë≠∞ÔºöÂçóÊµ¶ËîòÈõûÊπØ Êàñ ÂÖÉÁ•ñÈáúÂ±±Ë±¨ËÖ≥„ÄÇ', isFlight: false, category: 'food' },

                // Day 2: 115/01/22(Âõõ)
                { id: 201, day: 2, time: '09:30', title: 'È£ØÂ∫óÂá∫Áôº ‚Üí ÊùæÂ≥∂Á∑ö', location: 'Êú≠ÂòéÂÖ∂Á´ô', desc: 'Âª∫Ë≠∞Êê≠Ë®àÁ®ãËªäÔºåÁ¥Ñ 5 ÂàÜÈêòÊäµÈÅîÊùæÂ≥∂„ÄÇ', isFlight: false, category: 'travel' },
                { id: 202, day: 2, time: '09:30', title: 'ÊùæÂ≥∂Â§©Á©∫Ê≠•ÈÅì', location: 'ÊùæÂ≥∂', desc: 'Êó©‰∏äÂÖâÁ∑öËàíÊúç„ÄÅ‰∫∫ÊØîËºÉÂ∞ë„ÄÇËµ∞ÂÆåÁ¥Ñ 20-30 ÂàÜÈêò„ÄÇ', isFlight: false, category: 'sightseeing' },
                { id: 203, day: 2, time: '10:20', title: 'ÊùæÂ≥∂Êµ∑‰∏äÁ∫úËªä (Air Cruise)', location: 'ÊùæÂ≥∂', desc: 'Âª∫Ë≠∞Êê≠‰æÜÂõûÁ∫úËªäÔºåÁ¥Ñ 1 Â∞èÊôÇÁµêÊùü„ÄÇ', isFlight: false, category: 'sightseeing' },
                { id: 204, day: 2, time: '11:30', title: 'ÂçàÈ§ê (Ê®ÇÂ§©ÁôæË≤®)', location: 'Ê®ÇÂ§©ÁôæË≤®ÂÖâÂæ©Â∫ó', desc: 'ÂêÉÂÆåÂèØËá≥È†ÇÊ®ìÁúãÂΩ±Â≥∂Â§ßÊ©ã„ÄÇ', isFlight: false, category: 'food' },
                { id: 205, day: 2, time: '14:00', title: 'ËßÄË≥ûÂΩ±Â≥∂Â§ßÊ©ãÈñãÊ©ã', location: 'Ê®ÇÂ§©ÁôæË≤®ÂÖâÂæ©Â∫óÈ†ÇÊ®ì (ÊòüÂÖâËä±Âúí)', desc: '14:00 Ê∫ñÊôÇÈñãÊ©ãÔºåÊèêÊó© 10-15 ÂàÜÈêòÂà∞Âç°‰Ωç„ÄÇ', isFlight: false, category: 'sightseeing' },
                { id: 206, day: 2, time: '15:00', title: 'ÁôΩÊ∑∫ÁÅòÊñáÂåñÊùë', location: 'Ìù∞Ïó¨Ïö∏Î¨∏ÌôîÎßàÏùÑ', desc: 'ÁúãÂÆåÈñãÊ©ãÊê≠Ë®àÁ®ãËªä 10-12 ÂàÜÈêòÊäµÈÅî„ÄÇÂæàÂ•ΩÊãçÁÖß„ÄÇ', isFlight: false, category: 'sightseeing' },
                { id: 207, day: 2, time: '17:00', title: 'ÊôöÈ§êËàáË•øÈù¢ÈÄõË°ó', location: 'Ë•øÈù¢Á´ô', desc: 'ÊôöÈ§êÂª∫Ë≠∞ÁÉ§ËÇâÔºàË•øÈù¢Á´ôÁÉ§ËÇâÂõõÂ§©ÁéãÔºâ„ÄÇÈÄõÔºöË•øÈù¢Âú∞‰∏ãË°óÊñáÂâµÂ∫ó„ÄÅÂ§ßÂâµÁôæË≤®„ÄÇ', isFlight: false, category: 'food' },

                // Day 3: 115/01/23(‰∫î) (KKdayË°åÁ®ã)
                { id: 301, day: 3, time: '09:00', title: 'KKdayË°åÁ®ãÈõÜÂêàÂá∫Áôº', location: 'ÈáúÂ±±Á´ô1ËôüÂá∫Âè£', desc: 'ÈõÜÂêàÂâçÂæÄÊÖ∂Â∑û (‰ΩõÂúãÂØ∫„ÄÅÂ§ßÈôµÈô¢+ÁöáÁêÜÂúòË∑Ø„ÄÅÊù±ÂÆÆËàáÊúàÊ±†)„ÄÇ', isFlight: false, category: 'travel' },
                { id: 302, day: 3, time: '10:30', title: 'Â§©Á©∫ËÜ†Âõä (ËóçÁ∑öÂÖ¨Âúí)', location: 'Êµ∑ÈÇäÂàóËªä', desc: 'KKdayË°åÁ®ãÂÆâÊéí„ÄÇ', isFlight: false, category: 'sightseeing' },
                { id: 303, day: 3, time: '13:10', title: 'Êµ∑Êù±ÈæçÂÆÆÂØ∫', location: 'Ìï¥ÎèôÏö©Í∂ÅÏÇ¨', desc: 'KKdayË°åÁ®ãÂÆâÊéí„ÄÇ', isFlight: false, category: 'sightseeing' },
                { id: 304, day: 3, time: '21:50', title: 'ËøîÂõûÈáúÂ±±Á´ô', location: 'Ë•øÈù¢Á´ôÊèêÂâç‰∏ãËªä', desc: 'ÂèØÂú®Ë•øÈù¢Á´ôÊèêÂâç‰∏ãËªäÔºåÈÄõË•øÈù¢ÁöÑÂ§ßÂâµ2ËôüÂ∫ó„ÄÇ', isFlight: false, category: 'travel' },
                { id: 305, day: 3, time: '22:30', title: 'ÂÆµÂ§ú/ÂõûÈ£ØÂ∫ó', location: 'Ë•øÈù¢/ÂçóÊµ¶Ê¥û', desc: 'Ë•øÈù¢Â§ßÂâµ2ËôüÂ∫óÂõõÂ±§Ê®ìÂèØÈÄõ„ÄÇ', isFlight: false, category: 'shopping' },

                // Day 4: 115/01/24(ÂÖ≠)
                { id: 401, day: 4, time: '08:00', title: 'È£ØÂ∫óÂá∫Áôº ‚Üí Êµ∑Èõ≤Âè∞', location: 'ÂçóÊµ¶Ê¥û', desc: 'Âú∞ÈêµÁ¥Ñ 50 ÂàÜÈêòÔºåË®àÁ®ãËªäÁ¥Ñ 20000 KRW„ÄÇ', isFlight: false, category: 'travel' },
                { id: 402, day: 4, time: '10:30', title: 'Êù±ÈáúÂ±±Ê®ÇÂ§©OUTLET', location: 'Êù±ÈáúÂ±±', desc: 'ÊàñÂèØÁé©ÊóÅÈÇäÁöÑÊªëËªä(Ëã•‰∏çÊÄïÂÜ∑)„ÄÇ', isFlight: false, category: 'shopping' },
                { id: 403, day: 4, time: '13:55', title: 'Êµ∑Èõ≤Âè∞ÂÇ≥Áµ±Â∏ÇÂ†¥', location: 'Êµ∑Èõ≤Âè∞', desc: 'ÂêÉÂè§‰æÜÂè∏È≠öÁ≥ï / 31ÂÖ¨ÂàÜÊµ∑ÈÆÆÊπØÈ∫µ / ÈÄõÂÇ≥Áµ±Â∏ÇÂ†¥„ÄÇ', isFlight: false, category: 'food' },
                { id: 404, day: 4, time: '14:25', title: 'Êñ∞‰∏ñÁïåÁôæË≤® (Centum City)', location: 'Centum City', desc: '‰∏ªË¶ÅÈÄõË°óË≥ºÁâ©„ÄÇ', isFlight: false, category: 'shopping' },
                { id: 405, day: 4, time: '15:30', title: 'SPA LAND Ê±óËí∏Âπï', location: 'Êñ∞‰∏ñÁïåÁôæË≤® B1', desc: 'È†êË®àÂÅúÁïô 2-3 Â∞èÊôÇ„ÄÇ', isFlight: false, category: 'sightseeing' },
                { id: 406, day: 4, time: '18:30', title: 'ÊôöÈ§êÂêÉÁÉ§ËÇâ', location: 'Ë•øÈù¢Á´ô', desc: 'ÁÉ§ËÇâÁöÑÁî∑Â≠ê„ÄÅÂë≥Ë¥äÁéã„ÄÅÈáúÂ±±ÂÆÖÁÉ§ËÇâÁ≠â„ÄÇ', isFlight: false, category: 'food' },
                { id: 407, day: 4, time: '18:40', title: 'Ë•øÈù¢Á´ôÈÄõË°ó', location: 'Ë•øÈù¢', desc: 'Ë•øÈù¢Âú∞‰∏ãË°óÊñáÂâµÂ∫ó / Â§ßÂâµÁôæË≤®„ÄÇ', isFlight: false, category: 'shopping' },

                // Day 5: 115/01/25(Êó•)
                { id: 501, day: 5, time: '08:00', title: 'Êó©È§ê + Êï¥ÁêÜË°åÊùé', location: 'È£ØÂ∫ó/ÈôÑËøë', desc: 'Ë°åÊùéÂØÑÊîæÂú®È£ØÂ∫óÊ´ÉÊ™Ø„ÄÇ', isFlight: false, category: 'food' },
                { id: 502, day: 5, time: '09:15', title: 'ÁîòÂ∑ùÊ¥ûÊñáÂåñÊùëÊï£Á≠ñ', location: 'Í∞êÏ≤úÎ¨∏ÌôîÎßàÏùÑ', desc: 'Âª∫Ë≠∞Êê≠Ë®àÁ®ãËªäÔºåÂæûÂ∞èÁéãÂ≠êÊãçÁÖßÈªûÈñãÂßã„ÄÇÂÅúÁïôÁ¥Ñ 2 Â∞èÊôÇ„ÄÇ', isFlight: false, category: 'sightseeing' },
                { id: 503, day: 5, time: '11:30', title: 'Êê≠Ë®àÁ®ãËªäËøîÂõûÂçóÊµ¶Ê¥û', location: 'ÂçóÊµ¶Ê¥û', desc: 'ËªäË≥áÁ¥Ñ 6,000‚Äì8,000 ÈüìÂπ£„ÄÇ', isFlight: false, category: 'travel' },
                { id: 504, day: 5, time: '12:00', title: 'ÂçàÈ§ê (ÂçóÊµ¶Ê¥û)', location: 'ÂçóÊµ¶Ê¥û', desc: 'ÊúÄÂæåÁöÑÈÄõË°óËàáÁî®È§êÊôÇÈñì„ÄÇ', isFlight: false, category: 'food' },
                { id: 505, day: 5, time: '16:00', title: 'È£ØÂ∫óÂèñË°åÊùé', location: 'NewCZÂçóÊµ¶Â∫ó', desc: 'Ê∫ñÂÇôÂâçÂæÄÈáëÊµ∑Ê©üÂ†¥„ÄÇ', isFlight: false, category: 'travel' },
                { id: 506, day: 5, time: '17:00', title: 'ÊäµÈÅîÈáúÂ±±ÈáëÊµ∑Ê©üÂ†¥', location: 'PUS', desc: 'Ëæ¶ÁêÜÈÄÄÁ®Ö„ÄÅCheck In„ÄÇ', isFlight: false, category: 'travel' },
                { id: 507, day: 5, time: '18:55', title: 'ÂõûÁ®ã: Èï∑Ê¶ÆËà™Á©∫ BR163 (ÈáúÂ±±‚ÜíÊ°ÉÂúí)', location: 'Gimhae International Airport', desc: 'È†êË®à 20:25 ÊäµÈÅîÊ°ÉÂúíÊ©üÂ†¥ T2„ÄÇ', isFlight: true, category: 'flight', flightNo: 'BR163', depTime: '18:55', terminal: 'Intl', gate: 'TBD', boardingTime: '18:25', type: 'return' },
            ];


            const itinerary = ref([]);
            
            // --- Lifecycle ---
            onMounted(() => {
                newExpense.value.date = new Date().toISOString().split('T')[0];

                // Load from LocalStorage (Using v10 key)
                const savedItinerary = localStorage.getItem('busan_2026_v10_itinerary'); 
                const savedExpenses = localStorage.getItem('busan_2026_v10_expenses');
                const savedRate = localStorage.getItem('busan_2026_rate_v10');
                const savedLuggage = localStorage.getItem('busan_2026_luggage_v10');
                const savedMustBuy = localStorage.getItem('busan_2026_mustbuy_v10');
                
                // Use updated itinerary
                itinerary.value = savedItinerary ? JSON.parse(savedItinerary) : updatedItinerary;
                if (savedExpenses) expenses.value = JSON.parse(savedExpenses);
                if (savedRate && parseFloat(savedRate) > 0) {
                     exchangeRate.value = parseFloat(savedRate);
                } else {
                     exchangeRate.value = 41.5; 
                }
                luggageList.value = savedLuggage ? JSON.parse(savedLuggage) : defaultLuggage;
                mustBuyList.value = savedMustBuy ? JSON.parse(savedMustBuy) : defaultMustBuy;
            });

            // --- Watchers for Auto-Save ---
            watch([itinerary, expenses, exchangeRate, luggageList, mustBuyList], () => {
                // Save with v10 key
                localStorage.setItem('busan_2026_v10_itinerary', JSON.stringify(itinerary.value));
                localStorage.setItem('busan_2026_v10_expenses', JSON.stringify(expenses.value));
                localStorage.setItem('busan_2026_rate_v10', exchangeRate.value);
                localStorage.setItem('busan_2026_luggage_v10', JSON.stringify(luggageList.value));
                localStorage.setItem('busan_2026_mustbuy_v10', JSON.stringify(mustBuyList.value));
            }, { deep: true });

            // --- Computed ---

            // Step 1: Filter by Day
            const filteredItinerary = computed(() => {
                return itinerary.value
                    .filter(item => item.day === activeDay.value)
                    .sort((a, b) => a.time.localeCompare(b.time));
            });

            // Step 2: Filter by Category (if activeCategory is not 'all')
            const filteredItineraryByCat = computed(() => {
                if (activeCategory.value === 'all') {
                    return filteredItinerary.value;
                }
                return filteredItinerary.value.filter(item => item.category === activeCategory.value);
            });
            
            // Utility function to convert KRW to TWD
            const convertKRWToTWD = (krwAmount) => {
                const krw = Number(krwAmount) || 0;
                const rate = Number(exchangeRate.value);
                if (rate <= 0 || isNaN(rate)) return 0;
                return Math.round(krw / rate);
            };

            // Expense Computed Properties (REFACTORED)
            const totalExpenseKRW = computed(() => {
                // Only sum non-flight/non-accommodation expenses
                return expenses.value
                    .filter(item => item.category !== 'flight')
                    .reduce((sum, item) => sum + (Number(item.amount) || 0), 0);
            });
            
            const totalExpenseTWD = computed(() => {
                return convertKRWToTWD(totalExpenseKRW.value);
            });
            
            const calculatedTWD = computed(() => {
                return convertKRWToTWD(calcKRW.value);
            });
            
            const newExpenseTWD = computed(() => {
                 return convertKRWToTWD(newExpense.value.amount);
            });

            // Flight Info Extraction
            const flightInfo = computed(() => {
                const dep = updatedItinerary.find(i => i.isFlight && i.type === 'departure');
                const ret = updatedItinerary.find(i => i.isFlight && i.type === 'return');
                
                const defaultDep = { flightNo: 'BR180', depAirport: 'TPE', arrAirport: 'PUS', depTime: '14:25', terminal: 'T2', gate: 'TBD', boardingTime: '13:55' };
                const defaultRet = { flightNo: 'BR163', depAirport: 'PUS', arrAirport: 'TPE', depTime: '18:55', terminal: 'Intl', gate: 'TBD', boardingTime: '18:25' };

                return {
                    departure: dep || defaultDep,
                    return: ret || defaultRet
                };
            });

            // Hotel Info Extraction (based on the provided file)
            const hotelInfo = computed(() => {
                return {
                    name: 'NewCZÂçóÊµ¶Â∫ó',
                    address: 'ÈáúÂ±±Âª£ÂüüÂ∏Ç‰∏≠ÂçÄÂÖâÂæ©Ë∑Ø8ËôüË°ó 32 / Î∂ÄÏÇ∞Í¥ëÏó≠Ïãú Ï§ëÍµ¨ Í¥ëÎ≥µÎ°ú8Î≤àÍ∏∏ 32', // Used placeholder address based on description
                };
            });


            // --- Methods ---
            
            // Utility Methods
            const getDayInfo = (dayIndex) => tripDates[dayIndex] || { date: `Day ${dayIndex}`, day: '', fullDay: `Day ${dayIndex}` };
            
            const getCategoryName = (key) => filterCategories.find(c => c.key === key)?.name || 'Êú™Áü•';
            const getCategoryColor = (key) => filterCategories.find(c => c.key === key)?.color || 'text-text/50';

            const openModal = (item) => {
                if (item) {
                    isEditMode.value = true;
                    if (item.isFlight) return alert('Ëà™Áè≠Ë≥áË®äË´ãÂú®„ÄåÊ©üÁ•®/‰ΩèÂÆø„ÄçÈ†ÅÈù¢‰∏≠Ê™¢Ë¶ñÔºåÁÑ°Ê≥ï‰øÆÊîπ„ÄÇ'); 

                    modalForm.value = { ...item };
                } else {
                    isEditMode.value = false;
                    // Auto-fill time to current Day's last event + 1 hour, or default
                    const lastEvent = filteredItinerary.value.at(-1);
                    const defaultTime = lastEvent ? incrementTime(lastEvent.time) : '12:00';

                    modalForm.value = { id: Date.now(), time: defaultTime, title: '', location: '', desc: '', category: 'sightseeing' };
                }
                showModal.value = true;
            };

            const saveItem = () => {
                if (!modalForm.value.title || !modalForm.value.category) return;
                const newItem = { 
                    ...modalForm.value, 
                    day: activeDay.value, 
                    location: modalForm.value.location || modalForm.value.title, 
                    isFlight: false 
                };

                if (isEditMode.value) {
                    const index = itinerary.value.findIndex(i => i.id === modalForm.value.id);
                    if (index !== -1) itinerary.value[index] = newItem;
                } else {
                    itinerary.value.push(newItem);
                }
                showModal.value = false;
            };

            const deleteItem = (id) => {
                if(confirm('Á¢∫ÂÆöÂà™Èô§Ê≠§Ë°åÁ®ãÂóéÔºü')) itinerary.value = itinerary.value.filter(item => item.id !== id);
            };

            // Helper function for time increment
            const incrementTime = (timeStr) => {
                const [h, m] = timeStr.split(':').map(Number);
                const date = new Date();
                date.setHours(h);
                date.setMinutes(m);
                date.setHours(date.getHours() + 1);
                const newH = String(date.getHours()).padStart(2, '0');
                const newM = String(date.getMinutes()).padStart(2, '0');
                return `${newH}:${newM}`;
            };
            
            // Expense Methods (REFACTORED)
            const addExpense = () => {
                const amount = Number(newExpense.value.amount);
                if (!newExpense.value.item || isNaN(amount) || amount <= 0 || !newExpense.value.category) {
                    return;
                }
                
                // Unshift adds to the beginning (LIFO - Last In, First Out)
                expenses.value.unshift({
                    date: newExpense.value.date || new Date().toISOString().split('T')[0],
                    item: newExpense.value.item,
                    amount: amount, 
                    category: newExpense.value.category
                });
                // Reset form fields
                newExpense.value.item = '';
                newExpense.value.amount = null; 
                newExpense.value.category = ''; 
            };

            const removeExpense = (index) => {
                if(confirm('Á¢∫ÂÆöÂà™Èô§ÈÄôÁ≠ÜË®òÂ∏≥Á¥ÄÈåÑÂóéÔºü')) expenses.value.splice(index, 1);
            };

            // Checklist Methods (Luggage & Must-Buy)
            const addLuggage = () => {
                if(!newLuggageItem.value) return;
                luggageList.value.push({ text: newLuggageItem.value, checked: false });
                newLuggageItem.value = '';
            };
            const removeLuggage = (index) => {
                luggageList.value.splice(index, 1);
            };
            const addMustBuy = () => {
                if(!newMustBuyItem.value) return;
                mustBuyList.value.push({ text: newMustBuyItem.value, checked: false });
                newMustBuyItem.value = '';
            };
            const removeMustBuy = (index) => {
                mustBuyList.value.splice(index, 1);
            };

            // Map Methods
            const searchNaverMap = () => {
                const q = mapQuery.value || 'Busan';
                window.open(`https://map.naver.com/p/search/${encodeURIComponent(q)}`, '_blank');
            };
            const searchGoogleMap = () => {
                const q = mapQuery.value || 'Busan';
                // Using a safe, general search URL for Google Maps
                window.open(`https://www.google.com/maps/search/$${encodeURIComponent(q)}`, '_blank');
            };
            const getNaverMapLink = (query) => `https://map.naver.com/p/search/${encodeURIComponent(query)}`;
            
            const formatNumber = (num) => {
                if (num === null || num === undefined) return '0';
                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            };

            // Weather Icon Mapping (Simple)
            const getWeatherIcon = (code) => {
                if (code === 0) return '‚òÄÔ∏è'; 
                if (code === 1) return 'üå•Ô∏è'; 
                if (code <= 3) return '‚òÅÔ∏è'; 
                if (code <= 67) return 'üåßÔ∏è'; 
                return 'üå•Ô∏è'; 
            };

            return {
                currentTab, activeDay, currentTabName, currentTabIcon, activeCategory,
                showModal, isEditMode, modalForm,
                itinerary, expenses, exchangeRate, filteredItineraryByCat,
                totalExpenseTWD, totalExpenseKRW, newExpense, newExpenseTWD, mapQuery,
                calcKRW, calculatedTWD,
                luggageList, newLuggageItem, mustBuyList, newMustBuyItem,
                flightInfo, hotelInfo, emergencyContacts, simulatedWeather, 
                desktopTabs, mobileTabs, filterCategories,
                openModal, saveItem, deleteItem, addExpense, removeExpense, convertKRWToTWD,
                addLuggage, removeLuggage, addMustBuy, removeMustBuy,
                formatNumber, searchNaverMap, searchGoogleMap, getNaverMapLink, getWeatherIcon, getDayInfo,
                getCategoryName, getCategoryColor
            };
        }
    }).mount('#app');
</script>
</body>
</html>
