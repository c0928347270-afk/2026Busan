<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Busan Trip Handbook üíñ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Hachi+Maru+Pop&family=Nunito:wght@400;700;900&family=Noto+Sans+TC:wght@500;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        macaron: {
                            pink: '#FFC8DD',
                            blue: '#A2D2FF',
                            yellow: '#FDFD96',
                            green: '#BDE0FE',
                            mint: '#C1E1C1',
                            purple: '#CDB4DB',
                            dark: '#555555'
                        }
                    },
                    fontFamily: {
                        // Using a cute/playful font mix
                        cute: ['"Hachi Maru Pop"', '"Nunito"', '"Noto Sans TC"', 'sans-serif'],
                        body: ['"Nunito"', '"Noto Sans TC"', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Hachi Maru Pop', 'Nunito', 'Noto Sans TC', sans-serif;
            background-color: #F8F8FF; /* Light Lavender Background */
            color: #555;
            -webkit-tap-highlight-color: transparent;
        }
        
        .cute-card {
            background: #FFFFFF;
            border-radius: 20px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.05); /* Softer Shadow */
            border: 2px solid #FFF0F5;
            transition: transform 0.2s;
        }

        .btn-press {
            transition: all 0.1s;
        }
        .btn-press:active {
            transform: scale(0.95);
        }

        /* Hide Scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .tab-active {
            color: #FF6B6B;
            transform: scale(1.1);
        }

        /* Boarding Pass Style */
        .boarding-pass {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 5px solid #A2D2FF;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        .boarding-pass::after {
            content: '';
            position: absolute;
            top: 20px;
            right: 0;
            width: 10px;
            height: calc(100% - 40px);
            background: repeating-linear-gradient(to bottom, #F8F8FF 0, #F8F8FF 5px, transparent 5px, transparent 10px);
            border-left: 2px dashed #CDB4DB;
        }

        /* Checklist Custom Style (Reusing previous cute style) */
        .custom-checkbox {
            appearance: none;
            background-color: #fff;
            margin: 0;
            font: inherit;
            color: currentColor;
            width: 1.2em;
            height: 1.2em;
            border: 2px solid #CDB4DB;
            border-radius: 0.35em;
            display: grid;
            place-content: center;
        }
        .custom-checkbox::before {
            content: "";
            width: 0.65em;
            height: 0.65em;
            transform: scale(0);
            transition: 120ms transform ease-in-out;
            box-shadow: inset 1em 1em #CDB4DB;
            transform-origin: center;
            clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
        }
        .custom-checkbox:checked::before {
            transform: scale(1);
        }
        
        /* Currency Calculator Fix */
        .calc-input {
            width: 100%;
            text-align: right;
            font-size: 1.75rem; /* text-3xl */
            font-weight: 900; /* font-black */
            outline: none;
            padding: 0;
            line-height: 1;
            background: none;
            border: none;
        }
        .calc-input::placeholder {
            color: #E5E7EB;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden text-gray-700">

<div id="app" class="flex flex-col h-full">

    <header class="pt-8 pb-4 px-5 z-10 relative overflow-hidden flex justify-between items-center">
        <div>
            <h1 class="text-3xl font-black text-gray-800 tracking-wide leading-tight flex items-center gap-2">
                2026 ÈüìÂúãÈáúÂ±± 5 Êó•ÈÅä
                <i class="ph ph-paper-plane-tilt text-macaron-pink text-2xl"></i>
            </h1>
            <p class="text-sm font-body text-gray-700 font-bold opacity-70 mt-0.5">Jan 21 - Jan 25, 2026</p>
        </div>
    </header>

    <main class="flex-1 overflow-y-auto p-5 pt-2 pb-28 space-y-5">
        
        <div v-if="currentTab === 'itinerary'" class="space-y-4">
            <div class="flex space-x-3 overflow-x-auto pb-2 no-scrollbar px-1">
                <button v-for="i in 5" :key="i" 
                    @click="activeDay = i"
                    :class="activeDay === i ? 'bg-macaron-blue text-white ring-2 ring-macaron-blue ring-offset-2' : 'bg-white text-gray-400 border border-gray-100'"
                    class="flex-shrink-0 w-16 h-16 rounded-3xl flex flex-col items-center justify-center shadow-md transition-all duration-300 btn-press">
                    <span class="text-[10px] uppercase font-bold">Day</span>
                    <span class="text-xl font-black leading-none">{{ i }}</span>
                    <span class="text-xs mt-1">{{ getWeatherIcon(simulatedWeather[i].code) }}</span>
                </button>
            </div>

            <div class="space-y-4 pt-2">
                <div class="flex justify-between items-center px-1 mb-2">
                    <h2 class="text-lg font-bold text-gray-800">Day {{ activeDay }} Ë°åÁ®ã</h2>
                    <div class="flex items-center gap-1.5 text-sm font-bold bg-macaron-yellow/50 px-3 py-1.5 rounded-full border border-yellow-100 shadow-sm">
                        <span class="text-xl leading-none">{{ getWeatherIcon(simulatedWeather[activeDay].code) }}</span>
                        <span class="font-body text-gray-700">{{ simulatedWeather[activeDay].temp }}¬∞</span>
                    </div>
                </div>

                <div v-if="filteredItinerary.length === 0" class="text-center py-10 text-gray-400 cute-card">
                    <p>ÈªûÊìäÂè≥‰∏ãËßíÊåâÈàïÊñ∞Â¢ûË°åÁ®ã ‚ú®</p>
                </div>

                <div v-for="item in filteredItinerary" :key="item.id" 
                    class="cute-card p-4 flex gap-3 relative group"
                    :class="{'bg-blue-50/50 border-blue-100': item.isFlight, 'bg-white border-white': !item.isFlight}">
                    
                    <div class="flex flex-col items-center min-w-[60px] flex-shrink-0">
                        <span class="bg-macaron-pink px-2 py-1 rounded-lg text-xs font-bold text-white shadow-md border border-pink-100 font-mono">
                            {{ item.time }}
                        </span>
                        <div class="h-full w-0.5 bg-gray-200 my-2 border-l-2 border-dotted"></div>
                    </div>

                    <div class="flex-1 pb-1 min-w-0">
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-[16px] text-gray-800 leading-tight pr-6">{{ item.title }}</h3>
                            <div class="flex gap-2 flex-shrink-0">
                                <button @click="openModal(item)" class="text-gray-400 hover:text-blue-500 btn-press p-1">
                                    <i class="ph ph-pencil-simple text-lg"></i>
                                </button>
                                <button v-if="!item.isFlight" @click="deleteItem(item.id)" class="text-gray-400 hover:text-red-400 btn-press p-1">
                                    <i class="ph ph-trash text-lg"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="mt-1 flex items-center text-xs text-gray-500 font-medium font-body">
                            <i v-if="item.isFlight" class="ph ph-airplane-tilt mr-1 text-blue-400"></i>
                            <i v-else class="ph ph-map-pin mr-1 text-gray-400"></i>
                            <span class="truncate">{{ item.location }}</span>
                        </div>

                        <p v-if="item.desc" class="text-xs text-gray-600 mt-2 bg-gray-50/60 p-2 rounded-xl inline-block border border-gray-100 w-full whitespace-pre-wrap font-body">
                           {{ item.desc }}
                        </p>

                        <a v-if="!item.isFlight" :href="getNaverMapLink(item.location)" target="_blank" 
                           class="mt-3 inline-flex items-center text-[10px] font-bold text-gray-700 bg-macaron-mint px-3 py-1.5 rounded-full shadow-sm hover:bg-green-300 transition-colors btn-press font-body">
                            <i class="ph ph-navigation-arrow"></i> Naver Map
                        </a>
                    </div>
                </div>
            </div>
            
            <button @click="openModal(null)" class="fixed bottom-24 right-5 bg-gray-800 text-white w-14 h-14 rounded-full shadow-xl flex items-center justify-center text-2xl z-20 hover:scale-105 transition-transform btn-press border-4 border-white">
                <i class="ph ph-plus"></i>
            </button>
        </div>

        <div v-if="currentTab === 'money'" class="space-y-6">
            <div>
                <div class="flex justify-between items-end mb-2 px-1">
                    <h3 class="font-bold text-gray-700"><i class="ph ph-calculator text-macaron-purple"></i> ÂåØÁéáË®àÁÆóÊ©ü</h3>
                    <div class="flex items-center gap-2 bg-white px-3 py-1 rounded-xl border border-gray-200 shadow-sm">
                        <span class="text-[10px] text-gray-400 font-body">ÁõÆÂâçÂåØÁéá</span>
                        <input v-model.number="exchangeRate" type="number" class="w-12 text-right font-bold text-sm outline-none text-blue-500 font-body" min="1" step="0.1">
                    </div>
                </div>
                
                <div class="cute-card p-5 bg-gradient-to-r from-gray-50 to-white space-y-3">
                    <div class="flex items-center border-b border-gray-200 pb-2">
                        <span class="text-gray-400 font-bold w-16 text-sm font-body">KRW (‚Ç©)</span>
                        <input v-model.number="calcKRW" type="number" placeholder="0" class="calc-input text-gray-800 font-body">
                    </div>
                    <div class="flex items-center pt-2">
                        <span class="text-gray-400 font-bold w-16 text-sm font-body">TWD (NT$)</span>
                        <div class="w-full text-right text-3xl font-black text-macaron-purple font-body">
                            {{ formatNumber(calculatedTWD) }}
                        </div>
                    </div>
                </div>
            </div>

            <div class="space-y-3">
                <div class="flex justify-between items-end px-1 border-t border-gray-200 pt-6">
                    <h3 class="font-bold text-gray-700"><i class="ph ph-receipt text-macaron-purple"></i> ÊîØÂá∫Ë®òÂ∏≥</h3>
                    <div class="text-right">
                        <p class="text-[10px] text-gray-400 font-body">Á∏ΩÊîØÂá∫</p>
                        <p class="font-bold text-xl text-blue-500 font-body">NT$ {{ formatNumber(totalExpenseTWD) }}</p>
                    </div>
                </div>

                <div class="cute-card p-3 flex flex-col gap-2 bg-gray-50 border-dashed border-gray-200">
                    <div class="flex gap-2">
                        <input type="date" v-model="newExpense.date" class="bg-white p-2 rounded-xl text-xs outline-none border w-1/3 text-center font-body shadow-sm">
                        <input v-model="newExpense.item" placeholder="ÂìÅÈ†ÖÂêçÁ®±" class="bg-white p-2 rounded-xl text-xs outline-none border flex-1 font-body shadow-sm">
                    </div>
                    <div class="flex gap-2">
                        <div class="relative flex-1">
                            <input v-model.number="newExpense.amount" type="number" placeholder="ÈüìÂπ£ÈáëÈ°ç" class="w-full bg-white p-2 pl-6 rounded-xl text-sm outline-none border font-body shadow-sm">
                            <span class="absolute left-2 top-2.5 text-xs text-gray-400">‚Ç©</span>
                        </div>
                        <button @click="addExpense" class="bg-macaron-purple text-white px-4 rounded-xl font-bold text-xs shadow-md btn-press whitespace-nowrap font-body">Êñ∞Â¢û</button>
                    </div>
                </div>

                <div class="space-y-2 pb-8">
                    <div v-for="(exp, index) in expenses" :key="index" class="bg-white p-3 rounded-xl shadow-md border border-gray-100 flex justify-between items-center">
                        <div class="flex flex-col">
                            <span class="text-sm font-bold text-gray-800">{{ exp.item }}</span>
                            <span class="text-[10px] text-gray-400 font-body">{{ exp.date.slice(5) }}</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="text-right font-body">
                                <p class="font-bold text-gray-400 text-xs">‚Ç©{{ formatNumber(exp.amount) }}</p>
                                <p class="text-sm font-bold text-blue-500">NT$ {{ formatNumber(Math.round(exp.amount / exchangeRate)) }}</p>
                            </div>
                            <button @click="removeExpense(index)" class="text-gray-300 hover:text-red-400 p-1 btn-press"><i class="ph ph-x-circle"></i></button>
                        </div>
                    </div>
                    <div v-if="expenses.length === 0" class="text-center text-xs text-gray-300 py-4 font-body">
                        ÈÇÑÊ≤íÊúâË®òÂ∏≥Á¥ÄÈåÑÂñî
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'info'" class="space-y-6">
            <h3 class="font-bold text-gray-700 px-1"><i class="ph ph-airplane-takeoff text-macaron-blue"></i> Ëà™Áè≠Ë≥áË®ä (ÁôªÊ©üË≠â)</h3>

            <div class="cute-card p-5 boarding-pass relative">
                <div class="absolute top-0 right-10 text-6xl opacity-10 rotate-12 text-blue-400"><i class="ph ph-airplane-tilt"></i></div>
                <div class="flex justify-between items-center mb-4 border-b border-dashed border-blue-200 pb-3">
                    <h2 class="text-xl font-black text-gray-800 font-body">ÂéªÁ®ã Boarding Pass</h2>
                    <span class="text-2xl font-black text-blue-500 font-mono">{{ flightInfo.departure.flightNo }}</span>
                </div>

                <div class="grid grid-cols-2 gap-x-4 gap-y-3 font-body text-sm">
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400 uppercase">Departure</span>
                        <span class="font-bold text-gray-800">{{ flightInfo.departure.depAirport }} (TPE)</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400 uppercase">Arrival</span>
                        <span class="font-bold text-gray-800">{{ flightInfo.departure.arrAirport }} (PUS)</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400 uppercase">Gate / Time</span>
                        <span class="font-bold text-gray-800">{{ flightInfo.departure.gate }} / {{ flightInfo.departure.depTime }}</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400 uppercase">Date</span>
                        <span class="font-bold text-gray-800">Jan 21, 2026</span>
                    </div>
                </div>
            </div>
            
            <div class="cute-card p-5 boarding-pass relative">
                <div class="absolute top-0 right-10 text-6xl opacity-10 -rotate-12 text-pink-400"><i class="ph ph-airplane-tilt"></i></div>
                <div class="flex justify-between items-center mb-4 border-b border-dashed border-pink-200 pb-3">
                    <h2 class="text-xl font-black text-gray-800 font-body">ÂõûÁ®ã Boarding Pass</h2>
                    <span class="text-2xl font-black text-pink-500 font-mono">{{ flightInfo.return.flightNo }}</span>
                </div>

                <div class="grid grid-cols-2 gap-x-4 gap-y-3 font-body text-sm">
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400 uppercase">Departure</span>
                        <span class="font-bold text-gray-800">{{ flightInfo.return.depAirport }} (PUS)</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400 uppercase">Arrival</span>
                        <span class="font-bold text-gray-800">{{ flightInfo.return.arrAirport }} (TPE)</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400 uppercase">Gate / Time</span>
                        <span class="font-bold text-gray-800">{{ flightInfo.return.gate }} / {{ flightInfo.return.depTime }}</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400 uppercase">Date</span>
                        <span class="font-bold text-gray-800">Jan 25, 2026</span>
                    </div>
                </div>
            </div>


            <h3 class="font-bold text-gray-700 pt-4 px-1"><i class="ph ph-buildings text-macaron-purple"></i> ‰ΩèÂÆøË≥áË®ä</h3>
            <div class="cute-card p-5 bg-white shadow-md relative overflow-hidden">
                <div class="flex items-center mb-3">
                    <i class="ph ph-bed text-xl text-macaron-purple mr-2"></i>
                    <h2 class="text-lg font-bold text-gray-800 leading-tight">{{ hotelInfo.name }}</h2>
                </div>
                <div class="bg-gray-50 p-3 rounded-xl border border-gray-200 font-body">
                    <label class="text-[10px] text-gray-400 font-bold uppercase block mb-1">È£ØÂ∫óÂú∞ÂùÄ (Address)</label>
                    <p class="font-bold text-sm text-gray-700 select-all">{{ hotelInfo.address }}</p>
                </div>
                
                <a :href="getNaverMapLink(hotelInfo.name)" target="_blank" class="w-full mt-4 py-3 bg-macaron-mint text-gray-800 font-bold rounded-xl shadow-md btn-press flex items-center justify-center gap-2 border border-green-100 text-sm font-body">
                    <i class="ph ph-navigation-arrow"></i> Naver Map Â∞éËà™
                </a>
            </div>
        </div>

        <div v-if="currentTab === 'guide'" class="space-y-6">

            <div class="cute-card p-5 space-y-5">
                <div class="space-y-3">
                    <h3 class="font-bold text-gray-700 text-lg flex items-center gap-2">
                        <i class="ph ph-suitcase-rolling text-macaron-purple"></i> Ë°åÊùéÊ∏ÖÂñÆ
                        <span class="text-xs text-gray-400 font-body">({{ luggageList.filter(i => i.checked).length }} / {{ luggageList.length }})</span>
                    </h3>
                    
                    <div class="flex gap-2">
                         <input v-model="newLuggageItem" @keyup.enter="addLuggage" type="text" placeholder="Êñ∞Â¢ûÁâ©ÂìÅ..." class="flex-1 bg-gray-50 p-2.5 rounded-xl text-sm outline-none border focus:border-macaron-purple font-body shadow-sm">
                         <button @click="addLuggage" class="bg-macaron-purple text-white w-10 h-10 rounded-full flex items-center justify-center btn-press shadow-md"><i class="ph ph-plus-bold"></i></button>
                    </div>

                    <div class="space-y-2">
                        <div v-for="(item, index) in luggageList" :key="`l-${index}`" class="flex items-center bg-white p-3 rounded-xl border border-gray-100 shadow-sm transition" :class="{'opacity-70': item.checked}">
                            <input type="checkbox" v-model="item.checked" class="custom-checkbox flex-shrink-0 cursor-pointer">
                            <span class="ml-3 flex-1 text-sm font-bold text-gray-700 font-body" :class="{'line-through text-gray-300': item.checked}">{{ item.text }}</span>
                            <button @click="removeLuggage(index)" class="text-gray-200 hover:text-red-400 px-2 btn-press"><i class="ph ph-trash"></i></button>
                        </div>
                    </div>
                </div>

                <div class="space-y-3 pt-4 border-t border-gray-100">
                    <h3 class="font-bold text-gray-700 text-lg flex items-center gap-2">
                        <i class="ph ph-bag-simple text-macaron-pink"></i> ÂøÖË≤∑Ê∏ÖÂñÆ
                        <span class="text-xs text-gray-400 font-body">({{ mustBuyList.filter(i => i.checked).length }} / {{ mustBuyList.length }})</span>
                    </h3>
                    
                    <div class="flex gap-2">
                         <input v-model="newMustBuyItem" @keyup.enter="addMustBuy" type="text" placeholder="Êñ∞Â¢ûÂìÅÈ†Ö..." class="flex-1 bg-gray-50 p-2.5 rounded-xl text-sm outline-none border focus:border-macaron-pink font-body shadow-sm">
                         <button @click="addMustBuy" class="bg-macaron-pink text-white w-10 h-10 rounded-full flex items-center justify-center btn-press shadow-md"><i class="ph ph-plus-bold"></i></button>
                    </div>

                    <div class="space-y-2">
                        <div v-for="(item, index) in mustBuyList" :key="`m-${index}`" class="flex items-center bg-white p-3 rounded-xl border border-gray-100 shadow-sm transition" :class="{'opacity-70': item.checked}">
                            <input type="checkbox" v-model="item.checked" class="custom-checkbox flex-shrink-0 cursor-pointer">
                            <span class="ml-3 flex-1 text-sm font-bold text-gray-700 font-body" :class="{'line-through text-gray-300': item.checked}">{{ item.text }}</span>
                            <button @click="removeMustBuy(index)" class="text-gray-200 hover:text-red-400 px-2 btn-press"><i class="ph ph-trash"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="cute-card p-5">
                <h3 class="font-bold text-gray-700 text-lg flex items-center gap-2 mb-4">
                    <i class="ph ph-phone-call text-red-500"></i> ÈüìÂúãÁ∑äÊÄ•ËÅØÁµ°ÈõªË©±
                </h3>
                <div class="space-y-3 font-body">
                    <div v-for="contact in emergencyContacts" :key="contact.number" class="flex justify-between items-center bg-red-50 p-3 rounded-xl border border-red-100 shadow-sm">
                        <div class="flex flex-col">
                            <span class="font-bold text-red-600 text-sm">{{ contact.name }}</span>
                            <span class="text-xs text-gray-500">{{ contact.desc }}</span>
                        </div>
                        <a :href="`tel:${contact.number}`" class="bg-red-500 text-white px-4 py-2 rounded-full font-bold text-sm btn-press shadow-md">
                            Êí•Êâì {{ contact.number }}
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'map'" class="h-full flex flex-col">
            <div class="bg-white p-4 rounded-3xl shadow-lg mb-4 border border-green-50">
                <input v-model="mapQuery" @keyup.enter="searchNaverMap" type="text" placeholder="Ëº∏ÂÖ•Âú∞ÈªûÊêúÂ∞ã (‰æãÂ¶ÇÔºöÊµ∑Èõ≤Âè∞)" class="w-full bg-gray-50 px-4 py-3 rounded-2xl text-sm outline-none font-bold mb-3 focus:bg-white focus:ring-2 focus:ring-green-100 transition font-body">
                
                <div class="flex gap-3">
                    <button @click="searchNaverMap" class="flex-1 bg-macaron-mint text-gray-800 py-3 rounded-2xl font-bold text-sm shadow-md btn-press flex items-center justify-center gap-2 border border-green-100 font-body">
                        <i class="ph ph-navigation-arrow"></i> Naver Map
                    </button>
                    <button @click="searchGoogleMap" class="flex-1 bg-blue-50 text-blue-500 border border-blue-100 py-3 rounded-2xl font-bold text-sm shadow-sm btn-press flex items-center justify-center gap-2 font-body">
                        <i class="ph ph-map-pin"></i> Google Map
                    </button>
                </div>
            </div>
            
            <div class="flex-1 rounded-3xl overflow-hidden shadow-2xl border-4 border-white relative bg-gray-100">
                <iframe width="100%" height="100%" style="border:0" loading="lazy" src="https://www.google.com/maps/search/$"></iframe>
                <div class="absolute bottom-4 left-4 bg-white/90 backdrop-blur px-3 py-1.5 rounded-xl text-xs font-bold text-gray-500 shadow-md font-body">
                    ÂÉÖ‰æõÊ¶ÇË¶ΩÔºåÂ∞éËà™Ë´ã‰ΩøÁî®‰∏äÊñπÊåâÈàï
                </div>
            </div>
        </div>
    </main>

    <nav class="fixed bottom-0 w-full pb-safe pt-2 px-2 flex justify-between items-center bg-white/95 backdrop-blur-md rounded-t-[30px] shadow-[0_-5px_20px_rgba(0,0,0,0.05)] z-30 border-t border-gray-100 font-body">
        <button @click="currentTab = 'itinerary'" :class="currentTab === 'itinerary' ? 'text-macaron-pink tab-active' : 'text-gray-400'" class="flex flex-col items-center p-2 flex-1 transition-all">
            <i class="ph ph-notebook text-2xl" :weight="currentTab === 'itinerary' ? 'fill' : 'regular'"></i>
            <span class="text-[10px] font-bold mt-1">Ë°åÁ®ã</span>
        </button>
        <button @click="currentTab = 'money'" :class="currentTab === 'money' ? 'text-macaron-blue tab-active' : 'text-gray-400'" class="flex flex-col items-center p-2 flex-1 transition-all">
            <i class="ph ph-currency-krw text-2xl" :weight="currentTab === 'money' ? 'fill' : 'regular'"></i>
            <span class="text-[10px] font-bold mt-1">ÂåØÁéá/Ë®òÂ∏≥</span>
        </button>
        <button @click="currentTab = 'info'" :class="currentTab === 'info' ? 'text-macaron-purple tab-active' : 'text-gray-400'" class="flex flex-col items-center p-2 flex-1 transition-all">
            <i class="ph ph-ticket text-2xl" :weight="currentTab === 'info' ? 'fill' : 'regular'"></i>
            <span class="text-[10px] font-bold mt-1">Ê©üÁ•®/‰ΩèÂÆø</span>
        </button>
        <button @click="currentTab = 'guide'" :class="currentTab === 'guide' ? 'text-macaron-pink tab-active' : 'text-gray-400'" class="flex flex-col items-center p-2 flex-1 transition-all">
            <i class="ph ph-list-checks text-2xl" :weight="currentTab === 'guide' ? 'fill' : 'regular'"></i>
            <span class="text-[10px] font-bold mt-1">Ê∏ÖÂñÆ</span>
        </button>
        <button @click="currentTab = 'map'" :class="currentTab === 'map' ? 'text-macaron-mint tab-active' : 'text-gray-400'" class="flex flex-col items-center p-2 flex-1 transition-all">
            <i class="ph ph-map-trifold text-2xl" :weight="currentTab === 'map' ? 'fill' : 'regular'"></i>
            <span class="text-[10px] font-bold mt-1">Âú∞Âúñ</span>
        </button>
    </nav>

    <div v-if="showModal" class="fixed inset-0 bg-gray-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl scale-100 transition-transform cute-card border-2 border-macaron-purple/50">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-700 font-body">
                    {{ isEditMode ? 'Á∑®ËºØË°åÁ®ã ‚úèÔ∏è' : 'Êñ∞Â¢ûË°åÁ®ã ‚ú®' }}
                </h3>
                <button @click="showModal = false" class="bg-gray-100 w-8 h-8 rounded-full text-gray-500 hover:bg-gray-200 btn-press"><i class="ph ph-x"></i></button>
            </div>
            <div class="space-y-3 font-body">
                <div>
                    <label class="text-xs text-macaron-purple font-bold ml-1">ÊôÇÈñì</label>
                    <input v-model="modalForm.time" type="time" class="w-full bg-gray-50 p-3 rounded-xl mt-1 outline-none border focus:border-macaron-purple">
                </div>
                <div>
                    <label class="text-xs text-macaron-purple font-bold ml-1">Ê®ôÈ°å</label>
                    <input v-model="modalForm.title" type="text" placeholder="Ë°åÁ®ãÂêçÁ®±" class="w-full bg-gray-50 p-3 rounded-xl mt-1 outline-none border focus:border-macaron-purple">
                </div>
                <div>
                    <label class="text-xs text-macaron-purple font-bold ml-1">Âú∞Èªû (Âú∞ÂúñÊêúÂ∞ãÁî®)</label>
                    <input v-model="modalForm.location" type="text" placeholder="Ëº∏ÂÖ•ÈóúÈçµÂ≠ó" class="w-full bg-gray-50 p-3 rounded-xl mt-1 outline-none border focus:border-macaron-purple">
                </div>
                <div>
                    <label class="text-xs text-macaron-purple font-bold ml-1">ÂÇôË®ª (ÁáüÊ•≠ÊôÇÈñì/Ë≥áË®ä)</label>
                    <textarea v-model="modalForm.desc" rows="3" placeholder="‰æãÂ¶ÇÔºöÁáüÊ•≠ÊôÇÈñì 10:00-22:00" class="w-full bg-gray-50 p-3 rounded-xl mt-1 outline-none border focus:border-macaron-purple resize-none"></textarea>
                </div>
            </div>
            <button @click="saveItem" class="w-full mt-6 py-3.5 bg-gray-800 text-white font-bold rounded-xl shadow-lg btn-press font-body">
                ÂÑ≤Â≠ò
            </button>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            // --- State ---
            const currentTab = ref('itinerary');
            const activeDay = ref(1);
            const showModal = ref(false);
            const isEditMode = ref(false);
            const mapQuery = ref('');
            
            // Guide
            const luggageList = ref([]);
            const newLuggageItem = ref('');
            const mustBuyList = ref([]);
            const newMustBuyItem = ref('');
            
            // Calculator
            const calcKRW = ref('');
            const exchangeRate = ref(41.5); 
            
            // Expenses
            const expenses = ref([]);
            const newExpense = ref({ date: '', item: '', amount: '' });

            // Modal Form
            const modalForm = ref({ id: null, time: '', title: '', location: '', desc: '' });

            // --- Fixed Data ---
            
            // Simulated Daily Weather
            const simulatedWeather = ref({
                1: { code: 2, temp: 8, rain: 20 }, // Cloudy
                2: { code: 0, temp: 12, rain: 0 }, // Sunny
                3: { code: 51, temp: 6, rain: 70 }, // Rain
                4: { code: 1, temp: 10, rain: 10 }, // Mostly clear
                5: { code: 0, temp: 11, rain: 0 }, // Sunny
            });

            // Default Checklists
            const defaultLuggage = [
                { text: 'Ë≠∑ÁÖß / Á∞ΩË≠â', checked: false },
                { text: 'ÈüìÂπ£ÁèæÈáë / ‰ø°Áî®Âç°', checked: false },
                { text: 'ËΩâÊé•È†≠ (ÈüìÂúãÂúìÂ≠î)', checked: false },
                { text: 'Ë°åÂãïÈõªÊ∫ê / ÂÖÖÈõªÁ∑ö', checked: false },
                { text: 'ÁâôÂà∑ÁâôËÜè (ÈüìÂúãÁí∞‰øù‰∏çÊèê‰æõ)', checked: false },
                { text: 'ÂÄã‰∫∫Â∏∏ÂÇôËó•ÂìÅ', checked: false },
                { text: '‰øùÊöñË°£Áâ© / ÂúçÂ∑æ', checked: false },
                { text: 'Á∂≤Âç° / eSim', checked: false }
            ];

            const defaultMustBuy = [
                { text: 'Olive Young Ë≠∑ËÜöÂìÅ', checked: false },
                { text: 'Èõ∂È£ü (ÁÉèÈæúÈ§Ö‰πæ)', checked: false },
                { text: 'Kakao Friends Âë®ÈÇä', checked: false },
                { text: 'Market O Â∏ÉÊúóÂ∞º', checked: false },
                { text: 'Ë•™Â≠ê', checked: false }
            ];

            const emergencyContacts = [
                { name: 'Ë≠¶ÂØüÂ±Ä', number: '112', desc: 'Police' },
                { name: 'Ê∂àÈò≤/ÊïëË≠∑Ëªä', number: '119', desc: 'Fire/Ambulance' },
                { name: 'ÊóÖÈÅäË´ÆË©¢ÁÜ±Á∑ö', number: '1330', desc: 'Korea Travel Hotline' }
            ];

            // Itinerary Default Data (Used to extract flight/hotel info)
            const defaultItinerary = [
                // Day 1 Departure Flight
                { id: 101, day: 1, time: '14:25', title: 'ÂéªÁ®ã: Èï∑Ê¶ÆËà™Á©∫ BR164', location: 'Taoyuan Intl Airport T2', desc: 'Á∂ìÊøüËâô V | 17:40 ÊäµÈÅîÈáúÂ±±', isFlight: true, flightNo: 'BR164', depAirport: 'TPE', arrAirport: 'PUS', depTime: '14:25', gate: 'TBD', type: 'departure' },
                // Day 5 Return Flight
                { id: 504, day: 5, time: '18:55', title: 'ÂõûÁ®ã: Èï∑Ê¶ÆËà™Á©∫ BR163', location: 'Gimhae International Airport', desc: 'Á∂ìÊøüËâô V | 20:25 ÊäµÈÅîÊ°ÉÂúí', isFlight: true, flightNo: 'BR163', depAirport: 'PUS', arrAirport: 'TPE', depTime: '18:55', gate: 'TBD', type: 'return' },
                
                // Day 1 Hotel Check-in (Used for Hotel Info)
                { id: 102, day: 1, time: '19:00', title: 'È£ØÂ∫ó Check-in', location: 'Aventree Hotel Busan', desc: 'Âú∞ÂùÄÔºö6 Gwangbok-ro 39beon-gil' },
                
                // Other days... 
                { id: 103, day: 1, time: '20:00', title: 'ÊâéÂòéÂÖ∂Â∏ÇÂ†¥ / BIFFÂª£Â†¥', location: 'Jagalchi Market', desc: 'ÊôöÈ§ê„ÄÅÈÄõÂ§úÂ∏Ç' },
                { id: 201, day: 2, time: '09:00', title: 'Êµ∑Èõ≤Âè∞ÂÇ≥Áµ±Â∏ÇÂ†¥', location: 'Haeundae Traditional Market', desc: 'Êó©È§êÔºöÂàÄÂâäÈ∫µ„ÄÅÈ£ØÊç≤' },
                { id: 301, day: 3, time: '09:00', title: 'KKday‰∏ÄÊó•ÈÅäÈõÜÂêà', location: 'Busan Station', desc: 'ÂâçÂæÄÊÖ∂Â∑û' },
                { id: 401, day: 4, time: '09:30', title: 'ÊùæÂ≥∂Â§©Á©∫Ê≠•ÈÅì', location: 'Songdo Cloud Trails', desc: 'Êµ∑‰∏äÊ≠•ÈÅì' },
            ];

            const itinerary = ref([]);
            
            // --- Lifecycle ---
            onMounted(() => {
                newExpense.value.date = new Date().toISOString().split('T')[0];

                // Load from LocalStorage
                const savedItinerary = localStorage.getItem('busan_2026_v5_itinerary');
                const savedExpenses = localStorage.getItem('busan_2026_v5_expenses');
                const savedRate = localStorage.getItem('busan_2026_rate');
                const savedLuggage = localStorage.getItem('busan_2026_luggage_v5');
                const savedMustBuy = localStorage.getItem('busan_2026_mustbuy_v5');
                
                itinerary.value = savedItinerary ? JSON.parse(savedItinerary) : defaultItinerary;
                if (savedExpenses) expenses.value = JSON.parse(savedExpenses);
                if (savedRate) exchangeRate.value = parseFloat(savedRate);
                luggageList.value = savedLuggage ? JSON.parse(savedLuggage) : defaultLuggage;
                mustBuyList.value = savedMustBuy ? JSON.parse(savedMustBuy) : defaultMustBuy;
            });

            // --- Watchers for Auto-Save ---
            watch([itinerary, expenses, exchangeRate, luggageList, mustBuyList], () => {
                localStorage.setItem('busan_2026_v5_itinerary', JSON.stringify(itinerary.value));
                localStorage.setItem('busan_2026_v5_expenses', JSON.stringify(expenses.value));
                localStorage.setItem('busan_2026_rate', exchangeRate.value);
                localStorage.setItem('busan_2026_luggage_v5', JSON.stringify(luggageList.value));
                localStorage.setItem('busan_2026_mustbuy_v5', JSON.stringify(mustBuyList.value));
            }, { deep: true });

            // --- Computed ---
            const filteredItinerary = computed(() => {
                return itinerary.value
                    .filter(item => item.day === activeDay.value)
                    .sort((a, b) => a.time.localeCompare(b.time));
            });

            const totalExpenseTWD = computed(() => {
                const totalKRW = expenses.value.reduce((sum, item) => sum + item.amount, 0);
                return Math.round(totalKRW / (exchangeRate.value || 1));
            });
            
            // Calculator fix
            const calculatedTWD = computed(() => {
                const krw = Number(calcKRW.value) || 0;
                const rate = Number(exchangeRate.value) || 1;
                if (rate === 0) return 0;
                return Math.round(krw / rate);
            });

            // Flight Info Extraction (Now includes both departure and return)
            const flightInfo = computed(() => {
                const dep = itinerary.value.find(i => i.isFlight && i.type === 'departure');
                const ret = itinerary.value.find(i => i.isFlight && i.type === 'return');
                
                // Default placeholders based on the provided itinerary data structure
                const defaultDep = { flightNo: 'BR164', depAirport: 'TPE', arrAirport: 'PUS', depTime: '14:25', gate: 'TBD' };
                const defaultRet = { flightNo: 'BR163', depAirport: 'PUS', arrAirport: 'TPE', depTime: '18:55', gate: 'TBD' };

                return {
                    departure: dep || defaultDep,
                    return: ret || defaultRet
                };
            });

            // Hotel Info Extraction (Using Day 1 check-in for the card)
            const hotelInfo = computed(() => {
                const hotelItem = itinerary.value.find(i => i.location === 'Aventree Hotel Busan');
                return {
                    name: 'ÈáúÂ±±‰∫ûÈõ≤Ê®πÈ£ØÂ∫ó (Hotel Aventree Busan)',
                    address: '6 Gwangbok-ro 39beon-gil, Jung-gu, Busan, ÂçóÈüì',
                };
            });


            // --- Methods ---
            
            // Itinerary Methods
            const openModal = (item) => {
                if (item) {
                    isEditMode.value = true;
                    // Prevent editing flight items via this modal
                    if (item.isFlight) return alert('Ëà™Áè≠Ë≥áË®äË´ãÁõ¥Êé•Âú®„ÄåÊ©üÁ•®/‰ΩèÂÆø„ÄçÈ†ÅÈù¢‰∏≠Ê™¢Ë¶ñ„ÄÇ'); 

                    modalForm.value = { ...item };
                } else {
                    isEditMode.value = false;
                    modalForm.value = { id: Date.now(), time: '12:00', title: '', location: '', desc: '' };
                }
                showModal.value = true;
            };

            const saveItem = () => {
                if (!modalForm.value.title) return;
                if (isEditMode.value) {
                    const index = itinerary.value.findIndex(i => i.id === modalForm.value.id);
                    if (index !== -1) itinerary.value[index] = { ...modalForm.value };
                } else {
                    itinerary.value.push({ ...modalForm.value, day: activeDay.value, location: modalForm.value.location || modalForm.value.title, isFlight: false });
                }
                showModal.value = false;
            };

            const deleteItem = (id) => {
                if(confirm('Á¢∫ÂÆöÂà™Èô§Ê≠§Ë°åÁ®ãÂóéÔºü')) itinerary.value = itinerary.value.filter(item => item.id !== id);
            };

            // Expense Methods
            const addExpense = () => {
                if (!newExpense.value.item || !newExpense.value.amount) return;
                expenses.value.unshift({
                    date: newExpense.value.date || new Date().toISOString().split('T')[0],
                    item: newExpense.value.item,
                    amount: Number(newExpense.value.amount) // Ensure number type
                });
                newExpense.value.item = '';
                newExpense.value.amount = '';
            };

            const removeExpense = (index) => {
                if(confirm('Âà™Èô§ÈÄôÁ≠ÜÂ∏≥ÁõÆÔºü')) expenses.value.splice(index, 1);
            };

            // Luggage Methods
            const addLuggage = () => {
                if(!newLuggageItem.value) return;
                luggageList.value.push({ text: newLuggageItem.value, checked: false });
                newLuggageItem.value = '';
            };
            const removeLuggage = (index) => {
                luggageList.value.splice(index, 1);
            };

            // Must-Buy Methods
            const addMustBuy = () => {
                if(!newMustBuyItem.value) return;
                mustBuyList.value.push({ text: newMustBuyItem.value, checked: false });
                newMustBuyItem.value = '';
            };
            const removeMustBuy = (index) => {
                mustBuyList.value.splice(index, 1);
            };

            // Utility Methods
            const searchNaverMap = () => {
                const q = mapQuery.value || 'Busan';
                window.open(`https://map.naver.com/p/search/${encodeURIComponent(q)}`, '_blank');
            };
            const searchGoogleMap = () => {
                const q = mapQuery.value || 'Busan';
                // Note: Placeholder URL for Google Map Search.
                window.open(`https://www.google.com/maps/search/$$${encodeURIComponent(q)}`, '_blank');
            };
            const getNaverMapLink = (query) => `https://map.naver.com/p/search/${encodeURIComponent(query)}`;
            
            const formatNumber = (num) => num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");

            // Weather Icon Mapping (Simple)
            const getWeatherIcon = (code) => {
                if (code === 0) return '‚òÄÔ∏è'; // Sunny
                if (code === 1) return 'üå•Ô∏è'; // Mostly Clear
                if (code <= 3) return '‚òÅÔ∏è'; // Cloudy
                if (code <= 67) return 'üåßÔ∏è'; // Rain
                return 'üå•Ô∏è'; // Default
            };

            return {
                currentTab, activeDay, showModal, isEditMode, modalForm,
                itinerary, expenses, exchangeRate, filteredItinerary,
                totalExpenseTWD, newExpense, mapQuery,
                luggageList, newLuggageItem, mustBuyList, newMustBuyItem,
                flightInfo, hotelInfo, emergencyContacts, simulatedWeather,
                calculatedTWD, calcKRW,
                openModal, saveItem, deleteItem, addExpense, removeExpense,
                addLuggage, removeLuggage, addMustBuy, removeMustBuy,
                formatNumber, searchNaverMap, searchGoogleMap, getNaverMapLink, getWeatherIcon
            };
        }
    }).mount('#app');
</script>
</body>
</html>
