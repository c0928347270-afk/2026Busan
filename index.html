<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 Busan Trip üá∞üá∑</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Hachi+Maru+Pop&family=Nunito:wght400;700;900&family=Noto+Sans+TC:wght500;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        macaron: {
                            pink: '#FFC8DD',
                            blue: '#A2D2FF',
                            yellow: '#FDFD96',
                            green: '#BDE0FE',
                            mint: '#C1E1C1',
                            purple: '#CDB4DB',
                            dark: '#555555'
                        }
                    },
                    fontFamily: {
                        // Using a cute/playful font mix
                        cute: ['"Hachi Maru Pop"', '"Nunito"', '"Noto Sans TC"', 'sans-serif'],
                        body: ['"Nunito"', '"Noto Sans TC"', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Hachi Maru Pop', 'Nunito', 'Noto Sans TC', sans-serif;
            background-color: #F8F8FF; /* Light Lavender Background */
            color: #555;
            -webkit-tap-highlight-color: transparent;
        }
        
        .cute-card {
            background: #FFFFFF;
            border-radius: 20px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.05); /* Softer Shadow */
            border: 2px solid #FFF0F5;
            transition: transform 0.2s;
        }

        .btn-press {
            transition: all 0.1s;
        }
        .btn-press:active {
            transform: scale(0.95);
        }

        /* Hide Scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .tab-active {
            color: #FF6B6B;
            transform: scale(1.1);
        }

        /* Boarding Pass Style */
        .boarding-pass {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 5px solid #A2D2FF;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        .boarding-pass::after {
            content: '';
            position: absolute;
            top: 20px;
            right: 0;
            width: 10px;
            height: calc(100% - 40px);
            background: repeating-linear-gradient(to bottom, #F8F8FF 0, #F8F8FF 5px, transparent 5px, transparent 10px);
            border-left: 2px dashed #CDB4DB;
        }

        /* Checklist Custom Style (Reusing previous cute style) */
        .custom-checkbox {
            appearance: none;
            background-color: #fff;
            margin: 0;
            font: inherit;
            color: currentColor;
            width: 1.2em;
            height: 1.2em;
            border: 2px solid #CDB4DB;
            border-radius: 0.35em;
            display: grid;
            place-content: center;
        }
        .custom-checkbox::before {
            content: "";
            width: 0.65em;
            height: 0.65em;
            transform: scale(0);
            transition: 120ms transform ease-in-out;
            box-shadow: inset 1em 1em #CDB4DB;
            transform-origin: center;
            clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
        }
        .custom-checkbox:checked::before {
            transform: scale(1);
        }
        
        /* Currency Calculator Fix */
        .calc-input {
            width: 100%;
            text-align: right;
            font-size: 1.75rem; /* text-3xl */
            font-weight: 900; /* font-black */
            outline: none;
            padding: 0;
            line-height: 1;
            background: none;
            border: none;
        }
        .calc-input::placeholder {
            color: #E5E7EB;
        }
    </style>
</head>
<body class="text-gray-700"> <div id="app"> <header class="pt-8 pb-4 px-5 z-10 relative overflow-hidden flex justify-between items-center">
        <div>
            <h1 class="text-3xl font-black text-gray-800 tracking-wide leading-tight flex items-center gap-2">
                2025 ÈüìÂúãÈáúÂ±± 5 Êó•ÈÅä
                <i class="ph ph-paper-plane-tilt text-macaron-pink text-2xl"></i>
            </h1>
            <p class="text-sm font-body text-gray-700 font-bold opacity-70 mt-0.5">Jan 21 - Jan 25, 2025</p>
        </div>
    </header>

    <main class="p-5 pt-2 pb-28 space-y-5"> <div v-if="currentTab === 'itinerary'" class="space-y-4">
            <div class="flex space-x-3 overflow-x-auto pb-2 no-scrollbar px-1">
                <button v-for="i in 5" :key="i" 
                    @click="activeDay = i"
                    :class="activeDay === i ? 'bg-macaron-blue text-white ring-2 ring-macaron-blue ring-offset-2' : 'bg-white text-gray-400 border border-gray-100'"
                    class="flex-shrink-0 w-16 h-16 rounded-3xl flex flex-col items-center justify-center shadow-md transition-all duration-300 btn-press">
                    <span class="text-[10px] uppercase font-bold">{{ getDayInfo(i).day }}</span> <span class="text-xl font-black leading-none">{{ getDayInfo(i).date.slice(3) }}</span> </button>
            </div>

            <div class="space-y-4 pt-2">
                <div class="flex justify-between items-center px-1 mb-2">
                    <h2 class="text-lg font-bold text-gray-800">{{ getDayInfo(activeDay).fullDay }} Ë°åÁ®ã</h2> <div class="flex items-center gap-1.5 text-base font-bold bg-macaron-yellow/50 px-3 py-1.5 rounded-full border border-yellow-100 shadow-sm">
                        <span class="text-3xl leading-none">{{ getWeatherIcon(simulatedWeather[activeDay].code) }}</span> <span class="font-body text-gray-700 text-xl">{{ simulatedWeather[activeDay].temp }}¬∞</span> </div>
                </div>

                <div v-if="filteredItinerary.length === 0" class="text-center py-10 text-gray-400 cute-card">
                    <p>ÈªûÊìäÂè≥‰∏ãËßíÊåâÈàïÊñ∞Â¢ûË°åÁ®ã ‚ú®</p>
                </div>

                <div v-for="item in filteredItinerary" :key="item.id" 
                    class="cute-card p-4 flex gap-3 relative group"
                    :class="{'bg-blue-50/50 border-blue-100': item.isFlight, 'bg-white border-white': !item.isFlight}">
                    
                    <div class="flex flex-col items-center min-w-[60px] flex-shrink-0">
                        <span class="bg-macaron-pink px-2 py-1 rounded-lg text-xs font-bold text-white shadow-md border border-pink-100 font-mono">
                            {{ item.time }}
                        </span>
                        <div class="h-full w-0.5 bg-gray-200 my-2 border-l-2 border-dotted"></div>
                    </div>

                    <div class="flex-1 pb-1 min-w-0">
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-[16px] text-gray-800 leading-tight pr-6">{{ item.title }}</h3>
                            <div class="flex gap-2 flex-shrink-0">
                                <button @click="openModal(item)" class="text-gray-400 hover:text-blue-500 btn-press p-1">
                                    <i class="ph ph-pencil-simple text-lg"></i>
                                </button>
                                <button v-if="!item.isFlight" @click="deleteItem(item.id)" class="text-gray-400 hover:text-red-400 btn-press p-1">
                                    <i class="ph ph-trash text-lg"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="mt-1 flex items-center text-xs text-gray-500 font-medium font-body">
                            <i v-if="item.isFlight" class="ph ph-airplane-tilt mr-1 text-blue-400"></i>
                            <i v-else class="ph ph-map-pin mr-1 text-gray-400"></i>
                            <span class="truncate">{{ item.location }}</span>
                        </div>

                        <p v-if="item.desc" class="text-xs text-gray-600 mt-2 bg-gray-50/60 p-2 rounded-xl inline-block border border-gray-100 w-full whitespace-pre-wrap font-body">
                           {{ item.desc }}
                        </p>

                        <a v-if="!item.isFlight" :href="getNaverMapLink(item.location)" target="_blank" 
                           class="mt-3 inline-flex items-center text-[10px] font-bold text-gray-700 bg-macaron-mint px-3 py-1.5 rounded-full shadow-sm hover:bg-green-300 transition-colors btn-press font-body">
                            <i class="ph ph-navigation-arrow"></i> Naver Map
                        </a>
                    </div>
                </div>
            </div>
            
            <button @click="openModal(null)" class="fixed bottom-24 right-5 bg-gray-800 text-white w-14 h-14 rounded-full shadow-xl flex items-center justify-center text-2xl z-20 hover:scale-105 transition-transform btn-press border-4 border-white">
                <i class="ph ph-plus"></i>
            </button>
        </div>

        <div v-if="currentTab === 'money'" class="space-y-6">
            <div>
                <div class="flex justify-between items-end mb-2 px-1">
                    <h3 class="font-bold text-gray-700"><i class="ph ph-calculator text-macaron-purple"></i> ÂåØÁéáË®àÁÆóÊ©ü</h3>
                    <div class="flex items-center gap-2 bg-white px-3 py-1 rounded-xl border border-gray-200 shadow-sm">
                        <span class="text-[10px] text-gray-400 font-body">ÁõÆÂâçÂåØÁéá</span>
                        <input v-model.number="exchangeRate" type="number" class="w-12 text-right font-bold text-sm outline-none text-blue-500 font-body" min="0.01" step="0.01">
                    </div>
                </div>
                
                <div class="cute-card p-5 bg-gradient-to-r from-gray-50 to-white space-y-3">
                    <div class="flex items-center border-b border-gray-200 pb-2">
                        <span class="text-gray-400 font-bold w-16 text-sm font-body">KRW (‚Ç©)</span>
                        <input v-model.number="calcKRW" type="number" placeholder="0" class="calc-input text-gray-800 font-body">
                    </div>
                    <div class="flex items-center pt-2">
                        <span class="text-gray-400 font-bold w-16 text-sm font-body">TWD (NT$)</span>
                        <div class="w-full text-right text-3xl font-black text-macaron-purple font-body">
                            {{ formatNumber(calculatedTWD) }}
                        </div>
                    </div>
                </div>
            </div>

            <div class="space-y-3">
                <div class="flex justify-between items-end px-1 border-t border-gray-200 pt-6">
                    <h3 class="font-bold text-gray-700"><i class="ph ph-receipt text-macaron-purple"></i> ÊîØÂá∫Ë®òÂ∏≥</h3>
                    <div class="text-right">
                        <p class="text-[10px] text-gray-400 font-body">Á∏ΩÊîØÂá∫</p>
                        <p class="font-bold text-xl text-blue-500 font-body">NT$ {{ formatNumber(totalExpenseTWD) }}</p>
                    </div>
                </div>

                <div class="cute-card p-3 flex flex-col gap-2 bg-gray-50 border-dashed border-gray-200">
                    <div class="flex gap-2">
                        <input type="date" v-model="newExpense.date" class="bg-white p-2 rounded-xl text-xs outline-none border w-1/3 text-center font-body shadow-sm">
                        <input v-model="newExpense.item" placeholder="ÂìÅÈ†ÖÂêçÁ®±" class="bg-white p-2 rounded-xl text-xs outline-none border flex-1 font-body shadow-sm">
                    </div>
                    <div class="flex gap-2">
                        <div class="relative flex-1">
                            <input v-model.number="newExpense.amount" type="number" placeholder="ÈüìÂπ£ÈáëÈ°ç" class="w-full bg-white p-2 pl-6 rounded-xl text-sm outline-none border font-body shadow-sm">
                            <span class="absolute left-2 top-2.5 text-xs text-gray-400">‚Ç©</span>
                        </div>
                        <button @click="addExpense" class="bg-macaron-purple text-white px-4 rounded-xl font-bold text-xs shadow-md btn-press whitespace-nowrap font-body">Êñ∞Â¢û</button>
                    </div>
                </div>

                <div class="space-y-2 pb-8">
                    <div v-for="(exp, index) in expenses" :key="index" class="bg-white p-3 rounded-xl shadow-md border border-gray-100 flex justify-between items-center">
                        <div class="flex flex-col">
                            <span class="text-sm font-bold text-gray-800">{{ exp.item }}</span>
                            <span class="text-[10px] text-gray-400 font-body">{{ exp.date.slice(5) }}</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="text-right font-body">
                                <p class="font-bold text-gray-400 text-xs">‚Ç©{{ formatNumber(exp.amount) }}</p>
                                <p class="text-sm font-bold text-blue-500">NT$ {{ formatNumber(exchangeRate > 0 ? Math.round(exp.amount / exchangeRate) : 0) }}</p>
                            </div>
                            <button @click="removeExpense(index)" class="text-gray-300 hover:text-red-400 p-1 btn-press"><i class="ph ph-x-circle"></i></button>
                        </div>
                    </div>
                    <div v-if="expenses.length === 0" class="text-center text-xs text-gray-300 py-4 font-body">
                        ÈÇÑÊ≤íÊúâË®òÂ∏≥Á¥ÄÈåÑÂñî
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'info'" class="space-y-6">
            <h3 class="font-bold text-gray-700 px-1"><i class="ph ph-airplane-takeoff text-macaron-blue"></i> Ëà™Áè≠Ë≥áË®ä (ÁôªÊ©üË≠â)</h3>

            <div class="cute-card p-5 boarding-pass relative">
                <div class="absolute top-0 right-10 text-6xl opacity-10 rotate-12 text-blue-400"><i class="ph ph-airplane-tilt"></i></div>
                <div class="flex justify-between items-center mb-4 border-b border-dashed border-blue-200 pb-3">
                    <h2 class="text-xl font-black text-gray-800 font-body">ÂéªÁ®ã Boarding Pass</h2>
                    <span class="text-2xl font-black text-blue-500 font-mono">{{ flightInfo.departure.flightNo }}</span>
                </div>

                <div class="grid grid-cols-2 gap-x-4 gap-y-3 font-body text-sm">
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400 uppercase">Departure</span>
                        <span class="font-bold text-gray-800">{{ flightInfo.departure.depAirport }} (TPE)</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400 uppercase">Arrival</span>
                        <span class="font-bold text-gray-800">{{ flightInfo.departure.arrAirport }} (PUS)</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400 uppercase">Terminal / Gate</span>
                        <span class="font-bold text-gray-800">{{ flightInfo.departure.terminal }} / {{ flightInfo.departure.gate }}</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400 uppercase">Boarding Time</span>
                        <span class="font-bold text-gray-800">{{ flightInfo.departure.boardingTime }}</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400 uppercase">Flight Time</span>
                        <span class="font-bold text-gray-800">{{ flightInfo.departure.depTime }}</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400 uppercase">Date</span>
                        <span class="font-bold text-gray-800">Jan 21, 2025</span>
                    </div>
                </div>
            </div>
            
            <div class="cute-card p-5 boarding-pass relative">
                <div class="absolute top-0 right-10 text-6xl opacity-10 -rotate-12 text-pink-400"><i class="ph ph-airplane-tilt"></i></div>
                <div class="flex justify-between items-center mb-4 border-b border-dashed border-pink-200 pb-3">
                    <h2 class="text-xl font-black text-gray-800 font-body">ÂõûÁ®ã Boarding Pass</h2>
                    <span class="text-2xl font-black text-pink-500 font-mono">{{ flightInfo.return.flightNo }}</span>
                </div>

                <div class="grid grid-cols-2 gap-x-4 gap-y-3 font-body text-sm">
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400 uppercase">Departure</span>
                        <span class="font-bold text-gray-800">{{ flightInfo.return.depAirport }} (PUS)</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400 uppercase">Arrival</span>
                        <span class="font-bold text-gray-800">{{ flightInfo.return.arrAirport }} (TPE)</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400 uppercase">Terminal / Gate</span>
                        <span class="font-bold text-gray-800">{{ flightInfo.return.terminal }} / {{ flightInfo.return.gate }}</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400 uppercase">Boarding Time</span>
                        <span class="font-bold text-gray-800">{{ flightInfo.return.boardingTime }}</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400 uppercase">Flight Time</span>
                        <span class="font-bold text-gray-800">{{ flightInfo.return.depTime }}</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400 uppercase">Date</span>
                        <span class="font-bold text-gray-800">Jan 25, 2025</span>
                    </div>
                </div>
            </div>


            <h3 class="font-bold text-gray-700 pt-4 px-1"><i class="ph ph-buildings text-macaron-purple"></i> ‰ΩèÂÆøË≥áË®ä</h3>
            <div class="cute-card p-5 bg-white shadow-md relative overflow-hidden">
                <div class="flex items-center mb-3">
                    <i class="ph ph-bed text-xl text-macaron-purple mr-2"></i>
                    <h2 class="text-lg font-bold text-gray-800 leading-tight">{{ hotelInfo.name }}</h2>
                </div>
                <div class="bg-gray-50 p-3 rounded-xl border border-gray-200 font-body">
                    <label class="text-[10px] text-gray-400 font-bold uppercase block mb-1">È£ØÂ∫óÂú∞ÂùÄ (Address)</label>
                    <p class="font-bold text-sm text-gray-700 select-all">{{ hotelInfo.address }}</p>
                </div>
                
                <a :href="getNaverMapLink(hotelInfo.name)" target="_blank" class="w-full mt-4 py-3 bg-macaron-mint text-gray-800 font-bold rounded-xl shadow-md btn-press flex items-center justify-center gap-2 border border-green-100 text-sm font-body">
                    <i class="ph ph-navigation-arrow"></i> Naver Map Â∞éËà™
                </a>
            </div>
        </div>

        <div v-if="currentTab === 'guide'" class="space-y-6">

            <div class="cute-card p-5 space-y-5">
                <div class="space-y-3">
                    <h3 class="font-bold text-gray-700 text-lg flex items-center gap-2">
                        <i class="ph ph-suitcase-rolling text-macaron-purple"></i> Ë°åÊùéÊ∏ÖÂñÆ
                        <span class="text-xs text-gray-400 font-body">({{ luggageList.filter(i => i.checked).length }} / {{ luggageList.length }})</span>
                    </h3>
                    
                    <div class="flex gap-2">
                         <input v-model="newLuggageItem" @keyup.enter="addLuggage" type="text" placeholder="Êñ∞Â¢ûÁâ©ÂìÅ..." class="flex-1 bg-gray-50 p-2.5 rounded-xl text-sm outline-none border focus:border-macaron-purple font-body shadow-sm">
                         <button @click="addLuggage" class="bg-macaron-purple text-white w-10 h-10 rounded-full flex items-center justify-center btn-press shadow-md"><i class="ph ph-plus-bold"></i></button>
                    </div>

                    <div class="space-y-2">
                        <div v-for="(item, index) in luggageList" :key="`l-${index}`" class="flex items-center bg-white p-3 rounded-xl border border-gray-100 shadow-sm transition" :class="{'opacity-70': item.checked}">
                            <input type="checkbox" v-model="item.checked" class="custom-checkbox flex-shrink-0 cursor-pointer">
                            <span class="ml-3 flex-1 text-sm font-bold text-gray-700 font-body" :class="{'line-through text-gray-300': item.checked}">{{ item.text }}</span>
                            <button @click="removeLuggage(index)" class="text-gray-200 hover:text-red-400 px-2 btn-press"><i class="ph ph-trash"></i></button>
                        </div>
                    </div>
                </div>

                <div class="space-y-3 pt-4 border-t border-gray-100">
                    <h3 class="font-bold text-gray-700 text-lg flex items-center gap-2">
                        <i class="ph ph-bag-simple text-macaron-pink"></i> ÂøÖË≤∑Ê∏ÖÂñÆ
                        <span class="text-xs text-gray-400 font-body">({{ mustBuyList.filter(i => i.checked).length }} / {{ mustBuyList.length }})</span>
                    </h3>
                    
                    <div class="flex gap-2">
                         <input v-model="newMustBuyItem" @keyup.enter="addMustBuy" type="text" placeholder="Êñ∞Â¢ûÂìÅÈ†Ö..." class="flex-1 bg-gray-50 p-2.5 rounded-xl text-sm outline-none border focus:border-macaron-pink font-body shadow-sm">
                         <button @click="addMustBuy" class="bg-macaron-pink text-white w-10 h-10 rounded-full flex items-center justify-center btn-press shadow-md"><i class="ph ph-plus-bold"></i></button>
                    </div>

                    <div class="space-y-2">
                        <div v-for="(item, index) in mustBuyList" :key="`m-${index}`" class="flex items-center bg-white p-3 rounded-xl border border-gray-100 shadow-sm transition" :class="{'opacity-70': item.checked}">
                            <input type="checkbox" v-model="item.checked" class="custom-checkbox flex-shrink-0 cursor-pointer">
                            <span class="ml-3 flex-1 text-sm font-bold text-gray-700 font-body" :class="{'line-through text-gray-300': item.checked}">{{ item.text }}</span>
                            <button @click="removeMustBuy(index)" class="text-gray-200 hover:text-red-400 px-2 btn-press"><i class="ph ph-trash"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="cute-card p-5">
                <h3 class="font-bold text-gray-700 text-lg flex items-center gap-2 mb-4">
                    <i class="ph ph-phone-call text-red-500"></i> ÈüìÂúãÁ∑äÊÄ•ËÅØÁµ°ÈõªË©±
                </h3>
                <div class="space-y-3 font-body">
                    <div v-for="contact in emergencyContacts" :key="contact.number" class="flex justify-between items-center bg-red-50 p-3 rounded-xl border border-red-100 shadow-sm">
                        <div class="flex flex-col">
                            <span class="font-bold text-red-600 text-sm">{{ contact.name }}</span>
                            <span class="text-xs text-gray-500">{{ contact.desc }}</span>
                        </div>
                        <a :href="`tel:${contact.number}`" class="bg-red-500 text-white px-4 py-2 rounded-full font-bold text-sm btn-press shadow-md">
                            Êí•Êâì {{ contact.number }}
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'map'" class="h-full flex flex-col">
            <div class="bg-white p-4 rounded-3xl shadow-lg mb-4 border border-green-50">
                <input v-model="mapQuery" @keyup.enter="searchNaverMap" type="text" placeholder="Ëº∏ÂÖ•Âú∞ÈªûÊêúÂ∞ã (‰æãÂ¶ÇÔºöÊµ∑Èõ≤Âè∞)" class="w-full bg-gray-50 px-4 py-3 rounded-2xl text-sm outline-none font-bold mb-3 focus:bg-white focus:ring-2 focus:ring-green-100 transition font-body">
                
                <div class="flex gap-3">
                    <button @click="searchNaverMap" class="flex-1 bg-macaron-mint text-gray-800 py-3 rounded-2xl font-bold text-sm shadow-md btn-press flex items-center justify-center gap-2 border border-green-100 font-body">
                        <i class="ph ph-navigation-arrow"></i> Naver Map
                    </button>
                    <button @click="searchGoogleMap" class="flex-1 bg-blue-50 text-blue-500 border border-blue-100 py-3 rounded-2xl font-bold text-sm shadow-sm btn-press flex items-center justify-center gap-2 font-body">
                        <i class="ph ph-map-pin"></i> Google Map
                    </button>
                </div>
            </div>
            
            <div class="flex-1 rounded-3xl overflow-hidden shadow-2xl border-4 border-white relative bg-gray-100">
                <iframe width="100%" height="100%" style="border:0" loading="lazy" 
                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d102716.27850871927!2d129.0838128!3d35.1584949!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3568e89f81216d8f%3A0x6a0c5c36af1c944d!2sBusan%2C%20South%20Korea!5e0!3m2!1sen!2stw!4v1703649600000!5m2!1sen!2stw" 
                    allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
                </iframe>
                <div class="absolute bottom-4 left-4 bg-white/90 backdrop-blur px-3 py-1.5 rounded-xl text-xs font-bold text-gray-500 shadow-md font-body">
                    ÂÉÖ‰æõÊ¶ÇË¶ΩÔºåÂ∞éËà™Ë´ã‰ΩøÁî®‰∏äÊñπÊåâÈàï
                </div>
            </div>
        </div>
    </main>

    <nav class="fixed bottom-0 w-full pb-safe pt-2 px-2 flex justify-between items-center bg-white/95 backdrop-blur-md rounded-t-[30px] shadow-[0_-5px_20px_rgba(0,0,0,0.05)] z-30 border-t border-gray-100 font-body">
        <button @click="currentTab = 'itinerary'" :class="currentTab === 'itinerary' ? 'text-macaron-pink tab-active' : 'text-gray-400'" class="flex flex-col items-center p-2 flex-1 transition-all">
            <i class="ph ph-notebook text-2xl" :weight="currentTab === 'itinerary' ? 'fill' : 'regular'"></i>
            <span class="text-[10px] font-bold mt-1">Ë°åÁ®ã</span>
        </button>
        <button @click="currentTab = 'money'" :class="currentTab === 'money' ? 'text-macaron-blue tab-active' : 'text-gray-400'" class="flex flex-col items-center p-2 flex-1 transition-all">
            <i class="ph ph-currency-krw text-2xl" :weight="currentTab === 'money' ? 'fill' : 'regular'"></i>
            <span class="text-[10px] font-bold mt-1">ÂåØÁéá/Ë®òÂ∏≥</span>
        </button>
        <button @click="currentTab = 'info'" :class="currentTab === 'info' ? 'text-macaron-purple tab-active' : 'text-gray-400'" class="flex flex-col items-center p-2 flex-1 transition-all">
            <i class="ph ph-ticket text-2xl" :weight="currentTab === 'info' ? 'fill' : 'regular'"></i>
            <span class="text-[10px] font-bold mt-1">Ê©üÁ•®/‰ΩèÂÆø</span>
        </button>
        <button @click="currentTab = 'guide'" :class="currentTab === 'guide' ? 'text-macaron-pink tab-active' : 'text-gray-400'" class="flex flex-col items-center p-2 flex-1 transition-all">
            <i class="ph ph-list-checks text-2xl" :weight="currentTab === 'guide' ? 'fill' : 'regular'"></i>
            <span class="text-[10px] font-bold mt-1">Ê∏ÖÂñÆ</span>
        </button>
        <button @click="currentTab = 'map'" :class="currentTab === 'map' ? 'text-macaron-mint tab-active' : 'text-gray-400'" class="flex flex-col items-center p-2 flex-1 transition-all">
            <i class="ph ph-map-trifold text-2xl" :weight="currentTab === 'map' ? 'fill' : 'regular'"></i>
            <span class="text-[10px] font-bold mt-1">Âú∞Âúñ</span>
        </button>
    </nav>

    <div v-if="showModal" class="fixed inset-0 bg-gray-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl scale-100 transition-transform cute-card border-2 border-macaron-purple/50">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-700 font-body">
                    {{ isEditMode ? 'Á∑®ËºØË°åÁ®ã ‚úèÔ∏è' : 'Êñ∞Â¢ûË°åÁ®ã ‚ú®' }}
                </h3>
                <button @click="showModal = false" class="bg-gray-100 w-8 h-8 rounded-full text-gray-500 hover:bg-gray-200 btn-press"><i class="ph ph-x"></i></button>
            </div>
            <div class="space-y-3 font-body">
                <div>
                    <label class="text-xs text-macaron-purple font-bold ml-1">ÊôÇÈñì</label>
                    <input v-model="modalForm.time" type="time" class="w-full bg-gray-50 p-3 rounded-xl mt-1 outline-none border focus:border-macaron-purple">
                </div>
                <div>
                    <label class="text-xs text-macaron-purple font-bold ml-1">Ê®ôÈ°å</label>
                    <input v-model="modalForm.title" type="text" placeholder="Ë°åÁ®ãÂêçÁ®±" class="w-full bg-gray-50 p-3 rounded-xl mt-1 outline-none border focus:border-macaron-purple">
                </div>
                <div>
                    <label class="text-xs text-macaron-purple font-bold ml-1">Âú∞Èªû (Âú∞ÂúñÊêúÂ∞ãÁî®)</label>
                    <input v-model="modalForm.location" type="text" placeholder="Ëº∏ÂÖ•ÈóúÈçµÂ≠ó" class="w-full bg-gray-50 p-3 rounded-xl mt-1 outline-none border focus:border-macaron-purple">
                </div>
                <div>
                    <label class="text-xs text-macaron-purple font-bold ml-1">ÂÇôË®ª (ÁáüÊ•≠ÊôÇÈñì/Ë≥áË®ä)</label>
                    <textarea v-model="modalForm.desc" rows="3" placeholder="‰æãÂ¶ÇÔºöÁáüÊ•≠ÊôÇÈñì 10:00-22:00" class="w-full bg-gray-50 p-3 rounded-xl mt-1 outline-none border focus:border-macaron-purple resize-none"></textarea>
                </div>
            </div>
            <button @click="saveItem" class="w-full mt-6 py-3.5 bg-gray-800 text-white font-bold rounded-xl shadow-lg btn-press font-body">
                ÂÑ≤Â≠ò
            </button>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            // --- State ---
            const currentTab = ref('itinerary');
            const activeDay = ref(1);
            const showModal = ref(false);
            const isEditMode = ref(false);
            const mapQuery = ref('');
            
            // Guide
            const luggageList = ref([]);
            const newLuggageItem = ref('');
            const mustBuyList = ref([]);
            const newMustBuyItem = ref('');
            
            // Calculator
            const calcKRW = ref('');
            const exchangeRate = ref(41.5); 
            
            // Expenses
            const expenses = ref([]);
            const newExpense = ref({ date: '', item: '', amount: '' });

            // Modal Form
            const modalForm = ref({ id: null, time: '', title: '', location: '', desc: '' });

            // --- Fixed Data ---
            
            // Trip Date Mapping (Jan 21 - Jan 25, 2025)
            const tripDates = {
                1: { date: '01/21', day: 'ÈÄ±‰∫å', fullDay: '1Êúà21Êó• (ÈÄ±‰∫å)' },
                2: { date: '01/22', day: 'ÈÄ±‰∏â', fullDay: '1Êúà22Êó• (ÈÄ±‰∏â)' },
                3: { date: '01/23', day: 'ÈÄ±Âõõ', fullDay: '1Êúà23Êó• (ÈÄ±Âõõ)' },
                4: { date: '01/24', day: 'ÈÄ±‰∫î', fullDay: '1Êúà24Êó• (ÈÄ±‰∫î)' },
                5: { date: '01/25', day: 'ÈÄ±ÂÖ≠', fullDay: '1Êúà25Êó• (ÈÄ±ÂÖ≠)' },
            };

            // Simulated Daily Weather
            const simulatedWeather = ref({
                1: { code: 2, temp: 8, rain: 20 }, // Cloudy
                2: { code: 0, temp: 12, rain: 0 }, // Sunny
                3: { code: 51, temp: 6, rain: 70 }, // Rain
                4: { code: 1, temp: 10, rain: 10 }, // Mostly clear
                5: { code: 0, temp: 11, rain: 0 }, // Sunny
            });

            // Default Checklists
            const defaultLuggage = [
                { text: 'Ë≠∑ÁÖß / Á∞ΩË≠â', checked: false },
                { text: 'ÈüìÂπ£ÁèæÈáë / ‰ø°Áî®Âç°', checked: false },
                { text: 'ËΩâÊé•È†≠ (ÈüìÂúãÂúìÂ≠î)', checked: false },
                { text: 'Ë°åÂãïÈõªÊ∫ê / ÂÖÖÈõªÁ∑ö', checked: false },
                { text: 'ÁâôÂà∑ÁâôËÜè (ÈüìÂúãÁí∞‰øù‰∏çÊèê‰æõ)', checked: false },
                { text: 'ÂÄã‰∫∫Â∏∏ÂÇôËó•ÂìÅ', checked: false },
                { text: '‰øùÊöñË°£Áâ© / ÂúçÂ∑æ', checked: false },
                { text: 'Á∂≤Âç° / eSim', checked: false }
            ];

            const defaultMustBuy = [
                { text: 'Olive Young Ë≠∑ËÜöÂìÅ', checked: false },
                { text: 'Èõ∂È£ü (ÁÉèÈæúÈ§Ö‰πæ)', checked: false },
                { text: 'Kakao Friends Âë®ÈÇä', checked: false },
                { text: 'Market O Â∏ÉÊúóÂ∞º', checked: false },
                { text: 'Ë•™Â≠ê', checked: false }
            ];

            const emergencyContacts = [
                { name: 'Ë≠¶ÂØüÂ±Ä', number: '112', desc: 'Police' },
                { name: 'Ê∂àÈò≤/ÊïëË≠∑Ëªä', number: '119', desc: 'Fire/Ambulance' },
                { name: 'ÊóÖÈÅäË´ÆË©¢ÁÜ±Á∑ö', number: '1330', desc: 'Korea Travel Hotline' }
            ];

            // Itinerary Default Data (UPDATED based on user's detailed schedule)
            const defaultItinerary = [
                // --- Day 1 (Jan 21) ---
                { id: 100, day: 1, time: '09:00', title: 'ÂæûÂÆ∂Ë£°Âá∫Áôº', location: 'Ê°ÉÂúí', desc: 'ÂâçÂæÄÊ°ÉÂúíÊ©üÂ†¥ T2', isFlight: false },
                { id: 101, day: 1, time: '11:00', title: 'ÊäµÈÅîÊ°ÉÂúíÊ©üÂ†¥ T2', location: 'Ê°ÉÂúíÂúãÈöõÊ©üÂ†¥ T2', desc: 'Ëæ¶ÁêÜÂ†±Âà∞„ÄÅÊâòÈÅã„ÄÅÂá∫Â¢ÉÊµÅÁ®ã„ÄÇ', isFlight: false },
                // Flight Departure (BR180)
                { 
                    id: 102, day: 1, time: '14:25', title: 'Èï∑Ê¶ÆËà™Á©∫ BR180 (Ê°ÉÂúí‚ÜíÈáúÂ±±) ÂïüÁ®ã', 
                    location: 'Ê°ÉÂúíÂúãÈöõÊ©üÂ†¥ T2', 
                    desc: 'È†êË®à 17:40 ÊäµÈÅîÈáúÂ±±ÈáëÊµ∑Ê©üÂ†¥ (PUS)„ÄÇ', 
                    isFlight: true, flightNo: 'BR180',
                    depAirport: 'TPE', arrAirport: 'PUS', depTime: '14:25', 
                    terminal: 'T2', gate: 'TBD', boardingTime: '13:55', type: 'departure' 
                },
                { id: 103, day: 1, time: '17:40', title: 'ÊäµÈÅîÈáúÂ±±ÈáëÊµ∑Ê©üÂ†¥ (PUS)', location: 'Gimhae International Airport', desc: 'ÂÖ•Â¢ÉËàáÈ†òÂèñË°åÊùé (Á¥Ñ 20-30 ÂàÜÈêò)„ÄÇ', isFlight: false },
                { id: 104, day: 1, time: '18:20', title: 'Ê©üÂ†¥ $\rightarrow$ È£ØÂ∫ó (‰∫§ÈÄöËΩâ‰πò)', location: 'ÈáúÂ±±ÈáëÊµ∑Ê©üÂ†¥', desc: 'ËºïËªåÔºöÈáëÊµ∑Ê©üÂ†¥Á´ô $\rightarrow$ Ê≤ô‰∏äÁ´ô / Âú∞ÈêµÔºöÊ≤ô‰∏ä $\rightarrow$ Ë•øÈù¢ $\rightarrow$ ÂçóÊµ¶Á´ô„ÄÇÁ∏Ω‰∫§ÈÄöÊôÇÈñìÁ¥Ñ 60 ÂàÜÈêò„ÄÇ', isFlight: false },
                { id: 105, day: 1, time: '19:00', title: 'ÈáúÂ±±‰∫ûÈõ≤Ê®πÈ£ØÂ∫ó Check-in', location: 'Hotel Aventree Busan', desc: 'Ëæ¶ÁêÜÂÖ•‰ΩèÊâãÁ∫å„ÄÇ', isFlight: false },
                { id: 106, day: 1, time: '20:00', title: 'ÊôöÈ§êËàáÂ§úÈñìËá™Áî±Ê¥ªÂãï', location: 'ÂçóÊµ¶Ê¥û (ÊâéÂòéÂÖ∂Â∏ÇÂ†¥/BIFF/ÂØåÂπ≥)', desc: 'ÊôöÈ§êÂª∫Ë≠∞ÔºöÂçóÊµ¶ËîòÈõûÊπØ / ÂÖÉÁ•ñÈáúÂ±±Ë±¨ËÖ≥„ÄÇ\nÊ¥ªÂãïÔºöÊâéÂòéÂÖ∂Â∏ÇÂ†¥„ÄÅBIFF Âª£Â†¥ÔºàÂ∞èÂêÉÔºâ„ÄÅÂúãÈöõÂ∏ÇÂ†¥„ÄÅÂØåÂπ≥Â∏ÇÂ†¥ÔºàÁΩêÈ†≠Â∏ÇÂ†¥Ôºâ„ÄÇ', isFlight: false },
                
                // --- Day 2 (Jan 22) ---
                { id: 201, day: 2, time: '08:00', title: 'ÂæûÂçóÊµ¶Ê¥ûÂá∫Áôº $\rightarrow$ Êµ∑Èõ≤Âè∞Á´ô', location: 'Êµ∑Èõ≤Âè∞Á´ô', desc: 'Âú∞ÈêµÁ¥Ñ 50 ÂàÜÈêòÔºåË®àÁ®ãËªäÁ¥Ñ 25-30 ÂàÜÈêòÔºàÊé®Ëñ¶Ë®àÁ®ãËªäÔºâ„ÄÇ', isFlight: false },
                { id: 202, day: 2, time: '09:00', title: 'Êµ∑Èõ≤Âè∞ÂÇ≥Áµ±Â∏ÇÂ†¥ (Êó©È§ê)', location: 'Ìï¥Ïö¥ÎåÄ Ï†ÑÌÜµÏãúÏû•', desc: 'Êé®Ëñ¶ÔºöÊâãÂ∑•È£ØÊç≤„ÄÅÊµ∑ÈÆÆÁÖéÈ§ÖÁ≠âÂú®Âú∞ÁæéÈ£ü„ÄÇÂÅúÁïôÁ¥Ñ 40 ÂàÜÈêò„ÄÇ', isFlight: false },
                { id: 203, day: 2, time: '09:45', title: 'Êµ∑Èõ≤Âè∞Êµ∑ÈÇäÊï£Ê≠•', location: 'Êµ∑Èõ≤Âè∞Êµ∑ÈÇä', desc: 'Á∞°ÂñÆÊï£Ê≠•„ÄÅÊãçÁÖß„ÄÇ', isFlight: false },
                { id: 204, day: 2, time: '10:00', title: 'ÂâçÂæÄÊµ∑Êù±ÈæçÂÆÆÂØ∫', location: 'Êµ∑Êù±ÈæçÂÆÆÂØ∫', desc: '‰∫§ÈÄöÔºöË®àÁ®ãËªäËªäÁ®ãÁ¥Ñ 15-18 ÂàÜÈêòÔºàÊúÄÁúÅÊôÇÔºâ„ÄÇ', isFlight: false },
                { id: 205, day: 2, time: '10:20', title: 'Êµ∑Êù±ÈæçÂÆÆÂØ∫ ÂèÉËßÄ', location: 'Ìï¥ÎèôÏö©Í∂ÅÏÇ¨', desc: 'ÂèÉËßÄÔºöÈæçÈñÄÁü≥Ê©ã„ÄÅËßÄÈü≥ÂÉè„ÄÅÊµ∑Â≤∏Ê≠•ÈÅì„ÄÇÂÅúÁïôÁ¥Ñ 1.2 Â∞èÊôÇ„ÄÇ', isFlight: false },
                { id: 206, day: 2, time: '11:40', title: 'Ê®ÇÂ§© Outlet (Êù±ÈáúÂ±±Â∫ó)', location: 'Î°ØÎç∞ÌîÑÎ¶¨ÎØ∏ÏóÑÏïÑÏö∏Î†õ ÎèôÎ∂ÄÏÇ∞Ï†ê', desc: 'ÂèØÂú®Ê≠§Áî®È§êÂèäË≥ºÁâ© (ÂΩàÊÄßË°åÁ®ã)„ÄÇ', isFlight: false },
                { id: 207, day: 2, time: '14:10', title: 'Êñ∞‰∏ñÁïåÁôæË≤® (Centum City)', location: 'Ïã†ÏÑ∏Í≥ÑÎ∞±ÌôîÏ†ê ÏÑºÌÖÄÏãúÌã∞', desc: 'ÈÄõË°ó„ÄÅÂ∞èÈªûÂøÉ„ÄÇ', isFlight: false },
                { id: 208, day: 2, time: '15:00', title: 'SPA LAND Ê±óËí∏Âπï', location: 'SPA LAND (Êñ∞‰∏ñÁïåÁôæË≤® B1)', desc: '‰ºëÊÅØÊîæÈ¨ÜÔºåÈ´îÈ©óË®≠ÊñΩ„ÄÇÂÅúÁïôÁ¥Ñ 2 Â∞èÊôÇ„ÄÇ', isFlight: false },
                { id: 209, day: 2, time: '17:20', title: 'ËøîÂõûÂçóÊµ¶Ê¥û (Âú∞Èêµ)', location: 'ÂçóÊµ¶Á´ô', desc: 'Âú∞ÈêµÔºöCentum City $\rightarrow$ Ë•øÈù¢ $\rightarrow$ ÂçóÊµ¶Ê¥û (Á¥Ñ 45 ÂàÜÈêò)„ÄÇ', isFlight: false },
                { id: 210, day: 2, time: '18:10', title: 'ÂçóÊµ¶Ê¥ûÊôöÈ§êËàáÂ§úÈñìÈÄõË°ó', location: 'ÂçóÊµ¶Ê¥û / Ë•øÈù¢Âú∞‰∏ãË°ó', desc: 'ÊôöÈ§êÂª∫Ë≠∞Ôºö‰ºçÁè≠Èï∑ÁáíËÇâ (Êµ∑Èõ≤Âè∞) / ÂçóÊµ¶Ê¥ûÂë®ÈÇäÈ§êÂª≥„ÄÇÊ¥ªÂãïÔºö(A) Ë•øÈù¢Âú∞‰∏ãË°óÊñáÂâµÂ∫ó (B) ÂçóÊµ¶Ê¥û KPOP Âî±ÁâáË°å„ÄÇ', isFlight: false },

                // --- Day 3 (Jan 23) ---
                { id: 301, day: 3, time: '09:00', title: 'KKday ÈáúÂ±±‰∏ÄÊó•ÈÅä ÈõÜÂêàÂá∫Áôº', location: 'ÈáúÂ±±Á´ô 1 ËôüÂá∫Âè£', desc: '‰∫§ÈÄöÊñπÂºèÔºö‰∏ÄÊó•ÈÅäÂ∑¥Â£´„ÄÇ', isFlight: false },
                { id: 302, day: 3, time: '10:30', title: 'Â§©Á©∫ËÜ†Âõä (ËóçÁ∑öÂÖ¨Âúí)', location: 'Êµ∑ÈÇäÂàóËªä (Ï≤≠ÏÇ¨Ìè¨)', desc: 'È´îÈ©óÊµ∑Â≤∏ËÜ†ÂõäÂàóËªä„ÄÇ', isFlight: false },
                { id: 303, day: 3, time: '13:10', title: 'Êµ∑Êù±ÈæçÂÆÆÂØ∫ (Êú¨Êó•Á¨¨‰∫åÊ¨°ÈÄ†Ë®™)', location: 'Ìï¥ÎèôÏö©Í∂ÅÏÇ¨', desc: 'KKday Ë°åÁ®ãÂÆâÊéí„ÄÇÂçàÈ§êÂª∫Ë≠∞ÔºöÈÅìÁÜôÂÆ∂Êµ∑ÈÆÆ (ËøëÈùíÊ≤ôÊµ¶)„ÄÇ', isFlight: false },
                { id: 304, day: 3, time: '15:00', title: '‰ΩõÂúãÂØ∫ (ÊÖ∂Â∑û‰∏ñÁïåÈÅ∫Áî¢)', location: '‰ΩõÂúãÂØ∫', desc: 'ÊÖ∂Â∑û‰∏ñÁïåÈÅ∫Áî¢„ÄÇ', isFlight: false },
                { id: 305, day: 3, time: '16:40', title: 'Â§ßÈôµÈô¢ + ÁöáÁêÜÂúòË∑Ø', location: 'ÊÖ∂Â∑ûÂ§ßÈôµÈô¢ / ÁöáÁêÜÂúòË∑Ø', desc: 'ÊÖ∂Â∑ûÊ≠∑Âè≤ÊñáÂåñÂçÄÊï£Á≠ñ„ÄÇ', isFlight: false },
                { id: 306, day: 3, time: '19:00', title: 'Êù±ÂÆÆËàáÊúàÊ±† (ÈõÅÈ¥®Ê±†) Â§úÊôØ', location: 'Êù±ÂÆÆËàáÊúàÊ±†', desc: 'Ê¨£Ë≥ûÊÖ∂Â∑ûËëóÂêçÂ§úÊôØ„ÄÇ', isFlight: false },
                { id: 307, day: 3, time: '21:50', title: '‰∏ÄÊó•ÈÅäËøîÂõûÈáúÂ±±Á´ô', location: 'ÈáúÂ±±Á´ô', desc: 'ÂèØÈÅ∏ÊìáÂú®Ë•øÈù¢Á´ôÊèêÂâç‰∏ãËªäÔºåÈÄõË•øÈù¢Â§ßÂâµ 2 ËôüÂ∫ó„ÄÇ', isFlight: false },

                // --- Day 4 (Jan 24) ---
                { id: 401, day: 4, time: '08:00', title: 'È£ØÂ∫óÂá∫Áôº / Êó©È§ê', location: 'ÂçóÊµ¶Ê¥û', desc: 'ÂæûÈ£ØÂ∫óÂá∫ÁôºÔºåÊ∫ñÂÇôÂâçÂæÄÊùæÂ≥∂„ÄÇ', isFlight: false },
                { id: 402, day: 4, time: '09:30', title: 'ÊùæÂ≥∂Â§©Á©∫Ê≠•ÈÅì', location: 'ÏÜ°ÎèÑÏä§Ïπ¥Ïù¥ÏõåÌÅ¨', desc: '‰∫§ÈÄöÔºöÂæûÊú≠ÂòéÂÖ∂Á´ôÂè´ËªäÁ¥Ñ 5 ÂàÜÈêòÊäµÈÅî„ÄÇÂÅúÁïôÁ¥Ñ 20-30 ÂàÜÈêò„ÄÇ', isFlight: false },
                { id: 403, day: 4, time: '10:20', title: 'ÊùæÂ≥∂Êµ∑‰∏äÁ∫úËªä (Air Cruise)', location: 'ÏÜ°ÎèÑÌï¥ÏÉÅÏºÄÏù¥Î∏îÏπ¥', desc: 'Âª∫Ë≠∞Êê≠‰πò‰æÜÂõûÔºåËßÄË≥ûÊµ∑ÊôØ„ÄÇÁ¥Ñ 1 Â∞èÊôÇ„ÄÇ', isFlight: false },
                { id: 404, day: 4, time: '11:30', title: 'ÂçàÈ§ê (Ê®ÇÂ§©ÁôæË≤®ÂÖâÂæ©Â∫ó)', location: 'Î°ØÎç∞Î∞±ÌôîÏ†ê Í¥ëÎ≥µÏ†ê', desc: 'Âú®ÁôæË≤®ÂÖßÁî®È§ê„ÄÇ', isFlight: false },
                { id: 405, day: 4, time: '13:20', title: 'Ê®ÇÂ§©ÁôæË≤®È†ÇÊ®ì (ÊòüÂÖâËä±Âúí)', location: 'Ê®ÇÂ§©ÁôæË≤®ÂÖâÂæ©Â∫óÈ†ÇÊ®ì', desc: 'ÊèêÊó©ÊäµÈÅîËßÄÊôØ‰ΩçÔºåÊ∫ñÂÇôËßÄË≥ûÈñãÊ©ãÂÑÄÂºè„ÄÇ', isFlight: false },
                { id: 406, day: 4, time: '14:00', title: 'ËßÄË≥ûÂΩ±Â≥∂Â§ßÊ©ãÈñãÊ©ãÂÑÄÂºè', location: 'ÂΩ±Â≥∂Â§ßÊ©ã (ËßÄË≥ûÈªû)', desc: 'Ê∫ñÊôÇÈñãÂßãÔºåÁ¥Ñ 5-7 ÂàÜÈêò„ÄÇÁÇ∫ÊúÄ‰Ω≥‰øØÁû∞ËßíÂ∫¶„ÄÇ', isFlight: false },
                { id: 407, day: 4, time: '15:00', title: 'ÁôΩÊ∑∫ÁÅòÊñáÂåñÊùë', location: 'Ìù∞Ïó¨Ïö∏Î¨∏ÌôîÎßàÏùÑ', desc: '‰∫§ÈÄöÔºöË®àÁ®ãËªäÂæûÊ®ÇÂ§©ÁôæË≤®Êê≠ËªäÁ¥Ñ 10-12 ÂàÜÈêò„ÄÇÂÅúÁïôÁ¥Ñ 40-60 ÂàÜÈêò„ÄÇ', isFlight: false },
                { id: 408, day: 4, time: '16:00', title: 'Â§™ÂÆóÂè∞ÈÅäÂúíÂú∞', location: 'ÌÉúÏ¢ÖÎåÄÏú†ÏõêÏßÄ', desc: 'ÈúÄÊê≠‰πò„Äå‰∏πÈùíÂàóËªä„ÄçÈÅäË¶ΩÁáàÂ°î„ÄÅËßÄÊôØÂè∞„ÄÇÂÅúÁïôÁ¥Ñ 1.5 Â∞èÊôÇ„ÄÇ', isFlight: false },
                { id: 409, day: 4, time: '18:30', title: 'ËøîÂõûÂçóÊµ¶Ê¥ûÊôöÈ§ê', location: 'ÂçóÊµ¶Ê¥û', desc: 'ËªäÁ®ãÁ¥Ñ 20 ÂàÜÈêò„ÄÇ', isFlight: false },
                { id: 410, day: 4, time: '20:00', title: 'ÈáúÂ±±Â°îÂ§úÊôØ', location: 'Î∂ÄÏÇ∞ÌÉÄÏõå/Ïö©ÎëêÏÇ∞Í≥µÏõê', desc: 'Ê≠•Ë°å/ÊâãÊâ∂Ê¢ØËá≥ÈæçÈ†≠Â±±ÂÖ¨ÂúíÔºå‰øØÁû∞ÂçóÊµ¶Â§úÊôØ„ÄÇÂÅúÁïôÁ¥Ñ 40-60 ÂàÜÈêò„ÄÇ', isFlight: false },
                { id: 411, day: 4, time: '21:00', title: 'ÂçóÊµ¶Ê¥ûËá™Áî±ÈÄõË°ó / BIFF Âª£Â†¥', location: 'ÂçóÊµ¶Ê¥û / BIFF Í¥ëÏû•', desc: 'Â§úÈñìËá™Áî±Ê¥ªÂãï„ÄÇ', isFlight: false },

                // --- Day 5 (Jan 25) ---
                { id: 501, day: 5, time: '08:00', title: 'Êó©È§ê + Êï¥ÁêÜË°åÊùé', location: 'ÈáúÂ±±‰∫ûÈõ≤Ê®πÈ£ØÂ∫ó', desc: 'Check Out TimeÔºö11:00 AMÔºåË°åÊùéÂØÑÊîæÊ´ÉÊ™Ø„ÄÇ', isFlight: false },
                { id: 502, day: 5, time: '09:00', title: 'È£ØÂ∫ó $\rightarrow$ ÁîòÂ∑ùÊ¥ûÊñáÂåñÊùë', location: 'ÁîòÂ∑ùÊ¥ûÊñáÂåñÊùë', desc: '‰∫§ÈÄöÔºöË®àÁ®ãËªäÂæûÂçóÊµ¶Ê¥ûÊê≠ËªäÁ¥Ñ 10-15 ÂàÜÈêò„ÄÇ', isFlight: false },
                { id: 503, day: 5, time: '09:15', title: 'ÁîòÂ∑ùÊ¥ûÊñáÂåñÊùëÊï£Á≠ñ', location: 'Í∞êÏ≤úÎ¨∏ÌôîÎßàÏùÑ', desc: 'Âª∫Ë≠∞ÂèÉËßÄÔºöÂ∞èÁéãÂ≠êÊãçÁÖßÈªû„ÄÅËßÄÊôØÂπ≥Âè∞„ÄÇÂÅúÁïôÁ¥Ñ 2 Â∞èÊôÇ„ÄÇ', isFlight: false },
                { id: 504, day: 5, time: '11:30', title: 'ËøîÂõûÂçóÊµ¶Ê¥û', location: 'ÂçóÊµ¶Ê¥û', desc: '‰∫§ÈÄöÔºöË®àÁ®ãËªäËªäÁ®ãÁ¥Ñ 10-15 ÂàÜÈêò„ÄÇ', isFlight: false },
                { id: 505, day: 5, time: '11:45', title: 'ÂçàÈ§ê (ÂçóÊµ¶Ê¥û)', location: 'ÂçóÊµ¶Ê¥û', desc: 'ÂèØÈÅ∏ÊìáÂÖÉÁ•ñËîòÈõûÊπØ„ÄÅÂØåÂπ≥Â∏ÇÂ†¥Â∞èÂêÉÁ≠â„ÄÇ', isFlight: false },
                { id: 506, day: 5, time: '13:00', title: 'ÂçóÊµ¶Ê¥ûËá™Áî±Ê¥ªÂãï/Ë≥ºÁâ©', location: 'ÂÖâÂæ©Ë∑ØË≥ºÁâ©Ë°ó', desc: 'ÈÄ≤Ë°åÊúÄÂæåÁöÑË≥ºÁâ©Ë£úË≤®„ÄÇ', isFlight: false },
                { id: 507, day: 5, time: '14:30', title: 'ÂõûÈ£ØÂ∫óÈ†òË°åÊùé', location: 'ÈáúÂ±±‰∫ûÈõ≤Ê®πÈ£ØÂ∫ó', desc: 'Ê™¢Êü•Ë≠∑ÁÖß„ÄÅÈÄÄÁ®ÖÂñÆÁ≠âÈáçË¶ÅÁâ©ÂìÅ„ÄÇ', isFlight: false },
                { id: 508, day: 5, time: '15:00', title: 'ÂçóÊµ¶Ê¥û $\rightarrow$ ÈáëÊµ∑Ê©üÂ†¥', location: 'Gimhae International Airport', desc: '‰∫§ÈÄöÔºöÂú∞Èêµ $\rightarrow$ ËºïËªå„ÄÇÈúÄÈ†êÁïôË∂≥Â§†ÊôÇÈñì (ÂÖ®Á®ãÁ¥Ñ 60 ÂàÜÈêò)„ÄÇ', isFlight: false },
                { id: 509, day: 5, time: '16:00', title: 'ÊäµÈÅîÈáëÊµ∑Ê©üÂ†¥', location: 'Gimhae International Airport', desc: 'Ëæ¶ÁêÜÂ†±Âà∞„ÄÅÊâòÈÅã„ÄÅKIOSK ÊéÉÊèèÈÄÄÁ®ÖÊ¢ùÁ¢º„ÄÇ', isFlight: false },
                { id: 510, day: 5, time: '17:20', title: 'ÂÄôÊ©ü/ÂÖçÁ®ÖÂ∫óË≥ºÁâ©/È†òÈÄÄÁ®ÖÈáë', location: 'Gimhae International Airport', desc: 'Âá∫Â¢ÉÂæåÂà∞ 4 ËôüÂçÄÂüüÁöÑÈÄÄÁ®ÖÊ´ÉÊ™ØÈ†òÂèñÁèæÈáë„ÄÇ', isFlight: false },
                // Flight Return (BR163)
                { 
                    id: 511, day: 5, time: '18:55', title: 'ÂõûÁ®ã: Èï∑Ê¶ÆËà™Á©∫ BR163 (ÈáúÂ±±‚ÜíÊ°ÉÂúí) ÂïüÁ®ã', 
                    location: 'Gimhae International Airport', 
                    desc: 'È†êË®à 20:25 ÊäµÈÅîÊ°ÉÂúíÊ©üÂ†¥ T2„ÄÇ', 
                    isFlight: true, flightNo: 'BR163',
                    depAirport: 'PUS', arrAirport: 'TPE', depTime: '18:55', 
                    terminal: 'Intl', gate: 'TBD', boardingTime: '18:25', type: 'return' 
                },
                { id: 512, day: 5, time: '20:25', title: 'ÊäµÈÅîÊ°ÉÂúíÊ©üÂ†¥', location: 'Ê°ÉÂúíÂúãÈöõÊ©üÂ†¥ T2', desc: 'ÊóÖË°åÁµêÊùü', isFlight: false },
            ];

            const itinerary = ref([]);
            
            // --- Lifecycle ---
            onMounted(() => {
                newExpense.value.date = new Date().toISOString().split('T')[0];

                // Load from LocalStorage
                // NOTE: Changed storage key to v6 to force new default data load
                const savedItinerary = localStorage.getItem('busan_2026_v6_itinerary'); 
                const savedExpenses = localStorage.getItem('busan_2026_v5_expenses');
                const savedRate = localStorage.getItem('busan_2026_rate');
                const savedLuggage = localStorage.getItem('busan_2026_luggage_v5');
                const savedMustBuy = localStorage.getItem('busan_2026_mustbuy_v5');
                
                // If saved itinerary is missing, use the new default data
                itinerary.value = savedItinerary ? JSON.parse(savedItinerary) : defaultItinerary;
                if (savedExpenses) expenses.value = JSON.parse(savedExpenses);
                if (savedRate && parseFloat(savedRate) > 0) {
                     exchangeRate.value = parseFloat(savedRate);
                } else {
                     exchangeRate.value = 41.5; // Default if saved is 0 or invalid
                }
                luggageList.value = savedLuggage ? JSON.parse(savedLuggage) : defaultLuggage;
                mustBuyList.value = savedMustBuy ? JSON.parse(savedMustBuy) : defaultMustBuy;
            });

            // --- Watchers for Auto-Save ---
            watch([itinerary, expenses, exchangeRate, luggageList, mustBuyList], () => {
                localStorage.setItem('busan_2026_v6_itinerary', JSON.stringify(itinerary.value));
                localStorage.setItem('busan_2026_v5_expenses', JSON.stringify(expenses.value));
                localStorage.setItem('busan_2026_rate', exchangeRate.value);
                localStorage.setItem('busan_2026_luggage_v5', JSON.stringify(luggageList.value));
                localStorage.setItem('busan_2026_mustbuy_v5', JSON.stringify(mustBuyList.value));
            }, { deep: true });

            // --- Computed ---
            const filteredItinerary = computed(() => {
                return itinerary.value
                    .filter(item => item.day === activeDay.value)
                    .sort((a, b) => a.time.localeCompare(b.time));
            });

            const totalExpenseTWD = computed(() => {
                const totalKRW = expenses.value.reduce((sum, item) => sum + item.amount, 0);
                const rate = Number(exchangeRate.value);
                if (rate <= 0 || isNaN(rate)) return 0;
                return Math.round(totalKRW / rate);
            });
            
            const calculatedTWD = computed(() => {
                const krw = Number(calcKRW.value) || 0;
                const rate = Number(exchangeRate.value); 
                
                if (rate <= 0 || isNaN(rate)) {
                    return 0; // Return 0 if rate is unusable
                }
                
                return Math.round(krw / rate);
            });

            // Flight Info Extraction (Now includes terminal and boarding time)
            const flightInfo = computed(() => {
                const dep = itinerary.value.find(i => i.isFlight && i.type === 'departure');
                const ret = itinerary.value.find(i => i.isFlight && i.type === 'return');
                
                // Default placeholders (UPDATED with BR180/BR163)
                const defaultDep = { flightNo: 'BR180', depAirport: 'TPE', arrAirport: 'PUS', depTime: '14:25', terminal: 'T2', gate: 'TBD', boardingTime: '13:55' };
                const defaultRet = { flightNo: 'BR163', depAirport: 'PUS', arrAirport: 'TPE', depTime: '18:55', terminal: 'Intl', gate: 'TBD', boardingTime: '18:25' };

                return {
                    departure: dep || defaultDep,
                    return: ret || defaultRet
                };
            });

            // Hotel Info Extraction (UPDATED)
            const hotelInfo = computed(() => {
                return {
                    name: 'ÈáúÂ±±‰∫ûÈõ≤Ê®πÈ£ØÂ∫ó (Hotel Aventree Busan)',
                    address: 'ÈáúÂ±±Âª£ÂüüÂ∏Ç‰∏≠ÂçÄÂçóÊµ¶Ë°ó 25 / Î∂ÄÏÇ∞ Ï§ëÍµ¨ ÎÇ®Ìè¨Í∏∏ 25', // Updated Address
                };
            });


            // --- Methods ---
            
            // Utility Methods
            const getDayInfo = (dayIndex) => tripDates[dayIndex] || { date: `Day ${dayIndex}`, day: '', fullDay: `Day ${dayIndex}` };
            
            const openModal = (item) => {
                if (item) {
                    isEditMode.value = true;
                    // Prevent editing flight items via this modal
                    if (item.isFlight) return alert('Ëà™Áè≠Ë≥áË®äË´ãÁõ¥Êé•Âú®„ÄåÊ©üÁ•®/‰ΩèÂÆø„ÄçÈ†ÅÈù¢‰∏≠Ê™¢Ë¶ñ„ÄÇ'); 

                    modalForm.value = { ...item };
                } else {
                    isEditMode.value = false;
                    modalForm.value = { id: Date.now(), time: '12:00', title: '', location: '', desc: '' };
                }
                showModal.value = true;
            };

            const saveItem = () => {
                if (!modalForm.value.title) return;
                if (isEditMode.value) {
                    const index = itinerary.value.findIndex(i => i.id === modalForm.value.id);
                    if (index !== -1) itinerary.value[index] = { ...modalForm.value };
                } else {
                    itinerary.value.push({ ...modalForm.value, day: activeDay.value, location: modalForm.value.location || modalForm.value.title, isFlight: false });
                }
                showModal.value = false;
            };

            const deleteItem = (id) => {
                if(confirm('Á¢∫ÂÆöÂà™Èô§Ê≠§Ë°åÁ®ãÂóéÔºü')) itinerary.value = itinerary.value.filter(item => item.id !== id);
            };

            // Expense Methods
            const addExpense = () => {
                if (!newExpense.value.item || !newExpense.value.amount) return;
                expenses.value.unshift({
                    date: newExpense.value.date || new Date().toISOString().split('T')[0],
                    item: newExpense.value.item,
                    amount: Number(newExpense.value.amount) // Ensure number type
                });
                newExpense.value.item = '';
                newExpense.value.amount = '';
            };

            const removeExpense = (index) => {
                if(confirm('Âà™Èô§ÈÄôÁ≠ÜÂ∏≥ÁõÆÔºü')) expenses.value.splice(index, 1);
            };

            // Luggage Methods
            const addLuggage = () => {
                if(!newLuggageItem.value) return;
                luggageList.value.push({ text: newLuggageItem.value, checked: false });
                newLuggageItem.value = '';
            };
            const removeLuggage = (index) => {
                luggageList.value.splice(index, 1);
            };

            // Must-Buy Methods
            const addMustBuy = () => {
                if(!newMustBuyItem.value) return;
                mustBuyList.value.push({ text: newMustBuyItem.value, checked: false });
                newMustBuyItem.value = '';
            };
            const removeMustBuy = (index) => {
                mustBuyList.value.splice(index, 1);
            };

            // Utility Methods
            const searchNaverMap = () => {
                const q = mapQuery.value || 'Busan';
                window.open(`https://map.naver.com/p/search/${encodeURIComponent(q)}`, '_blank');
            };
            // FIX: Use a proper Google Maps search URL
            const searchGoogleMap = () => {
                const q = mapQuery.value || 'Busan';
                window.open(`https://www.google.com/maps/search/${encodeURIComponent(q)}`, '_blank');
            };
            const getNaverMapLink = (query) => `https://map.naver.com/p/search/${encodeURIComponent(query)}`;
            
            const formatNumber = (num) => num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");

            // Weather Icon Mapping (Simple)
            const getWeatherIcon = (code) => {
                if (code === 0) return '‚òÄÔ∏è'; // Sunny
                if (code === 1) return 'üå•Ô∏è'; // Mostly Clear
                if (code <= 3) return '‚òÅÔ∏è'; // Cloudy
                if (code <= 67) return 'üåßÔ∏è'; // Rain
                return 'üå•Ô∏è'; // Default
            };

            return {
                currentTab, activeDay, showModal, isEditMode, modalForm,
                itinerary, expenses, exchangeRate, filteredItinerary,
                totalExpenseTWD, newExpense, mapQuery,
                luggageList, newLuggageItem, mustBuyList, newMustBuyItem,
                flightInfo, hotelInfo, emergencyContacts, simulatedWeather, tripDates,
                calculatedTWD, calcKRW,
                openModal, saveItem, deleteItem, addExpense, removeExpense,
                addLuggage, removeLuggage, addMustBuy, removeMustBuy,
                formatNumber, searchNaverMap, searchGoogleMap, getNaverMapLink, getWeatherIcon, getDayInfo
            };
        }
    }).mount('#app');
</script>
</body>
</html>
