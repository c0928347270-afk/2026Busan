<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
    <title>韓國釜山 JAN 2026 </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Inter:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bp-pink: #f8a5c2;
            --bp-dark: #000000;
            --bp-card: #161616;
            --bp-border: #2a2a2a;
        }
        body {
            font-family: 'Noto Sans TC', 'Inter', sans-serif;
            background-color: var(--bp-dark);
            color: #ffffff;
            overflow-x: hidden;
            padding-bottom: 110px;
            width: 100vw;
        }
        .text-pink { color: var(--bp-pink); }
        .bg-pink { background-color: var(--bp-pink); }
        
        /* 緊湊列表樣式 */
        .itinerary-item {
            background: var(--bp-card);
            border-bottom: 2px solid var(--bp-dark);
            width: 100%;
            transition: background 0.2s;
        }
        .itinerary-item:active {
            background: #1a1a1a;
        }

        .item-header {
            background: rgba(255, 255, 255, 0.08);
            border-bottom: 1px solid var(--bp-border);
        }

        .food-item {
            border-left: 10px solid var(--bp-pink);
            background: #211216;
        }

        .view-content {
            display: none;
            animation: fadeIn 0.2s ease-out;
            width: 100%;
        }
        .view-content.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* iOS 固定底部導覽列 */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 85px;
            background: rgba(10, 10, 10, 0.98);
            backdrop-filter: blur(20px);
            border-top: 1px solid #222;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding-bottom: env(safe-area-inset-bottom);
            z-index: 100;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            color: #555;
            flex: 1;
        }
        .nav-item.active {
            color: var(--bp-pink);
        }
        .nav-item i { width: 28px; height: 28px; }
        .nav-item span { font-size: 12px; font-weight: 900; text-transform: uppercase; }

        .active-day-pill {
            background-color: var(--bp-pink) !important;
            color: #000 !important;
            border-color: var(--bp-pink) !important;
        }

        main { width: 100%; max-width: 500px; margin: 0 auto; }

        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button {
            -webkit-appearance: none; margin: 0;
        }
        input[type=number] { -moz-appearance: textfield; }

        .calc-input-box {
            background-color: var(--bp-pink);
            padding: 24px;
            border-radius: 24px;
            border: 2px solid white;
            box-shadow: 0 4px 15px rgba(248, 165, 194, 0.4);
        }
        .calc-input-box input {
            color: #000 !important;
            font-weight: 900 !important;
        }
    </style>
</head>
<body class="selection:bg-[#f8a5c2] selection:text-black">

    <header id="main-header" class="pt-12 pb-6 border-b border-[#f8a5c2]/20 text-center bg-black">
        <h1 class="text-4xl font-black tracking-tighter text-pink uppercase leading-none">Busan 부산 Korea</h1>
        <p class="text-base tracking-[0.2em] text-gray-400 font-black mt-2 uppercase">韓國釜山 JAN 2026</p>
    </header>

    <main class="px-3 pt-6">

        <!-- 視圖 1: 行程 -->
        <div id="view-itinerary" class="view-content active">
            <!-- 航班與住宿快速資訊 -->
            <div class="mb-4 space-y-2">
                <div class="p-4 bg-[#111] border border-[#222] rounded-2xl flex items-center gap-3">
                    <i data-lucide="plane" class="text-pink w-5 h-5"></i>
                    <div class="text-xs font-bold leading-tight">
                        去: 1/21 BR164 (T2) 14:25 | 回: 1/25 BR163 18:55
                    </div>
                </div>
                <div class="p-4 bg-[#111] border border-[#222] rounded-2xl flex items-center gap-3">
                    <i data-lucide="hotel" class="text-pink w-5 h-5"></i>
                    <div class="text-xs font-bold leading-tight">
                        NEWCZ NAMPO HOTEL (1/21-1/25)
                    </div>
                </div>
            </div>

            <!-- 天數導覽列：單排固定顯示 -->
            <div id="day-nav" class="grid grid-cols-5 gap-1.5 pb-4 sticky top-[0px] z-30 py-3 bg-black"></div>
            <div id="itinerary-list" class="space-y-3"></div>
        </div>

        <!-- 視圖 2: 匯率 -->
        <div id="view-calculator" class="view-content">
            <div class="mb-6 text-center px-2">
                <p class="text-gray-400 text-sm tracking-widest mt-2 font-black uppercase italic">Rate: 1 TWD : 41.5 KRW</p>
            </div>
            <div class="space-y-6">
                <div class="calc-input-box">
                    <label class="text-xs font-black tracking-widest mb-2 block text-black/60 uppercase">KRW 韓元</label>
                    <div class="flex items-center">
                        <span class="text-3xl font-mono mr-3 font-black text-black">₩</span>
                        <input type="number" inputmode="decimal" id="krw-input" placeholder="0" class="w-full text-5xl font-mono bg-transparent outline-none text-black font-black">
                    </div>
                </div>
                
                <div class="flex justify-center -my-8 relative z-10">
                    <div class="w-14 h-14 rounded-full bg-white flex items-center justify-center text-black shadow-lg border-4 border-pink">
                        <i data-lucide="arrow-down-up" class="w-6 h-6"></i>
                    </div>
                </div>

                <div class="calc-input-box">
                    <label class="text-xs font-black tracking-widest mb-2 block text-black/60 uppercase">TWD 台幣</label>
                    <div class="flex items-center">
                        <span class="text-2xl font-mono mr-3 font-black text-black">$</span>
                        <input type="number" inputmode="decimal" id="twd-input" placeholder="0" class="w-full text-4xl font-mono bg-transparent outline-none text-black font-black">
                    </div>
                </div>
            </div>
        </div>

        <!-- 視圖 3: 紀錄 -->
        <div id="view-shopping" class="view-content">
            <div class="mb-8 px-2">
                <h2 class="text-4xl font-black italic uppercase text-pink">Shopping</h2>
                <p class="text-[10px] text-gray-600 mt-1 tracking-tighter uppercase font-bold tracking-widest italic">Offline Persistent Mode</p>
            </div>
            <div class="bg-[#111] p-6 border-2 border-[#222] rounded-2xl mb-8">
                <div class="grid grid-cols-12 gap-3">
                    <input type="text" id="exp-item" placeholder="品項名稱" class="col-span-7 bg-black border border-[#333] p-4 text-base rounded-xl font-black text-white outline-none focus:border-pink">
                    <input type="number" inputmode="decimal" id="exp-cost" placeholder="KRW" class="col-span-3 bg-black border border-[#333] p-4 text-base rounded-xl font-mono text-white outline-none focus:border-pink">
                    <button id="add-expense-btn" class="col-span-2 bg-pink text-black rounded-xl font-black text-3xl active:scale-90 transition-transform shadow-lg">+</button>
                </div>
            </div>
            <div id="expense-container" class="space-y-4 mb-40 px-1"></div>
            <div class="fixed bottom-[100px] left-4 right-4 max-w-md mx-auto z-50">
                <div class="bg-pink p-6 rounded-[30px] flex justify-between items-center shadow-xl border-2 border-black">
                    <span class="text-black font-black uppercase text-base italic">Total</span>
                    <div class="text-right">
                        <div id="total-krw" class="text-black font-black text-3xl leading-none tracking-tighter">₩0</div>
                        <div id="total-twd" class="text-black/80 font-black text-xs mt-1">≈ NT$ 0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 視圖 4: 換匯 -->
        <div id="view-exchange" class="view-content px-2">
            <div class="mb-8 text-center">
                <h2 class="text-4xl font-black italic uppercase text-pink">Exchange</h2>
            </div>
            <div class="space-y-10 pb-20">
                <div>
                    <h3 class="text-pink font-black text-xl uppercase tracking-widest mb-4 border-l-4 border-pink pl-3 italic">Gimhae Airport 金海機場</h3>
                    <div class="grid gap-4" id="ex-gimhae"></div>
                </div>
                <div>
                    <h3 class="text-pink font-black text-xl uppercase tracking-widest mb-4 border-l-4 border-pink pl-3 italic">Nampo 南浦洞</h3>
                    <div class="grid gap-4" id="ex-nampo"></div>
                </div>
                <div>
                    <h3 class="text-pink font-black text-xl uppercase tracking-widest mb-4 border-l-4 border-pink pl-3 italic">Seomyeon 西面</h3>
                    <div class="grid gap-4" id="ex-seomyeon"></div>
                </div>
                <div>
                    <h3 class="text-pink font-black text-xl uppercase tracking-widest mb-4 border-l-4 border-pink pl-3 italic">Haeundae 海雲台</h3>
                    <div class="grid gap-4" id="ex-haeundae"></div>
                </div>
            </div>
        </div>

    </main>

    <nav class="bottom-nav">
        <button id="btn-view-itinerary" class="nav-item active"><i data-lucide="calendar"></i><span>行程</span></button>
        <button id="btn-view-calculator" class="nav-item"><i data-lucide="calculator"></i><span>匯率</span></button>
        <button id="btn-view-shopping" class="nav-item"><i data-lucide="shopping-bag"></i><span>購物</span></button>
        <button id="btn-view-exchange" class="nav-item"><i data-lucide="map"></i><span>換匯</span></button>
    </nav>

    <script>
        const EXCHANGE_RATE = 41.5;
        let expenses = [];

        // --- 旅遊數據 ---
        const itineraryData = [
            { day: "DAY 1", date: "115/01/21 (三)", weather: { icon: "sun", hi: "2°", lo: "-3°" }, events: [
                { time: "08:00", activity: "從家裡出發", type: "car", loc: "斗六/虎尾", note: "交通：開車 2~3hr" },
                { time: "11:00", activity: "抵達連統停車場", type: "car", loc: "連統停車場", note: "地址：桃園市大園區國際路一段509-1號" },
                { time: "12:00", activity: "到達第二航廈", type: "bus", loc: "桃園機場 T2", note: "搭停車場接駁車。第二航廈辦理報到、託運、入關" },
                { time: "13:55", activity: "登機時間", type: "clock", loc: "T2 登機口", note: "準備登機" },
                { time: "14:25", activity: "飛機起飛", type: "plane", loc: "桃園機場 T2", note: "長榮航空BR164" },
                { time: "17:40", activity: "抵達釜山金海機場", type: "plane", loc: "金海機場", note: "飛行時間約2.5小時" },
                { time: "18:10", activity: "取得行李前往地鐵站", type: "shopping-bag", loc: "金海機場", note: "出機場後由 GATE3 走到馬路對面右轉" },
                { time: "18:30", activity: "搭乘地鐵到沙上站", type: "train", loc: "沙上站", note: "先換韓元後搭輕軌。轉乘綠色2號線往西面/萇山方向" },
                { time: "18:40", activity: "由西面站到札嘎其站", type: "train", loc: "札嘎其站", note: "轉乘橘色1號線往多南浦/大浦海水浴場方向" },
                { time: "19:00", activity: "由札嘎其站7號出口出站", type: "map-pin", loc: "札嘎其站", note: "出站正前方路口左轉第二棟大樓。5號出口有電梯可以搭，出電梯直走過7號出口左轉" },
                { time: "19:05", activity: "NewCZ南浦店辦理入住", type: "hotel", loc: "NewCZ Nampo Hotel", note: "辦理入住放置行李" },
                { time: "20:00", activity: "周邊覓食", type: "utensils", loc: "南浦洞", note: "交通：步行。景點：KPOP唱片行(南浦洞)。晚餐：人蔘雞湯粥/南浦雪濃湯。消夜：1.Bhc치킨 남포점(35.099045, 129.02862623) 2.老爺炸雞나리치킨(35.09906263, 129.02643218)" }
            ]},
            { day: "DAY 2", date: "115/01/22 (四)", weather: { icon: "cloud", hi: "4°", lo: "-1°" }, events: [
                { time: "08:00", activity: "釜田市場吃早餐", type: "utensils", loc: "釜田市場", note: "交通：地鐵或計程車。推薦美食：豬肉餅/海苔飯捲(明太子口味)" },
                { time: "09:30", activity: "逛完市場出發前往海雲台", type: "car", loc: "海雲台", note: "1.地鐵: 約50分鐘, 1800韓幣/人(1號線>西面轉2號線)。2.計程車: 約40-60分鐘, 約20000韓幣/車" },
                { time: "10:30", activity: "東釜山樂天OUTLET / 斜坡滑車", type: "shopping-bag", loc: "樂天OUTLET", note: "搭計程車。10:30開門 (北臉/國家地理>比台灣便宜)。10:00滑車開門，就在OUTLET旁(不怕冷可去)" },
                { time: "13:55", activity: "海雲台傳統市場", type: "utensils", loc: "海雲台市場", note: "交通：計程車。逛市場。午餐：31公分海鮮湯麵/小麥冷麵/元祖糖餅/巨大牛骨湯" },
                { time: "14:25", activity: "新世界百貨", type: "shopping-bag", loc: "新世界百貨", note: "交通：計程車/地鐵。逛街消化一下接著去汗蒸幕" },
                { time: "15:30", activity: "SPA LAND 汗蒸幕", type: "map-pin", loc: "SPA LAND", note: "位置在新世界百貨 B1。預計停留2-3小時(必喝甜米釀/吃烤蛋)自助泡麵。步驟:換票→寄鞋→領衣服毛巾→清洗→泡湯→穿發的衣服→桑拿房→換私服→結算→穿鞋" },
                { time: "18:00", activity: "搭車前往西面站", type: "train", loc: "西面站", note: "搭地鐵或計程車。新世界百貨旁就有地鐵站，搭綠線可直達西面站" },
                { time: "18:30", activity: "晚餐吃烤肉", type: "utensils", loc: "西面站", note: "晚餐吃烤肉(4選1)。烤肉的男子(고기굽는남자서면점)/釜山宅烤肉(부산댁)/味贊王(맛찬들왕소금구い서면점)/83獬豸(83 해치)" },
                { time: "18:40", activity: "西面站逛街", type: "shopping-bag", loc: "西面站", note: "西面地下街文創店(地鐵西面站) /大創百貨" },
                { time: "22:00", activity: "回飯店", type: "train", loc: "南浦", note: "地鐵/計程車" }
            ]},
            { day: "DAY 3", date: "115/01/23 (五)", weather: { icon: "snow", hi: "1°", lo: "-5°" }, events: [
                { time: "08:00", activity: "吃早餐", type: "utensils", loc: "南浦洞", note: "可吃附近小吃或便利商店避免耽誤集合時間" },
                { time: "09:00", activity: "釜山站1號出口集合出發", type: "users", loc: "釜山站", note: "搭地鐵。札嘎其站往老匍方向，釜山站下。集合地點：KTX 釜山站 1 號出口 (35.1147, 129.0410)" },
                { time: "10:30", activity: "天空膠囊(藍線公園)", type: "train", loc: "藍線公園", note: "午餐建議：1.清沙浦站:道熙家/秀敏家/韓牛紙火鍋 2.松亭站:31cm海鮮刀削麵" },
                { time: "13:10", activity: "海東龍宮寺", type: "map-pin", loc: "海東龍宮寺", note: "海東龍宮寺是位於韓國釜山廣域市機張郡的禪門曹溪宗佛寺，是韓國最靠近海岸的佛寺， 也是韓國著名的「觀音聖地」" },
                { time: "15:00", activity: "佛國寺", type: "map-pin", loc: "佛國寺", note: "被韓國人譽為最有名的寺廟，距今有將近一千五百年的歷史，興建於西元528年新羅時期第23代君主法興王，中間經歷過日本豐臣秀吉侵入朝鮮半島，佛國寺當時大部分建築被燒毀，除了銅佛像及石造物免於災難中，在二戰及韓戰結束後，這裡開始擴建及重建修復，才有現今的規模樣貌。" },
                { time: "16:40", activity: "大陵院 + 皇理團路", type: "utensils", loc: "皇理團路", note: "必吃：爆漿起司10元餅、南瓜薯條、紅豆餅、皇南夾心餅。晚餐建議：鄉花亭/百年客人" },
                { time: "19:00", activity: "東宮與月池", type: "map-pin", loc: "東宮與月池", note: "新羅王宮的別宮遺址，在過去連同其他附屬建築作為太子居住的東宮，並在國家有喜事或迎接貴客時舉行宴會，還曾是新羅敬順王在甄萱入侵後，於931年邀請高麗太祖王建前來，痛訴危急事態並舉行宴會的地方。" },
                { time: "21:30", activity: "西面站", type: "bus", loc: "西面", note: "看時間是否要提早下車逛街" },
                { time: "21:50", activity: "釜山站", type: "bus", loc: "釜山站", note: "回飯店" }
            ]},
            { day: "DAY 4", date: "115/01/24 (六)", weather: { icon: "sun", hi: "3°", lo: "-2°" }, events: [
                { time: "08:00", activity: "吃早餐後出發", type: "utensils", loc: "札嘎其", note: "古來司魚糕(札嘎其店)/路邊小吃/便利商店" },
                { time: "08:30", activity: "松島天空步道", type: "map-pin", loc: "松島天空步道", note: "搭計程車" },
                { time: "09:00", activity: "松島海上纜車", type: "map-pin", loc: "松島纜車", note: "步行抵達。(09:00開始營運)" },
                { time: "12:00", activity: "札嘎其市場吃午餐", type: "utensils", loc: "札嘎其市場", note: "搭計程車。帝王蟹必吃，每公斤60000~80000韓元" },
                { time: "13:50", activity: "樂天百貨頂樓看開橋", type: "map-pin", loc: "樂天百貨光復店", note: "步行可達。14:00開橋。提早可逛天超市，晚了吃完直接步行去橋邊看即可" },
                { time: "14:30", activity: "白淺灘文化村", type: "map-pin", loc: "白淺灘文化村", note: "搭計程車。停留約1-2小時" },
                { time: "15:30", activity: "太宗台", type: "car", loc: "太宗台", note: "搭計程車。遊園車只開到17:30" },
                { time: "18:00", activity: "釜山塔夜景", type: "map-pin", loc: "釜山塔", note: "搭計程車。搭車至龍頭山公園手扶梯。營業至22:00 (售票至21:30)" },
                { time: "19:30", activity: "富平罐頭市場", type: "utensils", loc: "罐頭市場", note: "步行約1公里(由釜山塔沿路逛過去)。推薦：紅豆奶油艾草麻吉/魚板" },
                { time: "22:00", activity: "回到飯店", type: "car", loc: "南浦", note: "搭計程車/步行也不遠" }
            ]},
            { day: "DAY 5", date: "115/01/25 (日)", weather: { icon: "cloud", hi: "5°", lo: "0°" }, events: [
                { time: "08:00", activity: "早餐 + 整理行李", type: "clock", loc: "飯店", note: "新昌吐司/EggDrop吐司" },
                { time: "09:00", activity: "甘川洞文化村", type: "map-pin", loc: "甘川洞", note: "搭計程車" },
                { time: "12:00", activity: "飯店附近自由活動", type: "shopping-bag", loc: "南浦洞", note: "步行。補齊伴手禮(樂天超市)" },
                { time: "13:00", activity: "回到飯店附近午餐", type: "utensils", loc: "南浦洞", note: "午餐自由發揮(推薦:李在模披薩)" },
                { time: "14:30", activity: "回飯店領行李", type: "hotel", loc: "NewCZ Nampo Hotel", note: "步行" },
                { time: "15:00", activity: "前往金海機場", type: "train", loc: "金海機場", note: "搭地鐵" },
                { time: "16:00", activity: "抵達金海機場", type: "plane", loc: "金海機場", note: "若有退稅先去 KIOSK 掃描退稅條碼" },
                { time: "18:55", activity: "長榮航空【釜山-桃園】", type: "plane", loc: "金海機場", note: "BR163 起飛" },
                { time: "20:25", activity: "抵達桃園機場", type: "plane", loc: "桃園機場", note: "入境檢查" },
                { time: "23:00", activity: "到家", type: "car", loc: "斗六/虎尾", note: "返抵家門" }
            ]}
        ];

        const exchangeData = [
            { region: "gimhae", name: "Money Box 金海機場店", note: "位置：走出航廈 GATE 3 橫跨馬路直走，就在『輕軌機場站』1 號出口正下方。這是 24 小時自助機台。匯率優於機場大廳銀行。" },
            { region: "nampo", name: "映真換錢所 (Youngjin)", note: "位置：地鐵南浦站 7 號出口直走至第一個十字路口。看到便利商店右轉巷內約 30 公尺右手邊。釜山最推薦據點。" },
            { region: "nampo", name: "友利換錢所 (Woori)", note: "位置：就在映真換錢所的正隔壁。如果映真排隊過長，直接換這家。兩家匯率長期同步。" },
            { region: "seomyeon", name: "那英換錢所 (Nayoung)", note: "位置：地鐵西面站 7 號出口出站直走，路過星巴克後大路口右轉進入『西面市場』。豬肉湯飯街入口附近。" },
            { region: "seomyeon", name: "Money Box 西面店", note: "位置：西面站 7 號出口附近主要商務大樓內。提供 24 小時自助換錢服務。機台顯示中文。" },
            { region: "haeundae", name: "Money Box 海雲台店", note: "位置：地鐵海雲台站 5 號出口步行 2 分鐘轉角處。方便在海雲台活動時兌換。" }
        ];

        // --- UI 控制 ---
        window.switchView = (viewId) => {
            document.querySelectorAll('.view-content').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            const target = document.getElementById(`view-${viewId}`);
            const btn = document.getElementById(`btn-view-${viewId}`);
            if (target) target.classList.add('active');
            if (btn) btn.classList.add('active');
            window.scrollTo(0, 0);
        };

        const renderDay = (index) => {
            document.querySelectorAll('#day-nav button').forEach(b => b.classList.remove('active-day-pill'));
            const btn = document.getElementById(`day-pill-${index}`);
            if(btn) btn.classList.add('active-day-pill');

            const container = document.getElementById('itinerary-list');
            const data = itineraryData[index];
            container.innerHTML = `
                <div class="mb-6 p-6 border-l-4 border-pink bg-[#111] rounded-r-2xl">
                    <div class="flex justify-between items-center">
                        <h3 class="text-3xl font-black text-white leading-tight">${data.date}</h3>
                        <div class="text-right">
                             <i data-lucide="${data.weather.icon}" class="text-pink w-10 h-10 ml-auto mb-1"></i>
                             <div class="text-2xl font-mono font-black">${data.weather.hi}<span class="text-gray-600 mx-1">/</span><span class="text-blue-400">${data.weather.lo}</span></div>
                        </div>
                    </div>
                </div>
                <div class="space-y-1">
                ${data.events.map(e => {
                    const isFood = e.type === 'utensils';
                    const itemClass = isFood ? 'itinerary-item food-item' : 'itinerary-item';
                    const foodBadge = isFood ? '<span class="bg-pink text-black text-[11px] font-black px-2 py-0.5 rounded ml-2 uppercase italic tracking-tighter">MUST EAT</span>' : '';
                    return `
                        <div class="${itemClass}">
                            <div class="item-header px-4 py-3 flex justify-between items-center">
                                <div class="flex items-center gap-3">
                                    <span class="text-xl font-mono font-black text-pink tracking-tighter">${e.time}</span>
                                    <i data-lucide="${e.type}" class="w-5 h-5 text-pink opacity-80"></i>
                                </div>
                                ${foodBadge}
                            </div>
                            <div class="px-4 pb-4 pt-2">
                                <h4 class="text-2xl font-black text-white leading-tight mb-2">${e.activity}</h4>
                                <div class="flex items-center gap-1.5 mb-2 opacity-60">
                                     <i data-lucide="map-pin" class="w-3.5 h-3.5 text-gray-300"></i>
                                     <span class="text-xs text-gray-300 font-bold uppercase tracking-widest">${e.loc}</span>
                                </div>
                                <div class="text-gray-400 text-xl font-medium leading-relaxed border-l border-gray-800 pl-3 whitespace-pre-line">${e.note}</div>
                            </div>
                        </div>`;
                }).join('')}
                </div>`;
            lucide.createIcons();
        };

        const renderExchange = () => {
            const containers = { gimhae: "ex-gimhae", nampo: "ex-nampo", seomyeon: "ex-seomyeon", haeundae: "ex-haeundae" };
            Object.keys(containers).forEach(k => { const el = document.getElementById(containers[k]); if (el) el.innerHTML = ""; });
            exchangeData.forEach(ex => {
                const html = `<div class="bg-[#111] p-6 border-2 border-[#222] rounded-3xl"><h4 class="font-black text-white text-xl mb-2">${ex.name}</h4><p class="text-base text-gray-400 font-bold leading-relaxed">${ex.note}</p></div>`;
                const target = document.getElementById(containers[ex.region]);
                if (target) target.innerHTML += html;
            });
            lucide.createIcons();
        };

        // --- 購物紀錄功能 (LocalStorage 解決方案) ---
        const saveExpenses = () => {
            localStorage.setItem('busan_trip_expenses', JSON.stringify(expenses));
        };

        const loadExpenses = () => {
            const saved = localStorage.getItem('busan_trip_expenses');
            expenses = saved ? JSON.parse(saved) : [];
            renderExpenses();
        };

        const renderExpenses = () => {
            const list = document.getElementById('expense-container');
            const totalKrwEl = document.getElementById('total-krw');
            const totalTwdEl = document.getElementById('total-twd');
            if (!list) return;

            list.innerHTML = expenses.length === 0 ? '<p class="text-center text-gray-600 py-10 uppercase font-black">No Records</p>' : expenses.map((ex, index) => `
                <div class="flex justify-between items-center bg-[#111] p-6 rounded-3xl border border-[#222]">
                    <div class="flex-1">
                        <span class="text-xl font-black uppercase text-white block">${ex.item}</span>
                        <div class="text-xs text-gray-500 font-bold mt-1">≈ NT$ ${Math.round(ex.cost / EXCHANGE_RATE).toLocaleString()}</div>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="text-right"><div class="text-pink font-mono font-black text-2xl">₩${ex.cost.toLocaleString()}</div></div>
                        <button class="delete-btn p-2 text-gray-600 hover:text-pink transition-transform active:scale-75" onclick="window.deleteExpense(${index})"><i data-lucide="trash-2" class="w-6 h-6"></i></button>
                    </div>
                </div>`).join('');

            const total = expenses.reduce((s, c) => s + (Number(c.cost) || 0), 0);
            totalKrwEl.innerText = `₩${total.toLocaleString()}`;
            totalTwdEl.innerText = `≈ NT$ ${Math.round(total / EXCHANGE_RATE).toLocaleString()}`;
            lucide.createIcons();
        };

        window.deleteExpense = (index) => {
            expenses.splice(index, 1);
            saveExpenses();
            renderExpenses();
        };

        window.addExpenseAction = () => {
            const itemInput = document.getElementById('exp-item');
            const costInput = document.getElementById('exp-cost');
            const item = itemInput.value;
            const cost = costInput.value;

            if (item && cost) {
                expenses.unshift({ item: item, cost: Number(cost), time: Date.now() });
                itemInput.value = "";
                costInput.value = "";
                saveExpenses();
                renderExpenses();
            }
        };

        // --- 初始化 ---
        const init = () => {
            const nav = document.getElementById('day-nav');
            itineraryData.forEach((d, i) => { 
                const b = document.createElement('button'); 
                b.id = `day-pill-${i}`; 
                // 放大點選範圍與字體
                b.className = "w-full py-4 rounded-full border border-[#333] text-sm font-black uppercase bg-[#0a0a0a]"; 
                b.innerText = d.day; 
                b.onclick = () => renderDay(i); 
                nav.appendChild(b); 
            });
            
            renderDay(0);
            renderExchange();
            loadExpenses();
            
            document.getElementById('btn-view-itinerary').onclick = () => window.switchView('itinerary');
            document.getElementById('btn-view-calculator').onclick = () => window.switchView('calculator');
            document.getElementById('btn-view-shopping').onclick = () => window.switchView('shopping');
            document.getElementById('btn-view-exchange').onclick = () => window.switchView('exchange');
            document.getElementById('add-expense-btn').onclick = () => window.addExpenseAction();

            const t = document.getElementById('twd-input');
            const k = document.getElementById('krw-input');
            k.oninput = (e) => t.value = e.target.value ? (e.target.value / EXCHANGE_RATE).toFixed(0) : "";
            t.oninput = (e) => k.value = e.target.value ? Math.round(e.target.value * EXCHANGE_RATE) : "";

            lucide.createIcons();
        };

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
