<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸŒ¹ 2026 é‡œå±±å†·å±å± ğŸŒ¹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    
    <script>
        // --- Custom Tailwind Configuration for Rose Gold Theme ---
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            light: '#F7DBE0', // Light Dusty Rose
                            DEFAULT: '#D8A7A7', // Dusty Rose Gold
                            dark: '#A67979', // Darker Rose
                        },
                        text: '#4A5568', // Dark Grey for contrast
                        background: '#FFF9F9', // Near-white, light pink tint
                        card: '#FFFFFF', 
                        accent: {
                            food: '#E97451',     // Salmon Red
                            shopping: '#639AA6', // Soft Teal
                            sightseeing: '#C6B060', // Muted Gold
                            travel: '#D88A6F',   // Light Copper
                        },
                    },
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                        serif: ['"Playfair Display"', 'serif'], // Used for titles
                    },
                    boxShadow: {
                        // Refined, softer shadows
                        'custom-sm': '0 2px 4px 0 rgba(0, 0, 0, 0.04)',
                        'custom-md': '0 6px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 8px -4px rgba(0, 0, 0, 0.04)',
                        'custom-lg': '0 12px 25px -5px rgba(0, 0, 0, 0.1), 0 6px 12px -6px rgba(0, 0, 0, 0.05)',
                        'custom-xl': '0 20px 30px -10px rgba(0, 0, 0, 0.15)',
                    }
                }
            }
        }
    </script>

    <style>
        /* Base Styles for Refined Look */
        body {
            background-color: #FFF9F9; /* background */
            color: #4A5568; /* text */
            font-family: 'Noto Sans TC', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .app-card {
            background-color: #FFFFFF; 
            border-radius: 16px; /* Extra rounded corners for cute/chic look */
            box-shadow: 0 10px 20px rgba(216, 167, 167, 0.15); /* Rose Gold tinted shadow */
            border: 1px solid #F0F0F0;
            transition: all 0.3s ease;
        }

        .app-card:hover {
            box-shadow: 0 15px 30px rgba(216, 167, 167, 0.25);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .btn-press:active {
            transform: scale(0.97);
            box-shadow: none !important;
        }
        
        /* Large Heading Style */
        .chic-title {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            letter-spacing: 0.5px;
            color: #D8A7A7;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.05);
        }

        @media (max-width: 1023px) {
            .mobile-nav-bar {
                background-color: #FFFFFF;
                box-shadow: 0 -8px 20px rgba(0, 0, 0, 0.05);
            }
        }

        @media (min-width: 1024px) {
            #app-container {
                display: grid;
                grid-template-columns: 320px 1fr; /* Wider sidebar */
                min-height: 100vh;
            }
            .main-content {
                padding: 40px 50px;
            }
            .sidebar {
                border-right: 1px solid #F0F0F0;
                background-color: #FFFFFF;
                box-shadow: 4px 0 10px rgba(0, 0, 0, 0.05);
            }
        }
    </style>
</head>
<body>

<div id="app" class="min-h-screen">
    <div id="app-container" class="lg:grid">

        <aside class="sidebar fixed top-0 left-0 h-full w-80 p-8 lg:block hidden">
            <header class="mb-10">
                <h1 class="text-4xl font-black flex items-center gap-2 chic-title">
                    <i class="ph ph-sparkle text-5xl" weight="fill"></i>
                    2026 BUSAN 
                </h1>
                <p class="text-sm text-text/70 font-medium mt-2 tracking-wider"> 2026 BUSAN</p>
            </header>
            
            <nav class="space-y-2">
                <button v-for="tab in desktopTabs" :key="tab.id"
                    @click="currentTab = tab.id"
                    :class="currentTab === tab.id ? 'bg-primary/20 text-primary font-black shadow-custom-md' : 'text-text/80 hover:bg-primary/5'"
                    class="w-full text-left p-4 rounded-xl flex items-center gap-4 transition-colors text-lg btn-press">
                    <i :class="tab.icon" class="text-2xl" :weight="currentTab === tab.id ? 'fill' : 'bold'"></i>
                    {{ tab.name }}
                </button>
            </nav>

            <div class="absolute bottom-8 left-8 right-8 pt-6 border-t border-primary/20">
                 <div class="text-xs text-text/50">
                    <i class="ph ph-calendar-check mr-1"></i>
                    è¡Œç¨‹æ—¥æœŸï¼š2026.01.21 - 01.25
                 </div>
            </div>
        </aside>

        <main class="main-content lg:col-start-2 lg:pb-10 pb-32 p-5">

            <header class="lg:hidden pb-6 pt-2 flex justify-between items-center border-b border-primary/20">
                 <h1 class="text-3xl font-black flex items-center gap-3 chic-title">
                    <i :class="currentTabIcon" class="text-3xl" weight="fill"></i>
                    {{ currentTabName }}
                </h1>
            </header>
            
            <div v-if="currentTab === 'itinerary'" class="space-y-8 pt-4">
                
                <div class="app-card p-4 overflow-x-auto no-scrollbar shadow-custom-md">
                    <div class="flex space-x-4">
                        <button v-for="i in 5" :key="i" 
                            @click="activeDay = i"
                            :class="activeDay === i ? 'bg-primary text-white shadow-custom-lg' : 'bg-background text-text/80 border border-primary/20 hover:bg-primary/10'"
                            class="flex-shrink-0 w-20 h-20 rounded-xl flex flex-col items-center justify-center transition-all duration-300 btn-press text-base font-bold">
                            <span class="text-xs uppercase opacity-80">{{ getDayInfo(i).date.slice(3) }}</span> 
                            <span class="text-2xl font-black leading-none mt-1">{{ getDayInfo(i).day.slice(1) }}</span>
                        </button>
                    </div>
                </div>

                <div class="flex justify-between items-center px-1 mb-2">
                    <h2 class="text-2xl font-black text-text">{{ getDayInfo(activeDay).fullDay }} æ—¥ç¨‹</h2>
                    <div class="flex items-center gap-3 text-lg font-black bg-primary/20 px-4 py-2 rounded-full text-primary shadow-custom-sm">
                        <span class="text-2xl leading-none">{{ getWeatherIcon(simulatedWeather[activeDay].code) }}</span>
                        <span>{{ simulatedWeather[activeDay].temp }}Â°C</span>
                    </div>
                </div>

                <div class="flex space-x-3 overflow-x-auto no-scrollbar pb-3">
                    <button v-for="cat in filterCategories" :key="cat.key"
                        @click="activeCategory = cat.key"
                        :class="[
                            activeCategory === cat.key ? 'text-white shadow-custom-md' : 'bg-white text-text/80 border border-gray-300 hover:bg-gray-100',
                            activeCategory === cat.key ? `bg-accent-${cat.key} border-accent-${cat.key}` : '',
                            cat.key === 'all' && activeCategory === 'all' ? 'bg-primary' : ''
                        ]"
                        class="flex-shrink-0 px-6 py-3 rounded-full flex items-center gap-3 text-base font-bold transition-colors btn-press border">
                        <i :class="cat.icon" :weight="activeCategory === cat.key ? 'fill' : 'bold'" class="text-xl"></i>
                        {{ cat.name }}
                    </button>
                </div>


                <div class="space-y-6 pt-4">
                    <div v-if="filteredItineraryByCat.length === 0" class="text-center py-16 text-text/40 app-card border-dashed border-2">
                        <i class="ph ph-confetti text-4xl mb-3"></i>
                        <p class="text-lg">æœ¬æ—¥ç„¡ç¬¦åˆã€Œ{{ filterCategories.find(c => c.key === activeCategory)?.name }}ã€çš„æµªæ¼«è¡Œç¨‹ ğŸ¥‚</p>
                    </div>

                    <div v-for="item in filteredItineraryByCat" :key="item.id" 
                        @click="item.isFlight ? null : openModal(item)"
                        class="app-card p-5 flex gap-5 relative transition-all duration-300 border-l-8"
                        :class="[
                            item.isFlight ? 'border-primary' : `border-accent-${item.category}`, 
                            {'cursor-pointer hover:border-l-[12px]': !item.isFlight}
                        ]">
                        
                        <div class="flex flex-col items-center min-w-[70px] flex-shrink-0">
                            <span class="text-xl font-black text-primary px-1 font-mono leading-tight">
                                {{ item.time }}
                            </span>
                            <div class="h-full w-1 bg-primary/10 my-3 rounded-full"></div>
                        </div>

                        <div class="flex-1 pb-1 min-w-0">
                            <div class="flex justify-between items-start">
                                <h3 class="font-black text-lg text-text leading-snug pr-6">{{ item.title }}</h3>
                                <span v-if="item.category && item.category !== 'flight'" 
                                    :class="getCategoryBgColor(item.category)"
                                    class="text-xs font-bold px-3 py-1 rounded-full whitespace-nowrap shadow-custom-sm">
                                    {{ getCategoryName(item.category) }}
                                </span>
                            </div>
                            
                            <div class="mt-2 flex items-center text-sm text-text/60 font-medium">
                                <i :class="item.isFlight ? 'ph ph-airplane-tilt text-primary' : 'ph ph-map-pin text-text/40'" class="mr-2 text-lg"></i>
                                <span class="truncate">{{ item.location }}</span>
                            </div>

                            <p v-if="item.desc" class="text-base text-text/90 mt-3 p-4 bg-primary/10 rounded-xl border-l-4 border-primary/40 w-full whitespace-pre-wrap shadow-inner">
                               <i class="ph ph-note-pencil mr-1 text-primary/70" weight="bold"></i>
                               {{ item.desc }}
                            </p>

                            <a v-if="!item.isFlight" :href="getNaverMapLink(item.location)" target="_blank" 
                               class="mt-4 inline-flex items-center text-sm font-bold text-white bg-primary px-5 py-2.5 rounded-full shadow-custom-md hover:bg-primary-dark transition-colors btn-press">
                                <i class="ph ph-navigation-arrow text-base mr-2" weight="bold"></i> Naver Map å°èˆª
                            </a>
                        </div>
                    </div>
                </div>
                
                <button @click="openModal(null)" class="fixed bottom-28 right-5 bg-primary text-white w-16 h-16 rounded-full shadow-custom-xl flex items-center justify-center text-3xl z-20 hover:scale-105 transition-transform btn-press lg:hidden">
                    <i class="ph ph-plus" weight="bold"></i>
                </button>
            </div>

            <div v-if="currentTab === 'money'" class="space-y-8 pt-4">
                <h3 class="font-black text-3xl chic-title flex items-center gap-3 border-b border-primary/20 pb-4">
                    <i class="ph ph-currency-krw text-primary text-4xl" weight="fill"></i> æµªæ¼«é ç®—ä¸­å¿ƒ
                </h3>
                
                <div class="app-card p-6 bg-primary/10 border-l-8 border-primary/50 space-y-4 shadow-custom-lg">
                    <div class="flex justify-between items-center">
                        <h4 class="font-bold text-lg text-text">â‚©/NT$ æ›ç®—æ©Ÿ</h4>
                        <div class="flex items-center gap-2 bg-white px-4 py-2 rounded-full shadow-custom-md border-2 border-primary/30">
                            <span class="text-sm text-text/60 font-medium">ç•¶å‰åŒ¯ç‡</span>
                            <input v-model.number="exchangeRate" type="number" class="w-16 text-right font-black text-base outline-none text-primary bg-transparent" min="0.01" step="0.01">
                        </div>
                    </div>
                    
                    <div class="flex items-center border-b border-primary/30 pb-4">
                        <span class="font-black w-20 text-lg text-text">â‚© KRW</span>
                        <input v-model.number="calcKRW" type="number" placeholder="è¼¸å…¥éŸ“å…ƒé‡‘é¡" class="w-full text-right text-4xl font-black outline-none bg-transparent text-text placeholder-text/30">
                    </div>
                    <div class="flex items-center pt-4">
                        <span class="font-black w-20 text-lg text-text">NT$ TWD</span>
                        <div class="w-full text-right text-4xl font-black text-primary">
                            {{ formatNumber(calculatedTWD) }}
                        </div>
                    </div>
                </div>

                <div class="app-card p-6 space-y-5 border-l-8 border-accent-shopping/50 bg-accent-shopping/10 shadow-custom-lg">
                    <h4 class="font-bold text-xl text-text flex items-center gap-3">
                        <i class="ph ph-wallet-fill text-accent-shopping text-2xl"></i>
                        ç¸½æ”¯å‡ºæ¦‚è¦½
                    </h4>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white p-4 rounded-xl shadow-custom-sm border border-gray-100">
                            <p class="text-sm text-text/60 font-medium">ç¸½æ”¯å‡º (KRW)</p>
                            <p class="font-black text-2xl text-text">â‚© {{ formatNumber(totalExpenseKRW) }}</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-custom-sm border border-primary/20">
                            <p class="text-sm text-text/60 font-medium">ç¸½æ”¯å‡º (TWD)</p>
                            <p class="font-black text-2xl text-primary">NT$ {{ formatNumber(totalExpenseTWD) }}</p>
                        </div>
                    </div>
                </div>

                <div class="app-card p-6 border-l-8 border-accent-food/50 bg-accent-food/10 space-y-4 shadow-custom-lg">
                    <h4 class="font-bold text-xl text-text/90 flex items-center gap-3 border-b border-accent-food/20 pb-3">
                        <i class="ph ph-receipt-bold text-accent-food text-2xl"></i> æ–°å¢æµªæ¼«æ¶ˆè²»
                    </h4>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm text-primary font-bold ml-1 flex items-center gap-1"><i class="ph ph-calendar-blank" weight="bold"></i> æ—¥æœŸ</label>
                            <input type="date" v-model="newExpense.date" class="w-full bg-white p-3 rounded-lg text-base outline-none border shadow-custom-sm mt-1 focus:border-primary">
                        </div>
                        <div>
                            <label class="text-sm text-primary font-bold ml-1 flex items-center gap-1"><i class="ph ph-tag" weight="bold"></i> é¡åˆ¥</label>
                            <select v-model="newExpense.category" class="w-full bg-white p-3 rounded-lg text-base outline-none border shadow-custom-sm mt-1 focus:border-primary" :class="{'border-red-500': !newExpense.category && newExpense.item}">
                                <option value="" disabled>é¸æ“‡é¡åˆ¥ (å¿…é¸)</option>
                                <option v-for="cat in filterCategories.filter(c => c.key !== 'all' && c.key !== 'flight')" :key="cat.key" :value="cat.key">
                                    {{ cat.name }}
                                </option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="text-sm text-primary font-bold ml-1 flex items-center gap-1"><i class="ph ph-notepad" weight="bold"></i> å“é …åç¨±</label>
                        <input v-model="newExpense.item" placeholder="ä¾‹å¦‚ï¼šæµ·é›²å°å’–å•¡å»³ç”œé»" class="w-full bg-white p-3.5 rounded-lg text-base outline-none border shadow-custom-sm focus:border-primary mt-1">
                    </div>
                    
                    <div>
                        <label class="text-sm text-primary font-bold ml-1 flex items-center gap-1"><i class="ph ph-currency-krw" weight="bold"></i> é‡‘é¡ (éŸ“å…ƒ)</label>
                        <div class="relative w-full">
                            <input v-model.number="newExpense.amount" type="number" placeholder="0" class="w-full bg-white p-3.5 pl-10 rounded-lg text-lg font-black outline-none border shadow-custom-sm focus:border-primary mt-1">
                            <span class="absolute left-3 top-3.5 text-lg text-text/40 font-bold">â‚©</span>
                        </div>
                        <p v-if="newExpenseTWD > 0" class="text-sm text-text/60 mt-1 text-right">
                            ç´„ NT$ <span class="font-bold">{{ formatNumber(newExpenseTWD) }}</span>
                        </p>
                    </div>
                    
                    <div>
                        <button @click="addExpense" :disabled="!newExpense.item || !newExpense.amount || newExpense.amount <= 0 || !newExpense.category" class="w-full bg-primary text-white py-4 rounded-full font-black text-lg shadow-custom-lg transform hover:scale-[1.01] transition btn-press disabled:opacity-50 mt-4">
                            <i class="ph ph-sparkle-fill mr-1"></i> å„²å­˜æµªæ¼«æ”¯å‡º
                        </button>
                    </div>
                </div>


                <div class="space-y-3 pb-8 pt-4">
                    <h4 class="font-bold text-xl text-text border-b border-gray-200 pb-3 flex items-center gap-2">
                        <i class="ph ph-list-dashes text-primary text-2xl" weight="bold"></i> æ­·å²è¨˜å¸³æ¸…å–® (å…± {{ expenses.length }} ç­†)
                    </h4>
                    
                    <div v-for="(exp, index) in expenses" :key="index" class="app-card p-4 flex justify-between items-center border-l-4 hover:border-l-8 transition-all duration-200" :class="`border-accent-${exp.category}/50 bg-white`">
                        <div class="flex flex-col flex-1 truncate pr-2">
                            <span class="text-base font-black text-text truncate">{{ exp.item }}</span>
                            <span class="text-xs text-text/60 mt-0.5">{{ exp.date.slice(5) }} Â· <span :class="getCategoryColor(exp.category)">{{ getCategoryName(exp.category) }}</span></span>
                        </div>
                        <div class="flex items-center gap-4 flex-shrink-0">
                            <div class="text-right">
                                <p class="font-bold text-text/60 text-sm">â‚©{{ formatNumber(exp.amount) }}</p>
                                <p class="text-lg font-black text-primary">NT$ {{ formatNumber(convertKRWToTWD(exp.amount)) }}</p>
                            </div>
                            <button @click="removeExpense(index)" class="text-text/30 hover:text-red-500 p-2 btn-press"><i class="ph ph-trash-simple text-xl" weight="bold"></i></button>
                        </div>
                    </div>
                    <div v-if="expenses.length === 0" class="text-center text-base text-text/30 py-8 app-card border-dashed">
                        <i class="ph ph-piggy-bank-light text-3xl mb-1"></i>
                        <p>é‚„æ²’æœ‰æµªæ¼«æ”¯å‡ºç´€éŒ„å–”ï¼</p>
                    </div>
                </div>

            </div>

            <div v-if="currentTab === 'info'" class="space-y-8 pt-4">
                <h3 class="font-black text-3xl chic-title flex items-center gap-3 border-b border-primary/20 pb-4">
                    <i class="ph ph-paper-plane-tilt text-primary text-4xl" weight="fill"></i> æ—…ç¨‹æ†‘è­‰
                </h3>

                <div class="app-card p-6 relative overflow-hidden bg-primary/10 border-l-8 border-primary shadow-custom-lg">
                    <div class="flex justify-between items-center mb-5 border-b border-dashed border-primary/30 pb-4">
                        <h2 class="text-xl font-bold text-text">âœˆï¸ å»ç¨‹ TPE â†’ PUS</h2>
                        <span class="text-3xl font-black text-primary font-mono">{{ flightInfo.departure.flightNo }}</span>
                    </div>

                    <div class="grid grid-cols-2 gap-x-6 gap-y-4 text-base">
                        <div class="flex flex-col">
                            <span class="text-sm text-text/60 font-medium uppercase">å‡ºç™¼æ™‚é–“</span>
                            <span class="font-bold text-text text-lg">{{ flightInfo.departure.depTime }} (Jan 21, 2026)</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-sm text-text/60 font-medium uppercase">ç™»æ©Ÿæ™‚é–“</span>
                            <span class="font-bold text-red-500 text-lg">{{ flightInfo.departure.boardingTime }}</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-sm text-text/60 font-medium uppercase">èˆªå»ˆ / ç™»æ©Ÿé–€</span>
                            <span class="font-bold text-text text-lg">{{ flightInfo.departure.terminal }} / {{ flightInfo.departure.gate }}</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-sm text-text/60 font-medium uppercase">æŠµé”é‡œå±±æ™‚é–“</span>
                            <span class="font-bold text-text text-lg">17:40</span>
                        </div>
                    </div>
                </div>
                
                <div class="app-card p-6 relative overflow-hidden bg-red-500/10 border-l-8 border-red-500 shadow-custom-lg">
                    <div class="flex justify-between items-center mb-5 border-b border-dashed border-red-500/30 pb-4">
                        <h2 class="text-xl font-bold text-text">ğŸ›« å›ç¨‹ PUS â†’ TPE</h2>
                        <span class="text-3xl font-black text-red-500 font-mono">{{ flightInfo.return.flightNo }}</span>
                    </div>

                    <div class="grid grid-cols-2 gap-x-6 gap-y-4 text-base">
                        <div class="flex flex-col">
                            <span class="text-sm text-text/60 font-medium uppercase">å‡ºç™¼æ™‚é–“</span>
                            <span class="font-bold text-text text-lg">{{ flightInfo.return.depTime }} (Jan 25, 2026)</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-sm text-text/60 font-medium uppercase">ç™»æ©Ÿæ™‚é–“</span>
                            <span class="font-bold text-red-500 text-lg">{{ flightInfo.return.boardingTime }}</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-sm text-text/60 font-medium uppercase">èˆªå»ˆ / ç™»æ©Ÿé–€</span>
                            <span class="font-bold text-text text-lg">{{ flightInfo.return.terminal }} / {{ flightInfo.return.gate }}</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-sm text-text/60 font-medium uppercase">æŠµé”æ¡ƒåœ’æ™‚é–“</span>
                            <span class="font-bold text-text text-lg">20:25</span>
                        </div>
                    </div>
                </div>


                <h3 class="font-black text-3xl chic-title pt-4 flex items-center gap-3 border-b border-primary/20 pb-4"><i class="ph ph-buildings text-primary text-4xl" weight="fill"></i> æµªæ¼«ä½å®¿</h3>
                <div class="app-card p-6 border-8 border-primary/20 shadow-custom-xl">
                    <div class="flex items-center mb-4">
                        <i class="ph ph-bed text-3xl text-primary mr-3" weight="fill"></i>
                        <h2 class="text-2xl font-black text-text leading-tight">{{ hotelInfo.name }}</h2>
                    </div>
                    <div class="bg-primary/5 p-4 rounded-xl border border-primary/20">
                        <label class="text-sm text-text/60 font-bold uppercase block mb-1">åœ°å€ (Address)</label>
                        <p class="font-bold text-base text-text select-all">{{ hotelInfo.address }}</p>
                    </div>
                    
                    <a :href="getNaverMapLink(hotelInfo.name)" target="_blank" class="w-full mt-6 py-3.5 bg-primary text-white font-black rounded-full shadow-custom-lg hover:bg-primary-dark transition btn-press flex items-center justify-center gap-2 text-lg">
                        <i class="ph ph-navigation-arrow text-xl" weight="bold"></i> Naver Map å°èˆª
                    </a>
                </div>
            </div>

            <div v-if="currentTab === 'guide'" class="space-y-8 pt-4">

                <div class="app-card p-6 space-y-6 shadow-custom-lg">
                    <div class="space-y-4">
                        <h3 class="font-bold text-2xl text-text flex items-center gap-3 border-b border-gray-200 pb-3">
                            <i class="ph ph-suitcase-rolling text-primary text-3xl" weight="fill"></i> è¡Œææ¸…å–®
                            <span class="text-sm text-text/60 font-black">({{ luggageList.filter(i => i.checked).length }} / {{ luggageList.length }})</span>
                        </h3>
                        
                        <div class="flex gap-3 p-2 rounded-xl bg-primary/10 border border-primary/20">
                            <input v-model="newLuggageItem" @keyup.enter="addLuggage" type="text" placeholder="æ–°å¢æµªæ¼«å¿…éœ€å“..." class="flex-1 bg-white p-3 rounded-lg text-base outline-none border focus:border-primary shadow-custom-sm">
                            <button @click="addLuggage" class="bg-primary text-white px-5 h-12 rounded-lg flex items-center justify-center btn-press shadow-custom-md text-base font-bold whitespace-nowrap hover:scale-[1.02]"><i class="ph ph-plus-bold mr-1"></i> æ–°å¢</button>
                        </div>

                        <div class="space-y-2">
                            <div v-for="(item, index) in luggageList" :key="`l-${index}`" class="flex items-center bg-white p-3.5 rounded-xl border border-gray-200 shadow-custom-sm transition hover:bg-gray-50" :class="{'opacity-70 bg-primary/5': item.checked}">
                                <input type="checkbox" v-model="item.checked" class="form-checkbox h-5 w-5 text-primary rounded border-gray-300 focus:ring-primary cursor-pointer">
                                <span class="ml-3 flex-1 text-base font-medium text-text" :class="{'line-through text-text/40': item.checked}">{{ item.text }}</span>
                                <button @click="removeLuggage(index)" class="text-text/20 hover:text-red-500 p-2 btn-press"><i class="ph ph-trash text-xl" weight="bold"></i></button>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4 pt-6 border-t border-primary/20">
                        <h3 class="font-bold text-2xl text-text flex items-center gap-3 border-b border-gray-200 pb-3">
                            <i class="ph ph-bag-simple text-accent-shopping text-3xl" weight="fill"></i> å¿…è²·æ¸…å–®
                            <span class="text-sm text-text/60 font-black">({{ mustBuyList.filter(i => i.checked).length }} / {{ mustBuyList.length }})</span>
                        </h3>
                        
                        <div class="flex gap-3 p-2 rounded-xl bg-accent-shopping/10 border border-accent-shopping/20">
                            <input v-model="newMustBuyItem" @keyup.enter="addMustBuy" type="text" placeholder="æ–°å¢å¿…è²·æˆ°åˆ©å“..." class="flex-1 bg-white p-3 rounded-lg text-base outline-none border focus:border-accent-shopping shadow-custom-sm">
                            <button @click="addMustBuy" class="bg-accent-shopping text-white px-5 h-12 rounded-lg flex items-center justify-center btn-press shadow-custom-md text-base font-bold whitespace-nowrap hover:scale-[1.02]"><i class="ph ph-plus-bold mr-1"></i> æ–°å¢</button>
                        </div>

                        <div class="space-y-2">
                            <div v-for="(item, index) in mustBuyList" :key="`m-${index}`" class="flex items-center bg-white p-3.5 rounded-xl border border-gray-200 shadow-custom-sm transition hover:bg-gray-50" :class="{'opacity-70 bg-accent-shopping/5': item.checked}">
                                <input type="checkbox" v-model="item.checked" class="form-checkbox h-5 w-5 text-accent-shopping rounded border-gray-300 focus:ring-accent-shopping cursor-pointer">
                                <span class="ml-3 flex-1 text-base font-medium text-text" :class="{'line-through text-text/40': item.checked}">{{ item.text }}</span>
                                <button @click="removeMustBuy(index)" class="text-text/20 hover:text-red-500 p-2 btn-press"><i class="ph ph-trash text-xl" weight="bold"></i></button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="app-card p-6 border-l-8 border-red-500/50 bg-red-500/10 shadow-custom-lg">
                    <h3 class="font-bold text-2xl text-text flex items-center gap-3 mb-4 border-b border-red-500/20 pb-3">
                        <i class="ph ph-phone-call text-red-500 text-3xl" weight="fill"></i> ç·Šæ€¥è¯çµ¡é›»è©±
                    </h3>
                    <div class="space-y-4">
                        <div v-for="contact in emergencyContacts" :key="contact.number" class="flex justify-between items-center bg-white p-3.5 rounded-xl border border-red-500/30 shadow-custom-sm">
                            <div class="flex flex-col">
                                <span class="font-black text-text text-lg">{{ contact.name }}</span>
                                <span class="text-sm text-text/60">{{ contact.desc }}</span>
                            </div>
                            <a :href="`tel:${contact.number}`" class="bg-red-500 text-white px-5 py-2.5 rounded-full font-bold text-base btn-press shadow-custom-md hover:bg-red-600">
                                <i class="ph ph-phone-call-fill mr-1"></i> æ’¥æ‰“ {{ contact.number }}
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'map'" class="h-[75vh] flex flex-col space-y-6 pt-4">
                <div class="app-card p-5 shadow-custom-lg">
                    <h3 class="font-bold text-2xl text-text flex items-center gap-3 border-b border-gray-200 pb-3 mb-4">
                        <i class="ph ph-map-trifold text-primary text-3xl" weight="fill"></i> åœ°åœ–æ¢ç´¢
                    </h3>
                    <input v-model="mapQuery" @keyup.enter="searchNaverMap" type="text" placeholder="è¼¸å…¥åœ°é»æœå°‹ (ä¾‹å¦‚ï¼šæµ·é›²å°)" class="w-full bg-gray-50 px-4 py-3.5 rounded-lg text-base outline-none font-medium mb-4 focus:bg-white focus:ring-2 focus:ring-primary/50 transition border border-gray-200">
                    
                    <div class="flex gap-4">
                        <button @click="searchNaverMap" class="flex-1 bg-primary text-white py-4 rounded-full font-black text-lg shadow-custom-lg btn-press flex items-center justify-center gap-2 hover:bg-primary-dark">
                            <i class="ph ph-navigation-arrow text-xl" weight="bold"></i> Naver Map
                        </button>
                        <button @click="searchGoogleMap" class="flex-1 bg-white text-text border-2 border-primary/20 py-4 rounded-full font-black text-lg shadow-custom-md btn-press flex items-center justify-center gap-2 hover:bg-primary/10">
                            <i class="ph ph-map-pin text-xl" weight="bold"></i> Google Map
                        </button>
                    </div>
                </div>
                
                <div class="flex-1 rounded-xl overflow-hidden shadow-custom-xl relative bg-gray-100 border-4 border-primary/20">
                    <iframe width="100%" height="100%" style="border:0" loading="lazy" 
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d102716.27850871927!2d129.0838128!3d35.1584949!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3568e89f81216d8f%3A0x6a0c5c36af1c944d!2sBusan%2C%20South%20Korea!5e0!3m2!1sen!2stw!4v1703649600000!5m2!1sen!2stw" 
                        allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                    <div class="absolute bottom-4 left-4 bg-white/90 backdrop-blur px-4 py-2 rounded-full text-sm font-bold text-text/80 shadow-md border border-gray-200">
                        <i class="ph ph-info-circle-fill text-primary mr-1"></i> å°èˆªè«‹ä½¿ç”¨ä¸Šæ–¹æŒ‰éˆ•
                    </div>
                </div>
            </div>
        </main>
    </div>

    <nav class="fixed bottom-0 w-full pb-safe pt-3 px-3 flex justify-around items-center mobile-nav-bar rounded-t-2xl z-30 lg:hidden">
        <button v-for="tab in mobileTabs" :key="tab.id"
            @click="currentTab = tab.id"
            :class="currentTab === tab.id ? 'text-primary' : 'text-text/40'" 
            class="flex flex-col items-center p-2 flex-1 transition-all btn-press">
            <i :class="tab.icon" class="text-3xl" :weight="currentTab === tab.id ? 'fill' : 'bold'"></i>
            <span class="text-xs font-black mt-1">{{ tab.name }}</span>
        </button>
    </nav>

    <div v-if="showModal" class="fixed inset-0 bg-text/40 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="app-card w-full max-w-lg rounded-2xl p-6 shadow-custom-xl scale-100 transition-transform border-l-8 border-primary">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-black text-text">
                    {{ isEditMode ? 'ç·¨è¼¯æµªæ¼«è¡Œç¨‹ âœï¸' : 'æ–°å¢å°ˆå±¬ç­†è¨˜ âœ¨' }}
                </h3>
                <button @click="showModal = false" class="bg-primary/10 w-10 h-10 rounded-full text-primary hover:bg-primary/20 btn-press text-xl"><i class="ph ph-x" weight="bold"></i></button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="text-sm text-primary font-bold ml-1 flex items-center gap-1"><i class="ph ph-clock" weight="bold"></i> æ™‚é–“</label>
                    <input v-model="modalForm.time" type="time" class="w-full bg-gray-50 p-3 rounded-lg mt-1 outline-none border focus:border-primary text-base font-bold">
                </div>
                <div>
                    <label class="text-sm text-primary font-bold ml-1 flex items-center gap-1"><i class="ph ph-tag" weight="bold"></i> é¡åˆ¥</label>
                    <select v-model="modalForm.category" class="w-full bg-gray-50 p-3 rounded-lg mt-1 outline-none border focus:border-primary text-base">
                        <option value="" disabled>é¸æ“‡è¡Œç¨‹é¡åˆ¥</option>
                        <option v-for="cat in filterCategories.filter(c => c.key !== 'all' && c.key !== 'flight')" :key="cat.key" :value="cat.key">{{ cat.name }}</option>
                    </select>
                </div>
                <div>
                    <label class="text-sm text-primary font-bold ml-1 flex items-center gap-1"><i class="ph ph-text-h" weight="bold"></i> æ¨™é¡Œ (å¿…å¡«)</label>
                    <input v-model="modalForm.title" type="text" placeholder="è¡Œç¨‹åç¨±" class="w-full bg-gray-50 p-3 rounded-lg mt-1 outline-none border focus:border-primary text-base font-bold">
                </div>
                <div>
                    <label class="text-sm text-primary font-bold ml-1 flex items-center gap-1"><i class="ph ph-map-pin" weight="bold"></i> åœ°é» (åœ°åœ–æœå°‹ç”¨)</label>
                    <input v-model="modalForm.location" type="text" placeholder="è¼¸å…¥é—œéµå­—" class="w-full bg-gray-50 p-3 rounded-lg mt-1 outline-none border focus:border-primary text-base">
                </div>
                <div>
                    <label class="text-sm text-primary font-bold ml-1 flex items-center gap-1"><i class="ph ph-chats" weight="bold"></i> å‚™è¨»/äº¤é€šè³‡è¨Š</label>
                    <textarea v-model="modalForm.desc" rows="3" placeholder="ä¾‹å¦‚ï¼šäº¤é€šæ–¹å¼ã€ç‡Ÿæ¥­æ™‚é–“..." class="w-full bg-gray-50 p-3 rounded-lg mt-1 outline-none border focus:border-primary resize-none text-base"></textarea>
                </div>
            </div>
            <button @click="saveItem" :disabled="!modalForm.title || !modalForm.category" class="w-full mt-6 py-4 bg-primary text-white font-black rounded-full shadow-custom-lg btn-press disabled:opacity-50 text-lg">
                <i class="ph ph-heart-fill mr-1"></i> å„²å­˜æµªæ¼«ç­†è¨˜
            </button>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            // --- State ---
            const currentTab = ref('itinerary');
            const activeDay = ref(1);
            const activeCategory = ref('all'); 
            const showModal = ref(false);
            const isEditMode = ref(false);
            const mapQuery = ref('');
            
            // Guide
            const luggageList = ref([]);
            const newLuggageItem = ref('');
            const mustBuyList = ref([]);
            const newMustBuyItem = ref('');
            
            // Calculator
            const calcKRW = ref('');
            const exchangeRate = ref(41.5); 
            
            // Expenses 
            const expenses = ref([]);
            const newExpense = ref({ 
                date: new Date().toISOString().split('T')[0], 
                item: '', 
                amount: null, 
                category: '' 
            });

            // Modal Form
            const modalForm = ref({ id: null, time: '', title: '', location: '', desc: '', category: '' });

            // --- Fixed Data ---
            const desktopTabs = [
                { id: 'itinerary', name: 'è¡Œç¨‹è¦åŠƒ', icon: 'ph-notebook' },
                { id: 'money', name: 'æµªæ¼«è¨˜å¸³', icon: 'ph-currency-krw' },
                { id: 'info', name: 'æ©Ÿç¥¨èˆ‡ä½å®¿', icon: 'ph-ticket' },
                { id: 'guide', name: 'æº–å‚™æ¸…å–®', icon: 'ph-list-checks' },
                { id: 'map', name: 'åœ°åœ–æ¢ç´¢', icon: 'ph-map-trifold' },
            ];
            
            const mobileTabs = [
                { id: 'itinerary', name: 'è¡Œç¨‹', icon: 'ph-notebook' },
                { id: 'money', name: 'è¨˜å¸³', icon: 'ph-currency-krw' },
                { id: 'info', name: 'è³‡è¨Š', icon: 'ph-ticket' },
                { id: 'guide', name: 'æ¸…å–®', icon: 'ph-list-checks' },
                { id: 'map', name: 'åœ°åœ–', icon: 'ph-map-trifold' },
            ];

            const currentTabName = computed(() => {
                const tab = desktopTabs.find(t => t.id === currentTab.value);
                return tab ? tab.name : 'è¦åŠƒç¸½è¦½';
            });
            
            const currentTabIcon = computed(() => {
                const tab = desktopTabs.find(t => t.id === currentTab.value);
                return tab ? tab.icon : 'ph-map-pin-line';
            });
            
            // Trip Date Mapping (Jan 21 - Jan 25, 2026)
            const tripDates = {
                1: { date: '01/21', day: 'é€±ä¸‰', fullDay: '1æœˆ21æ—¥ (é€±ä¸‰)' },
                2: { date: '01/22', day: 'é€±å››', fullDay: '1æœˆ22æ—¥ (é€±å››)' },
                3: { date: '01/23', day: 'é€±äº”', fullDay: '1æœˆ23æ—¥ (é€±äº”)' },
                4: { date: '01/24', day: 'é€±å…­', fullDay: '1æœˆ24æ—¥ (é€±å…­)' },
                5: { date: '01/25', day: 'é€±æ—¥', fullDay: '1æœˆ25æ—¥ (é€±æ—¥)' },
            };

            // Simulated Daily Weather
            const simulatedWeather = ref({
                1: { code: 2, temp: 8, rain: 20 }, 
                2: { code: 0, temp: 12, rain: 0 }, 
                3: { code: 51, temp: 6, rain: 70 }, 
                4: { code: 1, temp: 10, rain: 10 }, 
                5: { code: 0, temp: 11, rain: 0 }, 
            });

            const filterCategories = [
                { key: 'all', name: 'æ‰€æœ‰é …ç›®', icon: 'ph-heart', color: 'text-primary', colorCode: '#D8A7A7' },
                { key: 'food', name: 'ç¾é£Ÿé¥—å®´', icon: 'ph-fork-knife', color: 'text-accent-food', colorCode: '#E97451' },
                { key: 'shopping', name: 'è¡€æ‹šè³¼ç‰©', icon: 'ph-shopping-bag', color: 'text-accent-shopping', colorCode: '#639AA6' },
                { key: 'sightseeing', name: 'ç¾æ™¯æ¢ç´¢', icon: 'ph-mountain', color: 'text-accent-sightseeing', colorCode: '#C6B060' },
                { key: 'travel', name: 'äº¤é€šç§»å‹•', icon: 'ph-train-simple', color: 'text-accent-travel', colorCode: '#D88A6F' },
                { key: 'flight', name: 'æ©Ÿç¥¨/ä½å®¿', icon: 'ph-airplane-takeoff', color: 'text-indigo-600', colorCode: '#4F46E5' }
            ];

            const defaultLuggage = [
                { text: 'è­·ç…§ / ç°½è­‰', checked: false },
                { text: 'éŸ“å¹£ç¾é‡‘ / ä¿¡ç”¨å¡', checked: false },
                { text: 'è½‰æ¥é ­ (éŸ“åœ‹åœ“å­”)', checked: false },
                { text: 'è¡Œå‹•é›»æº / å……é›»ç·š', checked: false },
                { text: 'ç‰™åˆ·ç‰™è† (éŸ“åœ‹ç’°ä¿ä¸æä¾›)', checked: false },
                { text: 'ä¿æš–è¡£ç‰© / åœå·¾', checked: false },
                { text: 'ç¶²å¡ / eSim', checked: false }
            ];

            const defaultMustBuy = [
                { text: 'Olive Young è­·è†šå“', checked: false },
                { text: 'é›¶é£Ÿ (çƒé¾œé¤…ä¹¾)', checked: false },
                { text: 'Kakao Friends å‘¨é‚Š', checked: false },
                { text: 'Market O å¸ƒæœ—å°¼', checked: false },
                { text: 'è¥ªå­', checked: false }
            ];

            const emergencyContacts = [
                { name: 'è­¦å¯Ÿå±€', number: '112', desc: 'Police' },
                { name: 'æ¶ˆé˜²/æ•‘è­·è»Š', number: '119', desc: 'Fire/Ambulance' },
                { name: 'æ—…éŠè«®è©¢ç†±ç·š', number: '1330', desc: 'Korea Travel Hotline' }
            ];

            // æ ¹æ“š BUSAN.xlsx - å·¥ä½œè¡¨1.csv é‡æ–°è¦åŠƒè¡Œç¨‹ (åŒ V10 ç¢ºä¿è¡Œç¨‹æ­£ç¢º)
            const updatedItinerary = [
                // Day 1: 115/01/21(ä¸‰)
                { id: 101, day: 1, time: '12:00', title: 'åˆ°é”æ¡ƒåœ’åœ‹éš›æ©Ÿå ´T2', location: 'TPE T2', desc: 'è¾¦ç†å ±åˆ°ã€æ‰˜é‹ã€å…¥é—œã€‚', isFlight: false, category: 'travel' },
                { id: 102, day: 1, time: '13:55', title: 'é•·æ¦®èˆªç©º BR180 ç™»æ©Ÿ', location: 'TPE T2', desc: 'é è¨ˆ 14:25 èµ·é£›ã€‚', isFlight: true, category: 'flight', flightNo: 'BR180', depTime: '14:25', terminal: 'T2', gate: 'TBD', boardingTime: '13:55', type: 'departure' },
                { id: 103, day: 1, time: '17:40', title: 'æŠµé”é‡œå±±é‡‘æµ·æ©Ÿå ´ (PUS)', location: 'PUS', desc: 'å–å¾—è¡Œæå‰å¾€åœ°éµç«™ï¼Œå¾GATE3å‡ºä¾†ã€‚', isFlight: true, category: 'flight', flightNo: 'BR180', depTime: '14:25', terminal: 'T2', gate: 'TBD', boardingTime: '13:55', type: 'departure' }, 
                { id: 104, day: 1, time: '18:30', title: 'è¼•è»Œ â†’ æ²™ä¸Šç«™ (Sasang)', location: 'é‡‘æµ·æ©Ÿå ´ç«™', desc: 'å¾GATE3èµ°åˆ°é¦¬è·¯å°é¢å³è½‰ï¼Œæ­ä¹˜é‡‘æµ·è¼•è»Œã€‚', isFlight: false, category: 'travel' },
                { id: 105, day: 1, time: '18:40', title: 'åœ°éµ 2è™Ÿç·š â†’ 1è™Ÿç·š(å—æµ¦)', location: 'æ²™ä¸Šç«™/è¥¿é¢ç«™', desc: 'æ²™ä¸Šç«™è½‰ä¹˜ç¶ è‰²2è™Ÿç·šï¼Œè¥¿é¢ç«™è½‰ä¹˜æ©˜è‰²1è™Ÿç·šåˆ°æœ­å˜å…¶ç«™ã€‚', isFlight: false, category: 'travel' },
                { id: 106, day: 1, time: '19:05', title: 'NewCZå—æµ¦åº— Check In', location: 'æœ­å˜å…¶ç«™ 7è™Ÿå‡ºå£', desc: '5è™Ÿå‡ºå£æœ‰é›»æ¢¯å¯æ­ï¼Œå‡ºé›»æ¢¯ç›´èµ°é7è™Ÿå‡ºå£å·¦è½‰ã€‚', isFlight: false, category: 'travel' },
                { id: 107, day: 1, time: '20:00', title: 'æ™šé¤èˆ‡å¤œé–“é€›è¡—', location: 'å—æµ¦æ´/æœ­å˜å…¶/åœ‹éš›å¸‚å ´', desc: 'æ™šé¤å»ºè­°ï¼šå—æµ¦è”˜é›æ¹¯ æˆ– å…ƒç¥–é‡œå±±è±¬è…³ã€‚', isFlight: false, category: 'food' },

                // Day 2: 115/01/22(å››)
                { id: 201, day: 2, time: '09:30', title: 'é£¯åº—å‡ºç™¼ â†’ æ¾å³¶ç·š', location: 'æœ­å˜å…¶ç«™', desc: 'å»ºè­°æ­è¨ˆç¨‹è»Šï¼Œç´„ 5 åˆ†é˜æŠµé”æ¾å³¶ã€‚', isFlight: false, category: 'travel' },
                { id: 202, day: 2, time: '09:30', title: 'æ¾å³¶å¤©ç©ºæ­¥é“', location: 'æ¾å³¶', desc: 'æ—©ä¸Šå…‰ç·šèˆ’æœã€äººæ¯”è¼ƒå°‘ã€‚èµ°å®Œç´„ 20-30 åˆ†é˜ã€‚', isFlight: false, category: 'sightseeing' },
                { id: 203, day: 2, time: '10:20', title: 'æ¾å³¶æµ·ä¸Šçºœè»Š (Air Cruise)', location: 'æ¾å³¶', desc: 'å»ºè­°æ­ä¾†å›çºœè»Šï¼Œç´„ 1 å°æ™‚çµæŸã€‚', isFlight: false, category: 'sightseeing' },
                { id: 204, day: 2, time: '11:30', title: 'åˆé¤ (æ¨‚å¤©ç™¾è²¨)', location: 'æ¨‚å¤©ç™¾è²¨å…‰å¾©åº—', desc: 'åƒå®Œå¯è‡³é ‚æ¨“çœ‹å½±å³¶å¤§æ©‹ã€‚', isFlight: false, category: 'food' },
                { id: 205, day: 2, time: '14:00', title: 'è§€è³å½±å³¶å¤§æ©‹é–‹æ©‹', location: 'æ¨‚å¤©ç™¾è²¨å…‰å¾©åº—é ‚æ¨“ (æ˜Ÿå…‰èŠ±åœ’)', desc: '14:00 æº–æ™‚é–‹æ©‹ï¼Œææ—© 10-15 åˆ†é˜åˆ°å¡ä½ã€‚', isFlight: false, category: 'sightseeing' },
                { id: 206, day: 2, time: '15:00', title: 'ç™½æ·ºç˜æ–‡åŒ–æ‘', location: 'í°ì—¬ìš¸ë¬¸í™”ë§ˆì„', desc: 'çœ‹å®Œé–‹æ©‹æ­è¨ˆç¨‹è»Š 10-12 åˆ†é˜æŠµé”ã€‚å¾ˆå¥½æ‹ç…§ã€‚', isFlight: false, category: 'sightseeing' },
                { id: 207, day: 2, time: '17:00', title: 'æ™šé¤èˆ‡è¥¿é¢é€›è¡—', location: 'è¥¿é¢ç«™', desc: 'æ™šé¤å»ºè­°çƒ¤è‚‰ï¼ˆè¥¿é¢ç«™çƒ¤è‚‰å››å¤©ç‹ï¼‰ã€‚é€›ï¼šè¥¿é¢åœ°ä¸‹è¡—æ–‡å‰µåº—ã€å¤§å‰µç™¾è²¨ã€‚', isFlight: false, category: 'food' },

                // Day 3: 115/01/23(äº”) (KKdayè¡Œç¨‹)
                { id: 301, day: 3, time: '09:00', title: 'KKdayè¡Œç¨‹é›†åˆå‡ºç™¼', location: 'é‡œå±±ç«™1è™Ÿå‡ºå£', desc: 'é›†åˆå‰å¾€æ…¶å· (ä½›åœ‹å¯ºã€å¤§é™µé™¢+çš‡ç†åœ˜è·¯ã€æ±å®®èˆ‡æœˆæ± )ã€‚', isFlight: false, category: 'travel' },
                { id: 302, day: 3, time: '10:30', title: 'å¤©ç©ºè† å›Š (è—ç·šå…¬åœ’)', location: 'æµ·é‚Šåˆ—è»Š', desc: 'KKdayè¡Œç¨‹å®‰æ’ã€‚', isFlight: false, category: 'sightseeing' },
                { id: 303, day: 3, time: '13:10', title: 'æµ·æ±é¾å®®å¯º', location: 'í•´ë™ìš©ê¶ì‚¬', desc: 'KKdayè¡Œç¨‹å®‰æ’ã€‚', isFlight: false, category: 'sightseeing' },
                { id: 304, day: 3, time: '21:50', title: 'è¿”å›é‡œå±±ç«™', location: 'è¥¿é¢ç«™æå‰ä¸‹è»Š', desc: 'å¯åœ¨è¥¿é¢ç«™æå‰ä¸‹è»Šï¼Œé€›è¥¿é¢çš„å¤§å‰µ2è™Ÿåº—ã€‚', isFlight: false, category: 'travel' },
                { id: 305, day: 3, time: '22:30', title: 'å®µå¤œ/å›é£¯åº—', location: 'è¥¿é¢/å—æµ¦æ´', desc: 'è¥¿é¢å¤§å‰µ2è™Ÿåº—å››å±¤æ¨“å¯é€›ã€‚', isFlight: false, category: 'shopping' },

                // Day 4: 115/01/24(å…­)
                { id: 401, day: 4, time: '08:00', title: 'é£¯åº—å‡ºç™¼ â†’ æµ·é›²å°', location: 'å—æµ¦æ´', desc: 'åœ°éµç´„ 50 åˆ†é˜ï¼Œè¨ˆç¨‹è»Šç´„ 20000 KRWã€‚', isFlight: false, category: 'travel' },
                { id: 402, day: 4, time: '10:30', title: 'æ±é‡œå±±æ¨‚å¤©OUTLET', location: 'æ±é‡œå±±', desc: 'æˆ–å¯ç©æ—é‚Šçš„æ»‘è»Š(è‹¥ä¸æ€•å†·)ã€‚', isFlight: false, category: 'shopping' },
                { id: 403, day: 4, time: '13:55', title: 'æµ·é›²å°å‚³çµ±å¸‚å ´', location: 'æµ·é›²å°', desc: 'åƒå¤ä¾†å¸é­šç³• / 31å…¬åˆ†æµ·é®®æ¹¯éºµ / é€›å‚³çµ±å¸‚å ´ã€‚', isFlight: false, category: 'food' },
                { id: 404, day: 4, time: '14:25', title: 'æ–°ä¸–ç•Œç™¾è²¨ (Centum City)', location: 'Centum City', desc: 'ä¸»è¦é€›è¡—è³¼ç‰©ã€‚', isFlight: false, category: 'shopping' },
                { id: 405, day: 4, time: '15:30', title: 'SPA LAND æ±—è’¸å¹•', location: 'æ–°ä¸–ç•Œç™¾è²¨ B1', desc: 'é è¨ˆåœç•™ 2-3 å°æ™‚ã€‚', isFlight: false, category: 'sightseeing' },
                { id: 406, day: 4, time: '18:30', title: 'æ™šé¤åƒçƒ¤è‚‰', location: 'è¥¿é¢ç«™', desc: 'çƒ¤è‚‰çš„ç”·å­ã€å‘³è´Šç‹ã€é‡œå±±å®…çƒ¤è‚‰ç­‰ã€‚', isFlight: false, category: 'food' },
                { id: 407, day: 4, time: '18:40', title: 'è¥¿é¢ç«™é€›è¡—', location: 'è¥¿é¢', desc: 'è¥¿é¢åœ°ä¸‹è¡—æ–‡å‰µåº— / å¤§å‰µç™¾è²¨ã€‚', isFlight: false, category: 'shopping' },

                // Day 5: 115/01/25(æ—¥)
                { id: 501, day: 5, time: '08:00', title: 'æ—©é¤ + æ•´ç†è¡Œæ', location: 'é£¯åº—/é™„è¿‘', desc: 'è¡Œæå¯„æ”¾åœ¨é£¯åº—æ«ƒæª¯ã€‚', isFlight: false, category: 'food' },
                { id: 502, day: 5, time: '09:15', title: 'ç”˜å·æ´æ–‡åŒ–æ‘æ•£ç­–', location: 'ê°ì²œë¬¸í™”ë§ˆì„', desc: 'å»ºè­°æ­è¨ˆç¨‹è»Šï¼Œå¾å°ç‹å­æ‹ç…§é»é–‹å§‹ã€‚åœç•™ç´„ 2 å°æ™‚ã€‚', isFlight: false, category: 'sightseeing' },
                { id: 503, day: 5, time: '11:30', title: 'æ­è¨ˆç¨‹è»Šè¿”å›å—æµ¦æ´', location: 'å—æµ¦æ´', desc: 'è»Šè³‡ç´„ 6,000â€“8,000 éŸ“å¹£ã€‚', isFlight: false, category: 'travel' },
                { id: 504, day: 5, time: '12:00', title: 'åˆé¤ (å—æµ¦æ´)', location: 'å—æµ¦æ´', desc: 'æœ€å¾Œçš„é€›è¡—èˆ‡ç”¨é¤æ™‚é–“ã€‚', isFlight: false, category: 'food' },
                { id: 505, day: 5, time: '16:00', title: 'é£¯åº—å–è¡Œæ', location: 'NewCZå—æµ¦åº—', desc: 'æº–å‚™å‰å¾€é‡‘æµ·æ©Ÿå ´ã€‚', isFlight: false, category: 'travel' },
                { id: 506, day: 5, time: '17:00', title: 'æŠµé”é‡œå±±é‡‘æµ·æ©Ÿå ´', location: 'PUS', desc: 'è¾¦ç†é€€ç¨…ã€Check Inã€‚', isFlight: false, category: 'travel' },
                { id: 507, day: 5, time: '18:55', title: 'å›ç¨‹: é•·æ¦®èˆªç©º BR163 (é‡œå±±â†’æ¡ƒåœ’)', location: 'Gimhae International Airport', desc: 'é è¨ˆ 20:25 æŠµé”æ¡ƒåœ’æ©Ÿå ´ T2ã€‚', isFlight: true, category: 'flight', flightNo: 'BR163', depTime: '18:55', terminal: 'Intl', gate: 'TBD', boardingTime: '18:25', type: 'return' },
            ];


            const itinerary = ref([]);
            
            // --- Lifecycle ---
            onMounted(() => {
                newExpense.value.date = new Date().toISOString().split('T')[0];

                // Load from LocalStorage (Using v11 key for the new theme)
                const storageKey = 'busan_2026_v11';
                const savedData = localStorage.getItem(storageKey);
                
                if (savedData) {
                    const data = JSON.parse(savedData);
                    itinerary.value = data.itinerary;
                    expenses.value = data.expenses;
                    exchangeRate.value = data.exchangeRate || 41.5;
                    luggageList.value = data.luggageList;
                    mustBuyList.value = data.mustBuyList;
                } else {
                    itinerary.value = updatedItinerary;
                    luggageList.value = defaultLuggage;
                    mustBuyList.value = defaultMustBuy;
                }
            });

            // --- Watchers for Auto-Save ---
            watch([itinerary, expenses, exchangeRate, luggageList, mustBuyList], () => {
                const dataToSave = {
                    itinerary: itinerary.value,
                    expenses: expenses.value,
                    exchangeRate: exchangeRate.value,
                    luggageList: luggageList.value,
                    mustBuyList: mustBuyList.value,
                };
                localStorage.setItem('busan_2026_v11', JSON.stringify(dataToSave));
            }, { deep: true });

            // --- Computed ---

            // Step 1: Filter by Day
            const filteredItinerary = computed(() => {
                return itinerary.value
                    .filter(item => item.day === activeDay.value)
                    .sort((a, b) => a.time.localeCompare(b.time));
            });

            // Step 2: Filter by Category (if activeCategory is not 'all')
            const filteredItineraryByCat = computed(() => {
                if (activeCategory.value === 'all') {
                    return filteredItinerary.value;
                }
                return filteredItinerary.value.filter(item => item.category === activeCategory.value);
            });
            
            // Utility function to convert KRW to TWD
            const convertKRWToTWD = (krwAmount) => {
                const krw = Number(krwAmount) || 0;
                const rate = Number(exchangeRate.value);
                if (rate <= 0 || isNaN(rate)) return 0;
                return Math.round(krw / rate);
            };

            // Expense Computed Properties
            const totalExpenseKRW = computed(() => {
                return expenses.value
                    .filter(item => item.category !== 'flight')
                    .reduce((sum, item) => sum + (Number(item.amount) || 0), 0);
            });
            
            const totalExpenseTWD = computed(() => {
                return convertKRWToTWD(totalExpenseKRW.value);
            });
            
            const calculatedTWD = computed(() => {
                return convertKRWToTWD(calcKRW.value);
            });
            
            const newExpenseTWD = computed(() => {
                 return convertKRWToTWD(newExpense.value.amount);
            });

            // Flight Info Extraction
            const flightInfo = computed(() => {
                const dep = updatedItinerary.find(i => i.isFlight && i.type === 'departure');
                const ret = updatedItinerary.find(i => i.isFlight && i.type === 'return');
                
                const defaultDep = { flightNo: 'BR180', depAirport: 'TPE', arrAirport: 'PUS', depTime: '14:25', terminal: 'T2', gate: 'TBD', boardingTime: '13:55' };
                const defaultRet = { flightNo: 'BR163', depAirport: 'PUS', arrAirport: 'TPE', depTime: '18:55', terminal: 'Intl', gate: 'TBD', boardingTime: '18:25' };

                return {
                    departure: dep || defaultDep,
                    return: ret || defaultRet
                };
            });

            // Hotel Info Extraction (based on the provided file)
            const hotelInfo = computed(() => {
                return {
                    name: 'NewCZå—æµ¦åº— (åŸé‡œå±±äºé›²æ¨¹é£¯åº—)',
                    address: 'é‡œå±±å»£åŸŸå¸‚ä¸­å€å…‰å¾©è·¯8è™Ÿè¡— 32 / ë¶€ì‚°ê´‘ì—­ì‹œ ì¤‘êµ¬ ê´‘ë³µë¡œ8ë²ˆê¸¸ 32',
                };
            });


            // --- Methods ---
            
            // Utility Methods
            const getDayInfo = (dayIndex) => tripDates[dayIndex] || { date: `Day ${dayIndex}`, day: '', fullDay: `Day ${dayIndex}` };
            
            const getCategoryName = (key) => filterCategories.find(c => c.key === key)?.name || 'æœªçŸ¥';
            const getCategoryColor = (key) => filterCategories.find(c => c.key === key)?.color || 'text-text/50';
            const getCategoryBgColor = (key) => {
                const cat = filterCategories.find(c => c.key === key);
                if (!cat) return 'bg-gray-200 text-text/80';
                return `bg-accent-${cat.key}/20 text-accent-${cat.key}`; // e.g., bg-accent-food/20 text-accent-food
            };

            const openModal = (item) => {
                if (item) {
                    isEditMode.value = true;
                    if (item.isFlight) return alert('èˆªç­è³‡è¨Šè«‹åœ¨ã€Œæ©Ÿç¥¨/ä½å®¿ã€é é¢ä¸­æª¢è¦–ï¼Œç„¡æ³•ä¿®æ”¹ã€‚'); 

                    modalForm.value = { ...item };
                } else {
                    isEditMode.value = false;
                    const lastEvent = filteredItinerary.value.at(-1);
                    const defaultTime = lastEvent ? incrementTime(lastEvent.time) : '12:00';

                    modalForm.value = { id: Date.now(), time: defaultTime, title: '', location: '', desc: '', category: 'sightseeing' };
                }
                showModal.value = true;
            };

            const saveItem = () => {
                if (!modalForm.value.title || !modalForm.value.category) return;
                const newItem = { 
                    ...modalForm.value, 
                    day: activeDay.value, 
                    location: modalForm.value.location || modalForm.value.title, 
                    isFlight: false 
                };

                if (isEditMode.value) {
                    const index = itinerary.value.findIndex(i => i.id === modalForm.value.id);
                    if (index !== -1) itinerary.value[index] = newItem;
                } else {
                    itinerary.value.push(newItem);
                }
                showModal.value = false;
            };

            // Helper function for time increment
            const incrementTime = (timeStr) => {
                const [h, m] = timeStr.split(':').map(Number);
                const date = new Date();
                date.setHours(h);
                date.setMinutes(m);
                date.setHours(date.getHours() + 1);
                const newH = String(date.getHours()).padStart(2, '0');
                const newM = String(date.getMinutes()).padStart(2, '0');
                return `${newH}:${newM}`;
            };
            
            // Expense Methods
            const addExpense = () => {
                const amount = Number(newExpense.value.amount);
                if (!newExpense.value.item || isNaN(amount) || amount <= 0 || !newExpense.value.category) {
                    return;
                }
                
                expenses.value.unshift({
                    date: newExpense.value.date || new Date().toISOString().split('T')[0],
                    item: newExpense.value.item,
                    amount: amount, 
                    category: newExpense.value.category
                });
                // Reset form fields
                newExpense.value.item = '';
                newExpense.value.amount = null; 
                newExpense.value.category = ''; 
            };

            const removeExpense = (index) => {
                if(confirm('ç¢ºå®šåˆªé™¤é€™ç­†æµªæ¼«æ”¯å‡ºç´€éŒ„å—ï¼Ÿ')) expenses.value.splice(index, 1);
            };

            // Checklist Methods
            const addLuggage = () => {
                if(!newLuggageItem.value) return;
                luggageList.value.push({ text: newLuggageItem.value, checked: false });
                newLuggageItem.value = '';
            };
            const removeLuggage = (index) => {
                luggageList.value.splice(index, 1);
            };
            const addMustBuy = () => {
                if(!newMustBuyItem.value) return;
                mustBuyList.value.push({ text: newMustBuyItem.value, checked: false });
                newMustBuyItem.value = '';
            };
            const removeMustBuy = (index) => {
                mustBuyList.value.splice(index, 1);
            };

            // Map Methods
            const searchNaverMap = () => {
                const q = mapQuery.value || 'Busan';
                window.open(`https://map.naver.com/p/search/${encodeURIComponent(q)}`, '_blank');
            };
            const searchGoogleMap = () => {
                const q = mapQuery.value || 'Busan';
                window.open(`https://www.google.com/maps/search/$${encodeURIComponent(q)}`, '_blank');
            };
            const getNaverMapLink = (query) => `https://map.naver.com/p/search/${encodeURIComponent(query)}`;
            
            const formatNumber = (num) => {
                if (num === null || num === undefined) return '0';
                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            };

            // Weather Icon Mapping (Simple)
            const getWeatherIcon = (code) => {
                if (code === 0) return 'â˜€ï¸'; 
                if (code === 1) return 'ğŸŒ¥ï¸'; 
                if (code <= 3) return 'â˜ï¸'; 
                if (code <= 67) return 'ğŸŒ§ï¸'; 
                return 'ğŸŒ¥ï¸'; 
            };

            return {
                currentTab, activeDay, currentTabName, currentTabIcon, activeCategory,
                showModal, isEditMode, modalForm,
                itinerary, expenses, exchangeRate, filteredItineraryByCat,
                totalExpenseTWD, totalExpenseKRW, newExpense, newExpenseTWD, mapQuery,
                calcKRW, calculatedTWD,
                luggageList, newLuggageItem, mustBuyList, newMustBuyItem,
                flightInfo, hotelInfo, emergencyContacts, simulatedWeather, 
                desktopTabs, mobileTabs, filterCategories,
                openModal, saveItem, 
                addExpense, removeExpense, convertKRWToTWD,
                addLuggage, removeLuggage, addMustBuy, removeMustBuy,
                formatNumber, searchNaverMap, searchGoogleMap, getNaverMapLink, getWeatherIcon, getDayInfo,
                getCategoryName, getCategoryColor, getCategoryBgColor 
            };
        }
    }).mount('#app');
</script>
</body>
</html>
