import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Plane, Hotel, MapPin, Clock, Utensils, Train, Wallet, CloudSun, ShoppingBag, Calculator, ExternalLink } from 'lucide-react';

const BusanLuxuryTrip = () => {
  const [activeDay, setActiveDay] = useState(0);
  const [twdAmount, setTwdAmount] = useState(0);
  const [krwAmount, setKrwAmount] = useState(0);
  const [expenses, setExpenses] = useState([]);
  const [newExpense, setNewExpense] = useState({ item: '', cost: '' });

  // 匯率設定 (範例值)
  const EXCHANGE_RATE = 41.5; 

  // NAVER 地圖連結生成函數
  const getNaverLink = (location) => `https://map.naver.com/v5/search/${encodeURIComponent(location)}`;

  const itinerary = [
    {
      day: "DAY 1", date: "01/21", theme: "Arrival & Nampo",
      weather: "2°C / -3°C ☀️",
      events: [
        { time: "14:25", activity: "桃園機場 (BR164)", type: "flight", loc: "桃園機場" },
        { time: "19:05", activity: "NewCZ 南浦店 Check-in", type: "hotel", loc: "NEWCZ NAMPO HOTEL" },
        { time: "20:00", activity: "南浦洞周邊 (Bhc炸雞)", type: "food", loc: "南浦洞" }
      ]
    },
    {
      day: "DAY 2", date: "01/22", theme: "Haeundae & Spa",
      weather: "4°C / -1°C ⛅",
      events: [
        { time: "10:30", activity: "東釜山樂天 OUTLET", type: "spot", loc: "樂天名牌折扣購物中心東釜山店" },
        { time: "15:30", activity: "SPA LAND 汗蒸幕", type: "spot", loc: "新世界 Centum City SPA LAND" },
        { time: "18:30", activity: "西面站烤肉", type: "food", loc: "西面站" }
      ]
    },
    {
      day: "DAY 3", date: "01/23", theme: "Gyeongju Heritage",
      weather: "1°C / -5°C ❄️",
      events: [
        { time: "10:30", activity: "藍線公園天空膠囊", type: "spot", loc: "Blueline Park" },
        { time: "15:00", activity: "佛國寺 & 大陵院", type: "spot", loc: "佛國寺" },
        { time: "19:00", activity: "東宮與月池", type: "spot", loc: "東宮與月池" }
      ]
    },
    {
      day: "DAY 4", date: "01/24", theme: "Coastal Culture",
      weather: "3°C / -2°C ☀️",
      events: [
        { time: "09:00", activity: "松島海上纜車", type: "spot", loc: "松島海上纜車" },
        { time: "12:00", activity: "札嘎其市場 (帝王蟹)", type: "food", loc: "札嘎其市場" },
        { time: "14:30", activity: "白淺灘文化村", type: "spot", loc: "白淺灘文化村" }
      ]
    },
    {
      day: "DAY 5", date: "01/25", theme: "Gamcheon & Return",
      weather: "5°C / 0°C ☁️",
      events: [
        { time: "09:00", activity: "甘川洞文化村", type: "spot", loc: "甘川洞文化村" },
        { time: "18:55", activity: "金海機場歸途", type: "flight", loc: "金海國際機場" }
      ]
    }
  ];

  const addExpense = () => {
    if(newExpense.item && newExpense.cost) {
      setExpenses([...expenses, { ...newExpense, id: Date.now() }]);
      setNewExpense({ item: '', cost: '' });
    }
  };

  return (
    <div className="min-h-screen bg-[#000000] text-[#FFFFFF] font-sans selection:bg-[#f8a5c2]">
      {/* Blackpink Header */}
      <header className="py-10 border-b border-[#f8a5c2]/30 text-center relative overflow-hidden">
        <div className="absolute top-0 left-0 w-full h-1 bg-[#f8a5c2]"></div>
        <h1 className="text-6xl font-black tracking-tighter text-[#f8a5c2] uppercase">Busan <span className="text-white">Vibe</span></h1>
        <p className="mt-2 text-gray-400 tracking-[0.3em] uppercase text-sm">Luxury Travel Itinerary</p>
      </header>

      <main className="max-w-5xl mx-auto px-6 py-10 grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        {/* Left Column: Itinerary */}
        <div className="lg:col-span-2 space-y-8">
          <div className="flex gap-2 overflow-x-auto pb-4 scrollbar-hide">
            {itinerary.map((item, idx) => (
              <button key={idx} onClick={() => setActiveDay(idx)}
                className={`flex-shrink-0 px-6 py-3 rounded-sm font-bold border-2 transition-all ${
                  activeDay === idx ? 'bg-[#f8a5c2] border-[#f8a5c2] text-black' : 'border-[#333] text-gray-500 hover:border-[#f8a5c2]'
                }`}>
                {item.day}
              </button>
            ))}
          </div>

          <AnimatePresence mode="wait">
            <motion.div key={activeDay} initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="space-y-6">
              <div className="flex justify-between items-end border-b border-[#333] pb-4">
                <div>
                  <h2 className="text-4xl font-bold italic">{itinerary[activeDay].theme}</h2>
                  <p className="text-[#f8a5c2] font-mono mt-1">{itinerary[activeDay].date} BUSAN, KR</p>
                </div>
                <div className="text-right">
                  <CloudSun className="inline-block mr-2 text-[#f8a5c2]" />
                  <span className="font-mono">{itinerary[activeDay].weather}</span>
                </div>
              </div>

              {itinerary[activeDay].events.map((event, idx) => (
                <div key={idx} className="group bg-[#111] border border-[#222] p-6 flex flex-col md:flex-row gap-6 items-start md:items-center hover:border-[#f8a5c2] transition-colors">
                  <div className="text-2xl font-mono font-black text-[#333] group-hover:text-[#f8a5c2]">{event.time}</div>
                  <div className="flex-1">
                    <h4 className="text-xl font-bold">{event.activity}</h4>
                    <p className="text-gray-500 text-sm mt-1 flex items-center gap-1">
                      <MapPin size={14} /> {event.loc}
                    </p>
                  </div>
                  <a href={getNaverLink(event.loc)} target="_blank" rel="noreferrer"
                    className="flex items-center gap-2 bg-white text-black px-4 py-2 text-xs font-bold uppercase hover:bg-[#f8a5c2] transition-colors">
                    Naver Map <ExternalLink size={14} />
                  </a>
                </div>
              ))}
            </motion.div>
          </AnimatePresence>
        </div>

        {/* Right Column: Tools */}
        <div className="space-y-8">
          {/* Currency Calculator */}
          <section className="bg-[#111] p-6 border-t-4 border-[#f8a5c2]">
            <h3 className="flex items-center gap-2 font-bold mb-4 uppercase text-[#f8a5c2]"><Calculator size={18}/> 匯率換算 (1:{EXCHANGE_RATE})</h3>
            <div className="space-y-3">
              <div>
                <label className="text-[10px] text-gray-500 uppercase">TWD 台幣</label>
                <input type="number" value={twdAmount} onChange={(e) => {setTwdAmount(e.target.value); setKrwAmount(e.target.value * EXCHANGE_RATE)}} 
                  className="w-full bg-black border border-[#333] p-2 text-white focus:border-[#f8a5c2] outline-none" />
              </div>
              <div className="text-center text-[#f8a5c2]">⬇⬆</div>
              <div>
                <label className="text-[10px] text-gray-500 uppercase">KRW 韓元</label>
                <input type="number" value={krwAmount} onChange={(e) => {setKrwAmount(e.target.value); setTwdAmount(e.target.value / EXCHANGE_RATE)}}
                  className="w-full bg-black border border-[#333] p-2 text-white focus:border-[#f8a5c2] outline-none" />
              </div>
            </div>
          </section>

          {/* Money Exchange Point */}
          <section className="bg-[#111] p-6 border-t-4 border-white">
            <h3 className="flex items-center gap-2 font-bold mb-4 uppercase text-white"><Wallet size={18}/> 換匯點推薦</h3>
            <ul className="text-sm space-y-3 text-gray-400">
              <li className="border-b border-[#222] pb-2">
                <span className="text-white block font-bold">南浦洞友利/映真換錢所</span>
                匯率最優，步行可達飯店
              </li>
              <li>
                <span className="text-white block font-bold">西面站 Money Box</span>
                24小時機台，適合晚班機
              </li>
            </ul>
          </section>

          {/* Shopping Tracker */}
          <section className="bg-[#111] p-6 border-t-4 border-[#f8a5c2]">
            <h3 className="flex items-center gap-2 font-bold mb-4 uppercase text-[#f8a5c2]"><ShoppingBag size={18}/> 購物清單/花費</h3>
            <div className="flex gap-2 mb-4">
              <input placeholder="品項" className="flex-1 bg-black border border-[#333] p-2 text-xs" 
                value={newExpense.item} onChange={e => setNewExpense({...newExpense, item: e.target.value})} />
              <input placeholder="KRW" type="number" className="w-20 bg-black border border-[#333] p-2 text-xs" 
                value={newExpense.cost} onChange={e => setNewExpense({...newExpense, cost: e.target.value})} />
              <button onClick={addExpense} className="bg-[#f8a5c2] text-black px-3 font-bold">+</button>
            </div>
            <div className="max-h-40 overflow-y-auto space-y-2">
              {expenses.map(ex => (
                <div key={ex.id} className="flex justify-between text-xs border-b border-[#222] pb-1">
                  <span>{ex.item}</span>
                  <span className="text-[#f8a5c2]">₩{Number(ex.cost).toLocaleString()}</span>
                </div>
              ))}
            </div>
            <div className="mt-4 pt-2 border-t border-[#333] text-right font-bold">
              Total: ₩{expenses.reduce((sum, current) => sum + Number(current.cost), 0).toLocaleString()}
            </div>
          </section>
        </div>
      </main>

      <footer className="text-center py-20 opacity-20 hover:opacity-100 transition-opacity">
        <p className="tracking-widest font-light">BLACKPINK IN YOUR BUSAN • 2025</p>
      </footer>
    </div>
  );
};

export default BusanLuxuryTrip;
